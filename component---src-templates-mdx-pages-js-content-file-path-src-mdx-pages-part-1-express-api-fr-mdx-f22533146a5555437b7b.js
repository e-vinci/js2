"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[8327],{3863:function(e,n,t){t.r(n),t.d(n,{default:function(){return A}});var r=t(3905),l=t(7294);function a(e){const n=Object.assign({h1:"h1",h2:"h2",p:"p",strong:"strong",br:"br",ul:"ul",li:"li",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",code:"code",a:"a",pre:"pre",h4:"h4"},(0,r.ah)(),e.components),{PathViewer:t,PathViewerItem:a,InternalPageMenu:s,InternalPageMenuItem:o,InternalPageTitle:i,ScrollableImage:c}=n;return s||u("InternalPageMenu",!0),o||u("InternalPageMenuItem",!0),i||u("InternalPageTitle",!0),t||u("PathViewer",!0),a||u("PathViewerItem",!0),c||u("ScrollableImage",!0),l.createElement(l.Fragment,null,l.createElement(t,null,l.createElement(a,{to:"/"}," web2course "),l.createElement(a,{to:"/part1"}," Partie 1 "),l.createElement(a,{selected:!0}," b) RESTful API ")),"\n",l.createElement(n.h1,null,"b) Introduction aux RESTful API en Node.js & Express"),"\n",l.createElement(s,null,l.createElement(o,null," Introduction aux RESTful API & conventions "),l.createElement(o,null," Configuration & dÃ©marrage d'une RESTful API en Express "),l.createElement(o,null," Les fonctions middleware en Express "),l.createElement(o,null," DÃ©finition d'une route en Express "),l.createElement(o,null," OpÃ©ration de lecture "),l.createElement(o,null," Chemin et paramÃ¨tres de route "),l.createElement(o,null," Chemin et paramÃ¨tres de requÃªte "),l.createElement(o,null," OpÃ©ration de crÃ©ation & parsing du body "),l.createElement(o,null," Client REST "),l.createElement(o,null," RÃ©pondre avec un code de statut HTTP "),l.createElement(o,null," OpÃ©rations de suppression & de modification "),l.createElement(o,null," Exercice 1.1 : CrÃ©ation d'une RESTfull API non protÃ©gÃ©e pour myMovies "),l.createElement(o,null," ðŸ¬ Exercice 1.2 : Gestion de la pagination, de l'ordre de prÃ©sentation et du filtrage de films ")),"\n",l.createElement(n.h1,null,l.createElement(i,null," Introduction aux RESTful API & conventions ")),"\n",l.createElement(n.h2,null,"C'est quoi une application REST ?"),"\n",l.createElement(n.p,null,l.createElement(n.strong,null,"REST")," vient de ",l.createElement(n.strong,null,"RE"),"presentational ",l.createElement(n.strong,null,"S"),"tate ",l.createElement(n.strong,null,"T"),"ransfer : c'est un style architectural pour construire des applications web extensibles, oÃ¹ les client et serveurs sont sÃ©parÃ©s."),"\n",l.createElement(n.p,null,"Dans une application REST, une ",l.createElement(n.strong,null,"interface uniforme")," (ou API) est dÃ©finie afin de permettre Ã  des applications de coopÃ©rer."),"\n",l.createElement(n.p,null,"Toute application REST se doit d'Ãªtre ",l.createElement(n.strong,null,"stateless")," : il n'y a pas d'enregistrement du contexte d'une session sur le serveur pour comprendre une requÃªte d'un client.",l.createElement(n.br),"\n","Ainsi, les requÃªtes clientes ne dÃ©pendent pas d'un historique de requÃªtes, chaque requÃªte contient tout l'information nÃ©cessaire au serveur."),"\n",l.createElement(n.p,null,"Une RESTful API met Ã  disposition des ",l.createElement(n.strong,null,"opÃ©rations")," sur des ",l.createElement(n.strong,null,"ressources")," via :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"des ",l.createElement(n.strong,null,"URI")," ; il y a donc une adresse unique pur chaque ressource ;"),"\n",l.createElement(n.li,null,"des ",l.createElement(n.strong,null,"mÃ©thodes HTTP")," (GET, POST, DELETE, PATCH, PUT) reprÃ©sentant les opÃ©rations possibles ; on parle souvent d'opÃ©rations ",l.createElement(n.strong,null,"CRUD"),", des opÃ©rations de type ",l.createElement(n.strong,null,"C"),"reate, ",l.createElement(n.strong,null,"R"),"ead, ",l.createElement(n.strong,null,"U"),"pdate ou ",l.createElement(n.strong,null,"D"),"elete) ;"),"\n",l.createElement(n.li,null,"des ",l.createElement(n.strong,null,"reprÃ©sentations"),' des ressources comprÃ©hensibles tant par les clients que les serveurs ; les ressources sont reprÃ©sentÃ©es par leur "Media type" : ',l.createElement(n.strong,null,"JSON"),", ",l.createElement(n.strong,null,"XML"),", ",l.createElement(n.strong,null,"HTML"),", ",l.createElement(n.strong,null,"TXT"),", ",l.createElement(n.strong,null,"JPEG"),"... ; dans le cadre de ce cours, les ressources seront quasi toujours reprÃ©sentÃ©es via du ",l.createElement(n.strong,null,"JSON"),"."),"\n"),"\n",l.createElement(n.h2,null,"Conventions REST"),"\n",l.createElement(n.p,null,"Le type d'opÃ©ration CRUD sur une ressource est dÃ©fini via la ",l.createElement(n.strong,null,"mÃ©thode http")," de la requÃªte.",l.createElement(n.br),"\n","Les opÃ©rations possibles sont :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"GET = Read"),"\n",l.createElement(n.li,null,"POST = Create"),"\n",l.createElement(n.li,null,"DELETE = Delete ðŸ˜‰"),"\n",l.createElement(n.li,null,"PATCH / PUT = Update","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"PATCH = Update d'une ou plusieurs propriÃ©tÃ©(s) de la ressources"),"\n",l.createElement(n.li,null,"PUT = Update de toutes les propriÃ©tÃ©s de la ressources, ou crÃ©ation si la ressource n'existe pas"),"\n"),"\n"),"\n"),"\n",l.createElement(n.p,null,"Voici un exemple d'application de ces conventions REST dans le cadre d'une RESTful API permettant de gÃ©rer des ",l.createElement(n.strong,null,"posts")," :"),"\n",l.createElement(n.table,null,l.createElement(n.thead,null,l.createElement(n.tr,null,l.createElement(n.th,null,"URI"),l.createElement(n.th,null,"MÃ©thode HTTP"),l.createElement(n.th,null,"OpÃ©ration"))),l.createElement(n.tbody,null,l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"posts"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ALL : Lire toutes les ressources de la collection")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"posts?userId=value"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ALL FILTERED : Lire toutes les ressources de la collection selon le filtre donnÃ©")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"posts/{id}"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ONE : Lire la ressource identifiÃ©e")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"posts"))),l.createElement(n.td,null,"POST"),l.createElement(n.td,null,"CREATE ONE : CrÃ©er une ressource basÃ©e sur les donnÃ©es de la requÃªte")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"posts/{id}"))),l.createElement(n.td,null,"DELETE"),l.createElement(n.td,null,"DELETE ONE : Effacer la ressource identifiÃ©e")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"posts/{id}"))),l.createElement(n.td,null,"PUT"),l.createElement(n.td,null,"UPDATE ONE : Remplacer l'entiÃ¨retÃ© de la ressource par les donnÃ©es de la requÃªte")))),"\n",l.createElement("br"),"\n",l.createElement(n.p,null,"Si cette API est hÃ©bergÃ©e Ã  l'URL racine ",l.createElement(n.strong,null,l.createElement(n.a,{href:"https://jsonplaceholder.typicode.com/"},"https://jsonplaceholder.typicode.com/")),", alors nous pourrions identifier une ressource de type ",l.createElement(n.strong,null,"posts")," de cette faÃ§on : ",l.createElement(n.strong,null,l.createElement(n.a,{href:"https://jsonplaceholder.typicode.com/posts/10"},"https://jsonplaceholder.typicode.com/posts/10")),"."),"\n",l.createElement(n.p,null,"Pour lire cette ressource, il faudrait faire une requÃªte http de type ",l.createElement(n.strong,null,"GET")," sur cette ",l.createElement(n.strong,null,"URL")," : ",l.createElement(n.strong,null,l.createElement(n.a,{href:"https://jsonplaceholder.typicode.com/posts/10"},"https://jsonplaceholder.typicode.com/posts/10")),"."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Configuration & dÃ©marrage d'une RESTful API en Express ")),"\n",l.createElement(n.h2,null,"CrÃ©ation d'un projet"),"\n",l.createElement(n.p,null,'Nous allons maintenant crÃ©er notre toute premiÃ¨re RESTful API pour gÃ©rer les donnÃ©es associÃ©es Ã  une pizzeria, afin de bÃ©nÃ©ficier d\'opÃ©rations sur des ressources de type "pizzas".'),"\n",l.createElement(n.p,null,"Dans votre repo ",l.createElement(n.strong,null,"web2"),", veuillez crÃ©er le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/pizzeria/api")),"."),"\n",l.createElement(n.p,null,"Veuillez ouvrir un terminal au niveau de ce rÃ©pertoire."),"\n",l.createElement(n.p,null,"Dans ce rÃ©pertoire, veuillez gÃ©nÃ©rer une application express nommÃ©e ",l.createElement(n.strong,null,"basic"),".",l.createElement(n.br),"\n","Pour ce faire :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"npx express-generator --no-view basic\n")),"\n",l.createElement(n.p,null,"Veuillez installer les dÃ©pendances :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"cd basic\r\nnpm i\n")),"\n",l.createElement(n.p,null,"Pour la suite du tutoriel, nous considÃ©rons que tous les chemins absolus dÃ©marrent du rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/pizzeria/api/basic"))," (ou ",l.createElement(n.strong,null,l.createElement(n.code,null,"/web2/tutorials/pizzeria/api/basic"))," si l'on considÃ¨re le nom du rÃ©pertoire du repo)."),"\n",l.createElement(n.p,null,"Nous allons dÃ©velopper des RESTful API qui ne possÃ¨dent pas de serveur de fichiers statiques.",l.createElement(n.br),"\n","On n'a donc pas besoin d'avoir un rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/public"))," ni d'un serveur statique.",l.createElement(n.br),"\n","On peut donc effacer le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/public"))," et supprimer le middleware de serveur de fichiers statiques au sein de ",l.createElement(n.strong,null,l.createElement(n.code,null,"/app.js"))," (en supprimant cette ligne) :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"app.use(express.static(path.join(__dirname, 'public'))); \n")),"\n",l.createElement(n.h2,null,"Fonctionnement d'une application Express"),"\n",l.createElement(n.p,null,"Nous allons maintenant nous attarder Ã  comprendre les concepts associÃ©s Ã  l'utilisation d'Express, mais en focalisant sur ceux utiles aux applications REST.",l.createElement(n.br),"\n","Voici comment une requÃªte faite Ã  une application Express est traitÃ©e :"),"\n",l.createElement(c,{name:"express-flow.png",minWidth:"800px",maxWidth:"800px"}),"\n",l.createElement("figcaption",null,"Flux d'une requÃªte vers une application Express [R.51]"),"\n",l.createElement(n.p,null,"Dans ce flux de traitement d'une requÃªte, la responsabilitÃ© des dÃ©veloppeurs est de s'occuper de la partie \"Middleware\"."),"\n",l.createElement(n.p,null,'La grande majoritÃ© du code Ã©crit sera du "routing middleware" : notre code s\'occupera de rÃ©pondre Ã  des requÃªtes clientes pour diffÃ©rentes URLs et mÃ©thodes HTTP (GET, POST...).'),"\n",l.createElement(n.p,null,"On l'a dÃ©jÃ  vu, la configuration d'une application Express, comme toutes applications Node.js, est faite au sein de ",l.createElement(n.strong,null,l.createElement(n.code,null,"package.json")),"."),"\n",l.createElement(n.p,null,"En fonction de comment est configurÃ© l'application, on la dÃ©marrera via ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm start")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm run dev")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm run build")),"..."),"\n",l.createElement(n.p,null,"Un ",l.createElement(n.strong,null,"serveur web intÃ©grÃ©")," Ã  nos applications Express est dÃ©marrÃ© au sein du fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"bin/www")),"."),"\n",l.createElement(n.p,null,"C'est ce fichier que vous devez mettre Ã  jour si par exemple vous souhaitez que votre application fonctionne sur un port diffÃ©rent que le port par dÃ©faut ",l.createElement(n.strong,null,"3000"),"."),"\n",l.createElement(n.p,null,"Un serveur intÃ©grÃ© est diffÃ©rent d'une application web offerte par un serveur standalone comme Apache, Tomcat... C'est un serveur trÃ¨s lÃ©ger dÃ©diÃ© Ã  votre application."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Les fonctions middleware en Express ")),"\n",l.createElement(n.h2,null,"C'est quoi une fonction middleware ?"),"\n",l.createElement(n.p,null,"Les fonctions middleware s'occupent du traitement des requÃªtes des clients et de la prÃ©paration des rÃ©ponses :"),"\n",l.createElement(c,{name:"middlewares.jpg",minWidth:"638px",maxWidth:"638px"}),"\n",l.createElement("figcaption",null,"Les fonctions Middleware et Express [R.52]"),"\n",l.createElement(n.p,null,"Une fonction middleware a accÃ¨s aux objets de la requÃªte et de la rÃ©ponse et peut utiliser la requÃªte et la rÃ©ponse pour ajouter, par exemple, un log, pour autoriser un utilisateur, pour parser des donnÃ©es Json vers des objets JS, pour servir des fichiers statiques, pour faire un traitement pour une route bien spÃ©cifique..."),"\n",l.createElement(n.p,null,"Si une fonction middleware ne termine pas le cycle de requÃªte-rÃ©ponse, elle doit appeler ",l.createElement(n.strong,null,l.createElement(n.code,null,"next()"))," pour permettre Ã  d'autres fonctions qui sont dans la queue de pouvoir Ãªtre exÃ©cutÃ©es."),"\n",l.createElement(n.p,null,"Voici les Ã©lÃ©ments associÃ©s Ã  l'appel d'une fonction middleware :"),"\n",l.createElement(c,{name:"middleware-function.png",minWidth:"944px",maxWidth:"944px"}),"\n",l.createElement("figcaption",null,"Une fonction middleware [R.53]"),"\n",l.createElement(n.p,null,"Il existe diffÃ©rents types de fonctions middleware ayant diffÃ©rents cas d'utilisation :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Application-level middleware")," : la fonction middleware est liÃ©e Ã  l'objet ",l.createElement(n.strong,null,"app")," et peut s'appliquer Ã  toutes les requÃªtes."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Router-level middleware")," : la fonction middleware est liÃ©e Ã  un objet de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"express.router()"))," et est trÃ¨s similaire au \"application-level middleware\", mais ne s'applique qu'Ã  un groupe de requÃªtes."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Error-handling middleware")," : fonction de gestion des erreurs qui se dÃ©finit comme les fonctions ci-dessus (au niveau ",l.createElement(n.strong,null,"app")," ou ",l.createElement(n.strong,null,"router"),"), mais qui contient un quatriÃ¨me paramÃ¨tre nommÃ© ",l.createElement(n.strong,null,"error"),"."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Built-in middleware")," : fonctions middleware mises Ã  disposition par Express directement. En voici quelques exemples :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"express.static")," : pour servir des assets statiques ;"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"express.json")," : pour parser le body de requÃªtes en JSON vers des objets JS ;"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"express.urlencoded"),' : pour parser des requÃªtes dont le body est de type "urlencoded" (type par dÃ©faut des formulaires) vers des objets JS.'),"\n"),"\n"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Third-party middleware")," : fonctions mises Ã  disposition par la communautÃ© et installables via npm, comme par exemple la fonction middleware ",l.createElement(n.strong,null,"cookieParser"),"."),"\n"),"\n",l.createElement(n.p,null,"La suite fournit quelques exemples de fonctions middleware qui seront soit plus tard rencontrÃ©es dans notre code, soit sont extraites de la documentation d'Express : ",l.createElement(n.a,{href:"https://expressjs.com/en/guide/using-middleware.html"},"Using middleware")," ",l.createElement(n.a,{href:"/js2/references/#r54"},"[R.54]"),"."),"\n",l.createElement(n.h2,null,"Application-level middleware : exemple"),"\n",l.createElement(n.p,null,"Voici une fonction middleware qui sera exÃ©cutÃ©e Ã  chaque fois qu'il y a une requÃªte, quelque soit le chemin (ou path) associÃ© Ã  la requÃªte :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"varÂ expressÂ =Â require('express');\r\nvarÂ appÂ =Â express();\r\napp.use((req,Â res,Â next) =>Â {\r\nÂ Â console.log('Time:',Â Date.now());\r\nÂ Â next();\r\n});\n")),"\n",l.createElement(n.h2,null,"Router-level middleware : exemple"),"\n",l.createElement(n.p,null,"Voici une partie du code qui se trouverait au sein d'un router de pizzas, dans le fichier ",l.createElement(n.strong,null,"/routes/pizzas.js")," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"varÂ routerÂ =Â express.Router();\r\n\r\nrouter.use((req,Â res,Â next)Â => {\r\nÂ Â console.log('Time:',Â Date.now());\r\nÂ Â next();\r\n});\r\n\r\nrouter.get('/',(req,Â res,Â next)Â => {\r\nÂ Â returnÂ res.json(menu);\r\n});\n")),"\n",l.createElement(n.p,null,"La premiÃ¨re fonction middleware ne contient pas de mÃ©thode HTTP, ni de chemin, elle s'applique donc Ã  toutes les routes associÃ©es au router de pizzas.",l.createElement(n.br),"\n","Voici le code qui permettrait, dans ",l.createElement(n.strong,null,"/app.js"),", d'appeler le router de pizzas :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var pizzaRouter = require('./routes/pizzas');\r\napp.use('/pizzas', pizzaRouter);\n")),"\n",l.createElement(n.p,null,"Si le router est utilisÃ© de cette faÃ§on, en relisant l'avant-dernier snippet, on voit que :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"la premiÃ¨re fonction (oÃ¹ il y a un ",l.createElement(n.code,null,"console.log"),") s'applique donc Ã  toutes les routes qui commencent par ",l.createElement(n.strong,null,"/pizzas")," ;"),"\n",l.createElement(n.li,null,"la deuxiÃ¨me fonction middleware s'appliquent seulement aux requÃªtes de type ",l.createElement(n.strong,null,"GET")," sur la route (ou le chemin) ",l.createElement(n.strong,null,"/pizzas")," (Ã©quivalent de la route ",l.createElement(n.strong,null,"/pizzas/"),")."),"\n"),"\n",l.createElement(n.h2,null,"Error-handling middleware : exemple"),"\n",l.createElement(n.p,null,"Ce type de middleware est Ã  dÃ©finir aprÃ¨s tous les middlewares pouvant gÃ©nÃ©rer une erreur et est appelÃ© via ",l.createElement(n.strong,null,l.createElement(n.code,null,"next(err)"))," dans une fonction middleware oÃ¹ un souci est dÃ©tectÃ©."),"\n",l.createElement(n.p,null,"Voici la dÃ©finition d'un gestionnaire d'erreurs :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"app.use((err, req, res, next) => {\r\n  console.error(err.stack)\r\n  res.status(500).send('Something broke!')\r\n});\n")),"\n",l.createElement(n.p,null,"Attention, il y a bien 4 paramÃ¨tres au lieu des 3 habituels pour les autres types de fonctions middleware."),"\n",l.createElement(n.h2,null,"Built-in middleware & third-party middleware : exemple"),"\n",l.createElement(n.p,null,"Dans ",l.createElement(n.strong,null,"app.js"),", on trouve pas mal d'exemples de ces types de middleware. Ils sont commentÃ©s ci-dessous dans le code :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var express = require('express');\r\nvar path = require('path');\r\nvar cookieParser = require('cookie-parser');\r\nvar logger = require('morgan');\r\n\r\nvar app = express();\r\n\r\napp.use(logger('dev')); //Â HTTP request logger\r\napp.use(express.json()); //Â Parse requests with JSON payloads\r\napp.use(express.urlencoded({ extended: false })); //Â Parse requests with URL-\r\n                                                  // encoded payload \r\napp.use(cookieParser()); //Â Parse cookie header (req.cookies)\r\napp.use(express.static(path.join(__dirname, 'public'))); //Â Serve static assets\n")),"\n",l.createElement(n.h1,null,l.createElement(i,null," DÃ©finition d'une route en Express ")),"\n",l.createElement(n.h2,null,"DÃ©finition d'une route"),"\n",l.createElement(n.p,null,"Le routing, ou routage, contrÃ´le la rÃ©ponse Ã  une requÃªte client pour un chemin et une mÃ©thode HTTP. Le chemin est aussi appelÃ© ",l.createElement(n.strong,null,"endpoint")," ou ",l.createElement(n.strong,null,"URI")," ou ",l.createElement(n.strong,null,"PATH"),"."),"\n",l.createElement(n.p,null,"On va dÃ©finir une route soit sur l'objet ",l.createElement(n.strong,null,"app"),", soit sur un ",l.createElement(n.strong,null,"router"),".",l.createElement(n.br),"\n","Un objet de type ",l.createElement(n.strong,null,"router")," permet de regrouper toutes les routes associÃ©es Ã  un type de ressources."),"\n",l.createElement(n.p,null,"On dÃ©finit une route de cette faÃ§on : ",l.createElement(n.strong,null,l.createElement(n.code,null,"app."))," ou ",l.createElement(n.strong,null,l.createElement(n.code,null,"router.")),"  ",l.createElement(n.strong,null,l.createElement(n.code,null,"METHOD(PATH, MIDDLEWARE_FUNCTION)")),"."),"\n",l.createElement(n.p,null,"ðŸ‘ Dans notre cours, nous vous recommandons d'organiser vos routes par type de ressources et donc de mettre en place des routers."),"\n",l.createElement(n.h1,null,l.createElement(i,null," OpÃ©ration de lecture ")),"\n",l.createElement(n.p,null,'Nous souhaitons par commencer Ã  dÃ©velopper une opÃ©ration permettant de lire toutes les ressources de type "pizzas".',l.createElement(n.br),"\n","Veuillez crÃ©er un router pour traiter des ressources ",l.createElement(n.strong,null,"/pizzas")," au sein de ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js")),".",l.createElement(n.br),"\n","Le plus simple est d'adapter ",l.createElement(n.strong,null,l.createElement(n.code,null,"indexRouter"))," dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"app.js"))," en ",l.createElement(n.strong,null,l.createElement(n.code,null,"pizzaRouter"))," et ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routers/index.js"))," en ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js")),".",l.createElement(n.br),"\n","NB : Il est aussi possible de partir de rien et de crÃ©er ",l.createElement(n.strong,null,l.createElement(n.code,null,"pizzaRouter"))," dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"app.js"))," et ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js")),"."),"\n",l.createElement(n.p,null,"Pour l'opÃ©ration de lecture de toutes les pizzas, selon les conventions REST, il faut faire une requÃªte de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"GET /pizzas")),". Le router de ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js"))," doit donc offrir une route renvoyant toutes les pizzas qui existent dans le menu."),"\n",l.createElement(n.p,null,"Pour dÃ©marrer, nous souhaitons une application basique qui ne gÃ¨re pas la persistance des donnÃ©es. Le menu sera donc un array d'objets, chaque objet reprÃ©sentant une pizza."),"\n",l.createElement(n.p,null,"Notre opÃ©ration de lecture de pizza va renvoyer du JSON au client, c'est Ã  dire une reprÃ©sentation textuelle d'un array d'objets. Nous verrons plus tard ce qu'est rÃ©ellement le JSON. A ce stade-ci, il est suffisant de connaÃ®tre la fonction d'Express qui permet Ã  un objet JS de circuler sur le rÃ©seau : ",l.createElement(n.strong,null,l.createElement(n.code,null,"res.json()")),"."),"\n",l.createElement(n.p,null,"Voici le code du router ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"var express = require('express');\r\nvar router = express.Router();\r\n\r\nconst MENU = [\r\n  {\r\n    id: 1,\r\n    title: '4 fromages',\r\n    content: 'GruyÃ¨re, SÃ©rac, Appenzel, Gorgonzola, Tomates',\r\n  },\r\n  {\r\n    id: 2,\r\n    title: 'Vegan',\r\n    content: 'Tomates, Courgettes, Oignons, Aubergines, Poivrons',\r\n  },\r\n  {\r\n    id: 3,\r\n    title: 'Vegetarian',\r\n    content: 'Mozarella, Tomates, Oignons, Poivrons, Champignons, Olives',\r\n  },\r\n  {\r\n    id: 4,\r\n    title: 'Alpage',\r\n    content: 'GruyÃ¨re, Mozarella, Lardons, Tomates',\r\n  },\r\n  {\r\n    id: 5,\r\n    title: 'Diable',\r\n    content: 'Tomates, Mozarella, Chorizo piquant, Jalapenos',\r\n  },\r\n];\r\n\r\n// Read all the pizzas from the menu\r\nrouter.get('/', (req, res, next) => {\r\n  console.log('GET /pizzas');\r\n  res.json(MENU);\r\n});\r\n\r\nmodule.exports = router;\n")),"\n",l.createElement(n.p,null,"Et voici le code de ",l.createElement(n.strong,null,"app.js")," (les parties modifiÃ©es sont surlignÃ©es) :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"6,16"},l.createElement(n.code,{className:"language-js"},"var express = require('express');\r\nvar path = require('path');\r\nvar cookieParser = require('cookie-parser');\r\nvar logger = require('morgan');\r\n\r\nvar pizzaRouter = require('./routes/pizzas');\r\nvar usersRouter = require('./routes/users');\r\n\r\nvar app = express();\r\n\r\napp.use(logger('dev'));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(cookieParser());\r\n\r\napp.use('/pizzas', pizzaRouter);\r\napp.use('/users', usersRouter);\r\n\r\nmodule.exports = app;\n")),"\n",l.createElement(n.p,null,"Veuillez dÃ©marrer l'API (par dÃ©faut elle est configurÃ©e sur le port 3000 au sein de ",l.createElement(n.strong,null,l.createElement(n.code,null,"bin/www")),") :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-bash"},"npm start\n")),"\n",l.createElement(n.p,null,'Pour consommer l\'opÃ©ration de lecture via un browser, nous pouvons lire toutes les ressources de type "pizzas" ici :\r\n',l.createElement(n.a,{href:"http://localhost:3000/pizzas"},"http://localhost:3000/pizzas")),"\n",l.createElement(n.h1,null,l.createElement(i,null," Chemin et paramÃ¨tres de route ")),"\n",l.createElement(n.p,null,"Les ",l.createElement(n.strong,null,"route parameters")," sont des segments d'une URL qui sont utilisÃ©s pour capturer une valeur spÃ©cifiÃ©e Ã  leur position dans l'URL. On rÃ©cupÃ¨re ces paramÃ¨tres via l'objet ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.params")),"."),"\n",l.createElement(n.p,null,"Pour notre pizzeria, nous souhaitons pouvoir lire une pizza identifiÃ©e par son ",l.createElement(n.strong,null,"id"),"."),"\n",l.createElement(n.p,null,"Nous allons donc ajouter le paramÃ¨tre de route ",l.createElement(n.strong,null,"id"),".",l.createElement(n.br),"\n","En respect des conventions REST, un client, pour faire appel Ã  cette opÃ©ration, devra faire une requÃªte du genre : ",l.createElement(n.strong,null,l.createElement(n.code,null,"GET /pizzas/2")),"."),"\n",l.createElement(n.p,null,"Voici la nouvelle route permettant de traiter de cette opÃ©ration, Ã  ajouter dans le router ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizza.js"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"// Read the pizza identified by an id in the menu\r\nrouter.get('/:id', (req, res) => {\r\n  console.log(`GET /pizzas/${req.params.id}`);\r\n\r\n  const indexOfPizzaFound = MENU.findIndex((pizza) => pizza.id == req.params.id);\r\n\r\n  if (indexOfPizzaFound < 0) return res.sendStatus(404);\r\n\r\n  res.json(MENU[indexOfPizzaFound]);\r\n});\n")),"\n",l.createElement(n.p,null,"Veuillez redÃ©marrer l'API (",l.createElement(n.strong,null,l.createElement(n.code,null,"CTRL c"))," puis ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm start")),")."),"\n",l.createElement(n.p,null,'Pour consommer cette nouvelle opÃ©ration via un browser, nous pouvons lire la ressource de type "pizzas" identifiÃ©e par ',l.createElement(n.strong,null,"2")," dans le menu ainsi :\r\n",l.createElement(n.a,{href:"http://localhost:3000/pizzas/2"},"http://localhost:3000/pizzas/2")),"\n",l.createElement(n.p,null,"Le browser fait bien une requÃªte du genre : ",l.createElement(n.strong,null,l.createElement(n.code,null,"GET /pizzas/2")),".",l.createElement(n.br),"\n",'Le paramÃ¨tre de la route "2" est rÃ©cupÃ©rÃ© dans l\'URL de la route par Express et est offert via ',l.createElement(n.strong,null,l.createElement(n.code,null,"req.params.id")),"."),"\n",l.createElement(n.p,null,"N'hÃ©sitez pas Ã  faire une requÃªte pour un identifiant n'existant pas de le menu pour voir ce qui se passe : ",l.createElement(n.a,{href:"http://localhost:3000/pizzas/666"},"http://localhost:3000/pizzas/666"),"."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Chemin et paramÃ¨tres de requÃªte ")),"\n",l.createElement(n.p,null,"Les ",l.createElement(n.strong,null,"query parameters")," sont des paramÃ¨tres qui peuvent Ãªtre ajoutÃ©s Ã  une URL.",l.createElement(n.br),"\n","On rÃ©cupÃ¨re ces paramÃ¨tres via l'objet ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.query")),"."),"\n",l.createElement(n.p,null,'Pour notre pizzeria, nous souhaitons pouvoir lire toutes les ressources de type "pizzas" triÃ©es par ordre ascendant ou descendant du titre.'),"\n",l.createElement(n.p,null,"En respect des conventions REST, un client, pour faire appel Ã  cette opÃ©ration, devra faire une requÃªte du genre :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"pour le tri ascendant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"GET /pizzas?order=title"))," ;"),"\n",l.createElement(n.li,null,"pour le tri descendant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"GET /pizzas?order=-title")),"."),"\n"),"\n",l.createElement(n.p,null,"Il n'y a donc pas de nouvelle route Ã  ajouter ici. En effet, Ã§a reste une requÃªte de type GET sur la route ",l.createElement(n.strong,null,l.createElement(n.code,null,"/pizzas")),"."),"\n",l.createElement(n.p,null,"Veuillez donc mettre Ã  jour ",l.createElement(n.strong,null,"/routes/pizza.js")," pour la lecture de toutes les pizzas :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"/* Read all the pizzas from the menu\r\n   GET /pizzas?order=titleÂ :Â ascending orderÂ byÂ title\r\nÂ   GET /pizzas?order=-titleÂ :Â descending orderÂ byÂ title\r\n*/\r\nrouter.get('/', (req, res, next) => {\r\n  const orderByTitle =\r\n    req?.query?.order?.includes('title')\r\n      ? req.query.order\r\n      : undefined;\r\n  let orderedMenu;\r\n  console.log(`order by ${orderByTitle ?? 'not requested'}`);\r\n  if (orderByTitle)\r\n    orderedMenu = [...MENU].sort((a, b) => a.title.localeCompare(b.title));\r\n  if (orderByTitle === '-title') orderedMenu = orderedMenu.reverse();\r\n\r\n  console.log('GET /pizzas');\r\n  res.json(orderedMenu ?? MENU);\r\n});\n")),"\n",l.createElement(n.p,null,"Veuillez redÃ©marrer l'API (",l.createElement(n.strong,null,l.createElement(n.code,null,"CTRL c"))," puis ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm start")),")."),"\n",l.createElement(n.p,null,'Pour consommer cette nouvelle opÃ©ration via un browser, nous pouvons lire toutes les ressources de type "pizzas" triÃ©es par leur titre de maniÃ¨re descendante :\r\n',l.createElement(n.a,{href:"http://localhost:3000/pizzas?order=-title"},"http://localhost:3000/pizzas?order=-title"),"."),"\n",l.createElement(n.p,null,"N'hÃ©sitez pas Ã  tester d'autres tris."),"\n",l.createElement(n.h1,null,l.createElement(i,null," OpÃ©ration de crÃ©ation & parsing du body ")),"\n",l.createElement(n.p,null,'Nous souhaitons dÃ©velopper une opÃ©ration permettant de crÃ©er une ressource de type "pizzas".',l.createElement(n.br),"\n","Selon les conventions REST, il faut faire une requÃªte de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"POST /pizzas"))," qui offre une reprÃ©sentation de la ressource Ã  crÃ©er. La reprÃ©sentation utilisÃ©e est le JSON que nous verrons plus en dÃ©tails plus tard.",l.createElement(n.br),"\n",'Si nous souhaitons crÃ©er une ressource dont le titre est "Magic Green" et le contenu est "Epinards, Brocolis, Olives vertes, Basilic", la reprÃ©sentation de la ressource Ã  crÃ©er sera la suivante :'),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'{\r\n    "title":"Magic Green",\r\n    "content":"Epinards, Brocolis, Olives vertes, Basilic"\r\n}\n')),"\n",l.createElement(n.p,null,"Selon les conventions REST, une requÃªte de crÃ©ation est de type ",l.createElement(n.strong,null,"POST")," et contient ses ",l.createElement(n.strong,null,"paramÃ¨tres\r\nau sein du body")," de la requÃªte."),"\n",l.createElement(n.p,null,l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js"))," doit offrir une nouvelle route permettant d'ajouter une nouvelle pizza au menu, qui est un array d'objets. Une nouvelle pizza doit donc Ãªtre ajoutÃ©e Ã  une variable, un array, qui est contenu dans la mÃ©moire vive de votre machine.",l.createElement(n.br),"\n","Lorsque l'ajout d'une pizza au menu a rÃ©ussi, nous souhaitons renvoyer la reprÃ©sentation de la nouvelle ressource au client. Ainsi, le client aura notamment accÃ¨s Ã  l'",l.createElement(n.strong,null,"id")," de la pizza crÃ©Ã© par l'API."),"\n",l.createElement(n.p,null,"Voici le code du router ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.js"))," pour la nouvelle opÃ©ration, veuillez le rajouter dans votre application :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"// Create a pizza to be added to the menu.\r\nrouter.post('/', (req, res) => {\r\n  const title = req?.body?.title?.length !== 0 ? req.body.title : undefined;\r\n  const content = req?.body?.content?.length !== 0 ? req.body.content : undefined;\r\n\r\n  console.log('POST /pizzas');\r\n\r\n  if (!title || !content) return res.sendStatus(400); // error code '400 Bad request'\r\n\r\n  const lastItemIndex = MENU?.length !== 0 ? MENU.length - 1 : undefined;\r\n  const lastId = lastItemIndex !== undefined ? MENU[lastItemIndex]?.id : 0;\r\n  const nextId = lastId + 1;\r\n\r\n  const newPizza = {\r\n    id: nextId,\r\n    title: title,\r\n    content: content,\r\n  };\r\n\r\n  MENU.push(newPizza);\r\n\r\n  res.json(newPizza);\r\n});\n")),"\n",l.createElement(n.p,null,"La reprÃ©sentation de la ressource Ã  crÃ©er est parsÃ©e dans l'objet ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.body"))," grÃ¢ce Ã  la fonction middleware ",l.createElement(n.strong,null,l.createElement(n.code,null,"express.json()"))," appelÃ©e dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"/app.js"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"app.use(express.json());\n")),"\n",l.createElement(n.p,null,"Il est donc important de ne pas retirer cette ligne lorsque l'on crÃ©e une RESTful API."),"\n",l.createElement(n.p,null,"OK, c'est bien, mais comment tester ce nouveau code ?"),"\n",l.createElement(n.p,null,"Le browser permet de facilement crÃ©er des requÃªtes de type ",l.createElement(n.strong,null,"GET"),", mais pas des requÃªtes de type ",l.createElement(n.strong,null,"POST"),"...",l.createElement(n.br),"\n","Nous avons donc besoin d'un client lÃ©ger permettant de faire des requÃªtes HTTP."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Client REST ")),"\n",l.createElement(n.h2,null,"Introduction"),"\n",l.createElement(n.p,null,"Dans le cadre de ce cours, tout comme gÃ©nÃ©ralement dans un environnement professionnel, nous souhaitons pouvoir dÃ©velopper une API indÃ©pendamment du dÃ©veloppement d'une IHM."),"\n",l.createElement(n.p,null,"En effet, cela prendrait trop de temps de devoir dÃ©velopper un frontend (HTML / JavaScript / CSS) pour tester nos API."),"\n",l.createElement(n.p,null,"Nous allons donc utiliser un client lÃ©ger permettant de faire des requÃªtes Ã  nos API.",l.createElement(n.br),"\n","Il en existe de nombreux, comme REST Client ",l.createElement(n.a,{href:"/js2/references/#r55"},"[R.55]")," ou Postman ",l.createElement(n.a,{href:"/js2/references/#r56"},"[R.56]"),"."),"\n",l.createElement(n.p,null,"Pour ce cours, nous vous prÃ©sentons et recommandons d'utiliser REST Client pour Ã©crire et exÃ©cuter vos requÃªtes HTTP."),"\n",l.createElement(n.h2,null,"REST Client"),"\n",l.createElement(n.p,null,"Dans le cadre de ce cours, nous utilisons REST Client ",l.createElement(n.a,{href:"/js2/references/#r55"},"[R.55]")," de Visual Studio Code pour tester nos API."),"\n",l.createElement(n.p,null,"Pour installer REST Client au sein de VS Code, veuillez cliquer sur l'onglet ",l.createElement(n.strong,null,"Extensions"),"."),"\n",l.createElement(n.p,null,"Recherchez l'extension ",l.createElement(n.strong,null,"REST Client")," et cliquez sur ",l.createElement(n.strong,null,"Install"),"."),"\n",l.createElement(n.p,null,"Quelques notions pour utiliser REST Client :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Il faut crÃ©er un fichier ",l.createElement(n.strong,null,".http")," (ou ",l.createElement(n.strong,null,".rest"),") contenant les requÃªtes vers vos RESTful APIs.",l.createElement(n.br),"\n","NB : Il est appropriÃ© de crÃ©er un fichier par par type de ressources."),"\n",l.createElement(n.li,null,"Chaque requÃªte est introduite par ",l.createElement(n.strong,null,"###"),' (3 "',l.createElement(n.strong,null,"#"),'"" ou plus) ; voici la requÃªte permettant de lire toutes les pizzas :'),"\n"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},"### Read all pizzas\r\nGET http://localhost:3000/pizzas\n")),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Pour exÃ©cuter une requÃªte, il suffit de cliquer sur ",l.createElement(n.strong,null,"Send Request"),"."),"\n",l.createElement(n.li,null,"Lorsqu'on envoie des donnÃ©es au format JSON, il est important d'avoir un espace avant les accolades (avant le \"",l.createElement(n.strong,null,"{"),'" ).'),"\n",l.createElement(n.li,null,'On peut dÃ©finir des "',l.createElement(n.strong,null,"File variables"),'" via ce genre de syntaxe : ',l.createElement(n.strong,null,"@baseUrl = ",l.createElement(n.a,{href:"http://localhost:3000"},"http://localhost:3000")),"."),"\n",l.createElement(n.li,null,"Pour utiliser la variable ",l.createElement(n.strong,null,"baseUrl"),", il suffit de la mettre entre double accolades. Par exemple, voici la requÃªte permettant de lire toutes les pizzas :"),"\n"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},"### Read all pizzas with File variable\r\n@baseUrl = http://localhost:3000\r\nGET {{baseUrl}}/pizzas\n")),"\n",l.createElement(n.p,null,"Nous allons maintenant tester l'API de la pizzeria que nous avons crÃ©Ã©e pour toutes ses opÃ©rations."),"\n",l.createElement(n.p,null,"Au sein de VS Code, dans votre projet ",l.createElement(n.strong,null,"/tutorials/pizzeria/api/basic"),", veuillez crÃ©er un rÃ©pertoire nommÃ© ",l.createElement(n.strong,null,"REST Client"),". Dans ce rÃ©pertoire, veuillez crÃ©er un fichier nommÃ© ",l.createElement(n.strong,null,"pizzas.http"),"."),"\n",l.createElement(n.p,null,"Dans ",l.createElement(n.strong,null,"pizzas.http"),", veuillez ajouter cette requÃªte pour la lecture de toutes les pizzas et exÃ©cutez la :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},"### Read all pizzas with File variable\r\n@baseUrl = http://localhost:3000\r\nGET {{baseUrl}}/pizzas\n")),"\n",l.createElement(n.p,null,"Est-ce que cela fonctionne bien ?  Avez vous bien dÃ©marrÃ© votre API ?",l.createElement(n.br),"\n","Vous devriez obtenir le mÃªme rÃ©sultat que si vous accÃ©diez Ã  votre API Ã  l'aide du browser."),"\n",l.createElement(n.p,null,"Au sein de ",l.createElement(n.strong,null,"pizzas.http"),", veuillez ajouter ces deux requÃªtes pour la lecture de toutes les pizzas en les triant selon leur titre :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},"### Read all pizzas sorted by title (ascending)\r\nGET {{baseUrl}}/pizzas/?order=+title\r\n\r\n### Read all pizzas sorted by title (descending)\r\nGET {{baseUrl}}/pizzas/?order=-title\n")),"\n",l.createElement(n.p,null,"Veuillez exÃ©cuter ces deux requÃªtes."),"\n",l.createElement(n.p,null,"Il semble que nous sommes prÃªts pour crÃ©er une requÃªte appelant l'opÃ©ration de crÃ©ation d'une pizza."),"\n",l.createElement(n.p,null,"Au sein de ",l.createElement(n.strong,null,"pizzas.http"),", veuillez ajouter cette requÃªte pour la crÃ©ation d'une pizza :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},'### Create a pizza\r\nPOST {{baseUrl}}/pizzas\r\nContent-Type: application/json\r\n\r\n{\r\n    "title":"Magic Green",\r\n    "content":"Epinards, Brocolis, Olives vertes, Basilic"\r\n}\n')),"\n",l.createElement(n.p,null,"On remarque qu'il est important de mettre une ligne vide avant les accolades reprÃ©sentant le body de la requÃªte.  N'hÃ©sitez pas Ã  tester cette requÃªte avec ou sans la ligne vide pour y croire."),"\n",l.createElement(n.p,null,"ðŸ’­ Comment tester que le bon fonctionnement de l'opÃ©ration de crÃ©ation ?"),"\n",l.createElement(n.p,null,"Et bien il suffit d'exÃ©cuter l'opÃ©ration de lecture de toutes les pizzas ðŸ˜Ž !\r\nSi la nouvelle ressource apparaÃ®t, c'est qu'elle a bien Ã©tÃ© crÃ©Ã©e !\r\nFaites le test."),"\n",l.createElement(n.h1,null,l.createElement(i,null," RÃ©pondre avec un code de statut HTTP ")),"\n",l.createElement(n.p,null,'On ne peut pas toujours renvoyer du JSON suite Ã  une requÃªte client ainsi qu\'un code HTTP correspondant au fait que tout est OK ("200 OK").'),"\n",l.createElement(n.p,null,"Quand vous exÃ©cutez cette requÃªte :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},"### Read all pizzas with File variable\r\nGET {{baseUrl}}/pizzas\n")),"\n",l.createElement(n.p,null,"Vous faites appel Ã  l'opÃ©ration de lecture de toutes les pizzas. La derniÃ¨re ligne de cette opÃ©ration est la suivante :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"res.json(orderedMenu ?? MENU);\n")),"\n",l.createElement(n.p,null,"En fait, la fonction ",l.createElement(n.strong,null,"json"),' renvoie une rÃ©ponse au format JSON, mais de plus, elle renvoie un "status code" ',l.createElement(n.strong,null,"200")," indiquant au client que tout s'est bien passÃ©."),"\n",l.createElement(n.p,null,"Au sein de ",l.createElement(n.strong,null,"pizzas.http"),", veuillez ajouter cette requÃªte pour tenter de crÃ©er une pizza en oubliant un paramÃ¨tre :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},'### Create a pizza which lacks a property\r\nPOST {{baseUrl}}/pizzas\r\nContent-Type: application/json\r\n\r\n{\r\n    "content":"Epinards, Brocolis, Olives vertes, Basilic"\r\n}\n')),"\n",l.createElement(n.p,null,"Veuillez exÃ©cuter cette requÃªte. Que se passe-t-il ?",l.createElement(n.br),"\n",'On rÃ©cupÃ¨re un code d\'erreur "400 Bad Request".'),"\n",l.createElement(n.p,null,"En effet, lorsqu'on omet un paramÃ¨tre dans la reprÃ©sentation de la ressource Ã  crÃ©er, voici les lignes de code amenant au renvoi du code d'erreur 400 au sein de ",l.createElement(n.strong,null,"pizzas.js")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"3,4,8"},l.createElement(n.code,{className:"language-js"},"// Create a pizza to be added to the menu.\r\nrouter.post('/', (req, res) => {\r\n  const title = req?.body?.title?.length !== 0 ? req.body.title : undefined;\r\n  const content = req?.body?.content?.length !== 0 ? req.body.content : undefined;\r\n\r\n  console.log('POST /pizzas');\r\n\r\n  if (!title || !content) return res.sendStatus(400); // error code '400 Bad request'\r\n\r\n  const lastItemIndex = MENU?.length !== 0 ? MENU.length - 1 : undefined;\r\n  const lastId = lastItemIndex !== undefined ? MENU[lastItemIndex]?.id : 0;\r\n  const nextId = lastId + 1;\r\n\r\n  const newPizza = {\r\n    id: nextId,\r\n    title: title,\r\n    content: content,\r\n  };\r\n\r\n  MENU.push(newPizza);\r\n\r\n  res.json(newPizza);\r\n});\n")),"\n",l.createElement(n.p,null,"Le client est donc bien informÃ© qu'il y a eu un problÃ¨me lors de l'exÃ©cution de l'opÃ©ration.",l.createElement(n.br),"\n","Il pourrait par exemple utiliser cette information pour prÃ©senter un message d'erreur au niveau d'une IHM."),"\n",l.createElement(n.p,null,'Voici les grandes catÃ©gories de "status codes" :'),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"RÃ©ponses informatives : ",l.createElement(n.strong,null,"100-199")),"\n",l.createElement(n.li,null,"RÃ©ponses en cas de succÃ¨s : ",l.createElement(n.strong,null,"200-299")),"\n",l.createElement(n.li,null,"Redirections : ",l.createElement(n.strong,null,"300-399")),"\n",l.createElement(n.li,null,"Erreurs du client : ",l.createElement(n.strong,null,"400-499")),"\n",l.createElement(n.li,null,"Erreurs du serveur : ",l.createElement(n.strong,null,"500-599")),"\n"),"\n",l.createElement(n.p,null,'Voici les "status codes" que nous allons gÃ©nÃ©ralement utiliser :'),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"200 OK")," : tout s'est bien passÃ©, Express ajoute ce code automatiquement pour nous quand nous utilisons une mÃ©thode comme ",l.createElement(n.strong,null,"res.json()"),"."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"400 Bad Request")," : pour indiquer au client que la requÃªte contient des paramÃ¨tres non valides ou n'est pas complÃ¨te."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"401 Unauthorized")," : pour indiquer au client qu'il doit s'authentifier pour accÃ©der Ã  cette opÃ©ration. On renvoie aussi ce code d'erreur quand un client fournit un mauvais username ou password."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"403 Forbidden")," : le client est connu du serveur, mais il n'a pas les privilÃ¨ges pour accÃ©der Ã  cette opÃ©ration (par exemple, le client n'est pas admin et tente d'accÃ©der Ã  une opÃ©ration seulement accessible Ã  un admin)."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"404 Not Found")," : la ressource demandÃ©e n'existe pas, bien que l'URL semble valide."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"409 Conflict")," : l'Ã©tat du serveur entre en conflit avec la requÃªte. Par exemple, la requÃªte demande de crÃ©er un utilisateur qui existe dÃ©jÃ ."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"500 Internal Server Error")," : le serveur a rencontrÃ© une erreur qu'il ne peut pas rÃ©gler. Par exemple, le serveur de base de donnÃ©es ne rÃ©pond pas et ne permet donc pas d'accÃ©der aux ressources."),"\n"),"\n",l.createElement(n.h1,null,l.createElement(i,null," OpÃ©rations de suppression & de modification ")),"\n",l.createElement(n.h2,null,"OpÃ©ration de suppression"),"\n",l.createElement(n.p,null,'Nous souhaitons dÃ©velopper une opÃ©ration permettant de supprimer une ressource de type "pizzas" Ã  l\'aide de son identifiant.',l.createElement(n.br),"\n","Selon les conventions REST, il faut faire une requÃªte de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"DELETE /pizzas/{id}"))," contenant l'identifiant de la ressource Ã  supprimer au sein de l'URL comme \"path parameter\"."),"\n",l.createElement(n.p,null,"Une opÃ©ration de suppression ne contient donc pas de body et est de type DELETE."),"\n",l.createElement(n.p,null,"Voici le code du router ",l.createElement(n.strong,null,"/routes/pizzas.js")," pour la nouvelle opÃ©ration, veuillez la rajouter dans votre application :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"// Delete a pizza from the menu based on its id\r\nrouter.delete('/:id', (req, res) => {\r\n  console.log(`DELETE /pizzas/${req.params.id}`);\r\n\r\n  const foundIndex = MENU.findIndex(pizza => pizza.id == req.params.id);\r\n\r\n  if (foundIndex < 0) return res.sendStatus(404);\r\n\r\n  const itemsRemovedFromMenu = MENU.splice(foundIndex, 1);\r\n  const itemRemoved = itemsRemovedFromMenu[0];\r\n\r\n  res.json(itemRemoved);\r\n});\n")),"\n",l.createElement(n.p,null,"Au sein de ",l.createElement(n.strong,null,"pizzas.http"),', veuillez ajouter cette requÃªte pour supprimer la pizza possÃ©dant l\'identifiant "2" :'),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},"### Delete pizza identified by 2\r\nDELETE {{baseUrl}}/pizzas/2\n")),"\n",l.createElement(n.p,null,"Veuillez exÃ©cuter cette requÃªte et vÃ©rifier que la pizza a bien Ã©tÃ© supprimÃ©e."),"\n",l.createElement(n.h2,null,"OpÃ©ration de modification"),"\n",l.createElement(n.p,null,'Nous souhaitons dÃ©velopper une opÃ©ration permettant de modifier une ressource de type "pizzas" Ã  l\'aide de son identifiant et de nouvelles valeurs pour ses propriÃ©tÃ©s.',l.createElement(n.br),"\n","Selon les conventions REST, comme on accepte de modifier que certaines des propriÃ©tÃ©s d'une pizza, qu'il ne faut pas fournir toutes les propriÃ©tÃ©s d'une pizza, il faut faire une requÃªte de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"PATCH /pizzas/{id}"))," contenant\r\nl'identifiant de la ressource Ã  supprimer au sein de l'URL comme \"path parameter\" ainsi que les nouvelles donnÃ©es au sein du body de la requÃªte."),"\n",l.createElement(n.p,null,'Si nous souhaitons modifier une ressource identifiÃ©e par 6 en fournissant un nouveau titre "Magic Green 2", la reprÃ©sentation des donnÃ©es de la ressource Ã  modifier sera la suivante :'),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'{\r\n    "title":"Magic Green 2"\r\n}\n')),"\n",l.createElement(n.p,null,"Selon les conventions REST, la requÃªte de modification est de type PATCH et contient ses paramÃ¨tres au sein du body de la requÃªte."),"\n",l.createElement(n.p,null,"Voici le code du router ",l.createElement(n.strong,null,"/routes/pizzas.js")," pour la nouvelle opÃ©ration, veuillez la rajouter dans votre application :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"// Update a pizza based on its id and new values for its parameters\r\nrouter.patch('/:id', (req, res) => {\r\n  console.log(`PATCH /pizzas/${req.params.id}`);\r\n\r\n  const title = req?.body?.title;\r\n  const content = req?.body?.content;\r\n\r\n  console.log('POST /pizzas');\r\n\r\n  if ((!title && !content) || title?.length === 0 || content?.length === 0) return res.sendStatus(400);\r\n\r\n  const foundIndex = MENU.findIndex(pizza => pizza.id == req.params.id);\r\n\r\n  if (foundIndex < 0) return res.sendStatus(404);\r\n\r\n  const updatedPizza = {...MENU[foundIndex], ...req.body};\r\n\r\n  MENU[foundIndex] = updatedPizza;\r\n\r\n  res.json(updatedPizza);\r\n});\n")),"\n",l.createElement(n.p,null,"Au sein de ",l.createElement(n.strong,null,"pizzas.http"),', veuillez ajouter cette requÃªte pour modifier la pizza possÃ©dant l\'identifiant "6" :'),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-http"},'### Update the pizza identified by 6\r\nPATCH {{baseUrl}}/pizzas/6\r\nContent-Type: application/json\r\n\r\n{\r\n    "title":"Magic Green 2"\r\n}\n')),"\n",l.createElement(n.p,null,"Veuillez exÃ©cuter cette requÃªte et vÃ©rifier que la pizza a bien Ã©tÃ© modifiÃ©e."),"\n",l.createElement(n.p,null,"ðŸ’­ Cela ne fonctionne pas ?",l.createElement(n.br),"\n","Avez vous prÃ©cÃ©demment exÃ©cutÃ© la requÃªte permettant de crÃ©er une sixiÃ¨me pizza."),"\n",l.createElement(n.p,null,"Si tout fonctionne bien, faites un ",l.createElement(n.strong,null,"commit")," de votre repo (",l.createElement(n.strong,null,"web2"),') avec le message "',l.createElement(n.strong,null,"api-basic"),'".'),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez accÃ©der au code du tutoriel ici : ",l.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/basic"},"api-basic"),"."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Exercice 1.1 : CrÃ©ation d'une RESTfull API non protÃ©gÃ©e pour myMovies ")),"\n",l.createElement(n.p,null,"Veuillez continuer le dÃ©veloppement de ",l.createElement(n.strong,null,"myMovies"),". Vous allez crÃ©er la premiÃ¨re version de la RESTful API de ",l.createElement(n.strong,null,"myMovies"),", sous Express, afin de mettre Ã  disposition toutes les opÃ©ration de type CRUD sur des films."),"\n",l.createElement(n.p,null,"Afin de rÃ©aliser cet exercice, voici les contraintes d'implÃ©mentation :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Veuillez crÃ©er une RESTful API pour la collection de films, qui rÃ©ponde sur le port par dÃ©faut d'une application Express (3000), et qui couvre ces opÃ©rations :"),"\n"),"\n",l.createElement(n.table,null,l.createElement(n.thead,null,l.createElement(n.tr,null,l.createElement(n.th,null,"URI"),l.createElement(n.th,null,"MÃ©thode HTTP"),l.createElement(n.th,null,"OpÃ©ration"))),l.createElement(n.tbody,null,l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,"films")),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ALL : Lire toutes les ressources de la collection")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,"films?minimum-duration=value")),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ALL FILTERED : Lire toutes les ressources de la collection selon le filtre donnÃ©")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"films/{id}"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ONE : Lire la ressource identifiÃ©e")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,"films")),l.createElement(n.td,null,"POST"),l.createElement(n.td,null,"CREATE ONE : CrÃ©er une ressource basÃ©e sur les donnÃ©es de la requÃªte")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"films/{id}"))),l.createElement(n.td,null,"DELETE"),l.createElement(n.td,null,"DELETE ONE : Effacer la ressource identifiÃ©e")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"films/{id}"))),l.createElement(n.td,null,"PATCH"),l.createElement(n.td,null,"UPDATE ONE : Mettre Ã  jour les propriÃ©tÃ©s de la ressource par les valeurs donnÃ©es dans la requÃªte, pour une ou plusieurs propriÃ©tÃ©s")))),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Une ressource de type ",l.createElement(n.strong,null,"films")," doit contenir les propriÃ©tÃ©s suivantes :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"id")," : un entier"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"title")," : titre du film (String)"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"duration")," : durÃ©e du film en minutes ; elle doit Ãªtre un nombre positif (pas une string !)."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"budget")," : pour informer du coÃ»t qu'a coutÃ© la production du film, en millions ; le budget doit Ãªtre un nombre positif (pas une string !)."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"link")," : pour donner une URL vers la description du film (lien vers imdb, rottentomatoes ou autre)"),"\n"),"\n"),"\n",l.createElement(n.li,null,"Les ressources ne doivent pas persister : dÃ¨s lors, ajoutez les donnÃ©es associÃ©es aux films dans un array."),"\n",l.createElement(n.li,null,"Veuillez bien valider les paramÃ¨tres reÃ§u par les opÃ©rations de vos API (vÃ©rifier par exemple que ",l.createElement(n.strong,null,"budget")," et ",l.createElement(n.strong,null,"duration")," sont des ",l.createElement(n.strong,null,"number")," positifs) et veuillez renvoyer les bons status codes en cas d'erreur."),"\n",l.createElement(n.li,null,"Veuillez tester toutes les fonctions de la RESTful API pour la collection de films Ã  l'aide du REST Client dans VS Code (extension Ã  installer au sein de VS Code). Veuillez ajouter vos requÃªtes au sein du fichier ",l.createElement(n.strong,null,"films.http")," dans le rÃ©pertoire ",l.createElement(n.strong,null,"REST Client")," du dossier associÃ© Ã  cet exercice."),"\n"),"\n",l.createElement(n.h4,null,"ðŸ¤ Tips"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"N'hÃ©sitez pas Ã  utiliser le gÃ©nÃ©rateur d'applications d'Express pour initier votre projet."),"\n",l.createElement(n.li,null,"DÃ©veloppez les opÃ©rations de votre API de maniÃ¨re incrÃ©mentale : testez une opÃ©ration via REST Client avant de passer Ã  une nouvelle opÃ©ration."),"\n",l.createElement(n.li,null,"Pour le filtre sur les films, vous allez rÃ©cupÃ©rer un paramÃ¨tre de requÃªte.",l.createElement(n.br),"\n","âš¡ Attention, le signe ",l.createElement(n.strong,null,"-")," est un opÃ©rateur en JS, vous ne pouvez pas rÃ©cupÃ©rer le paramÃ¨tre de requÃªte via ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.query.minimum-duration")),"...",l.createElement(n.br),"\n","ðŸ’­ Mais alors comment faire ?",l.createElement(n.br),"\n","On accÃ¨de aussi au propriÃ©tÃ© d'un objet Ã  l'aide d'un array, ici Ã§a serait via ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.query['minimum-duration']")),"."),"\n",l.createElement(n.li,null,"N'hÃ©sitez pas Ã  vous inspirer du code du tutoriel ",l.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/basic"},"api-basic"),"."),"\n",l.createElement(n.li,null,"Pour vÃ©rifier le type d'une variable, n'hÃ©sitez pas Ã  utiliser l'opÃ©rateur ",l.createElement(n.strong,null,l.createElement(n.code,null,"typeof")),"."),"\n"),"\n",l.createElement(n.p,null,"Le code de votre application web doit se trouver dans votre repository local et votre web repository (normalement appelÃ© ",l.createElement(n.strong,null,"web2"),") dans le rÃ©pertoire nommÃ© ",l.createElement(n.strong,null,"/exercises/module4/4.1"),"."),"\n",l.createElement(n.p,null,"Veuillez faire un ",l.createElement(n.strong,null,"commit"),' de votre code avec le message suivant :\r\n"',l.createElement(n.strong,null,"myMovies : module 4 : basic API"),'".'),"\n",l.createElement(n.h1,null,l.createElement(i,null," ðŸ¬ Exercice 1.2 : Gestion de la pagination, de l'ordre de prÃ©sentation et du filtrage de films ")),"\n",l.createElement(n.p,null,"N'hÃ©sitez pas, c'est optionnel, de gÃ©rer de nouvelles opÃ©rations au sein de votre RESTful API de ",l.createElement(n.strong,null,"myMovies")," :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Filtrez tous les films qui commencent par une certaines chaÃ®nes de caractÃ¨res."),"\n",l.createElement(n.li,null,"GÃ©rez l'ordre de prÃ©sentation des films."),"\n"),"\n",l.createElement(n.h4,null,"ðŸ¤ Tips"),"\n",l.createElement(n.p,null,"Besoin d'inspiration pour l'aspect filtrage et la gestion de l'ordre des ressources ? ",l.createElement(n.a,{href:"https://dev.to/drminnaar/rest-api-guide-14n2"},"REST API Guide")," ",l.createElement(n.a,{href:"/js2/references/#r58"},"[R.58]"),"."),"\n",l.createElement(n.p,null,"Veuillez faire un ",l.createElement(n.strong,null,"commit"),' de votre code avec le message suivant : "',l.createElement(n.strong,null,"myMovies : module 4 : ordering & filtrering"),'".'),"\n",l.createElement(n.p,null,"ðŸ¬ Et si vraiment vous avez encore du temps et souhaitez dÃ©jÃ  approfondir les RESTful APIs, n'hÃ©sitez pas aussi Ã  implÃ©menter la gestion de la pagination."))}var s=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?l.createElement(n,e,l.createElement(a,e)):a(e)};function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var o=t(4854),i=t(5583),c=t(5679),d=t(307),m=t(7410),p=t(9523),E=t(8075),g=t(9063),z=t(1631),f=t(5772),v=t(2770),h=t(7008),q=t(9771),b=t(1218),T=(t(5258),t(9394)),x=t(4579),P=t(9416),y=t(9256),j=t(6488),R=t(5175),I=t(6387),S=t(6044);const N={Link:o.Link,Image:c.Z,Section:d.Z,Content:m.Z,Background:p.Z,SectionHeader:E.Z,SectionFooter:g.Z,PageHeader:z.Z,CodeBlock:v.Z,LinkFile:h.Z,ScrollableImage:q.Z,PublicProjectsView:b.Z,AuthenticatedBlock:T.Z,UnAuthenticatedBlock:x.Z,NestedMdxBlock:P.Z,YoutubeImage:y.Z,InternalPageMenu:j.Z,InternalPageMenuItem:R.Z,InternalPageTitle:I.Z,PathViewer:S.k,PathViewerItem:S.F};function w(e){var n,t,a,s,u;let{data:{mdx:o,allImages:c},children:d}=e;return N.PageHeader=(0,f.u)(z.Z,null==o?void 0:o.frontmatter),l.createElement(i.Z,Object.assign({},null!=o&&o.frontmatter?{frontmatter:o.frontmatter}:{},null!=o&&null!==(n=o.frontmatter)&&void 0!==n&&n.navbarExtraStyles?{navbarExtraStyles:o.frontmatter.navbarExtraStyles}:{},null!=o&&null!==(t=o.frontmatter)&&void 0!==t&&t.headerImage?{headerImage:o.frontmatter.headerImage}:{},null!=o&&null!==(a=o.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:o.frontmatter.featuredImage}:{},null!=o&&null!==(s=o.frontmatter)&&void 0!==s&&s.title?{pageTitle:o.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),l.createElement(r.Zo,{components:N},l.createElement("div",{className:null!=o&&null!==(u=o.frontmatter)&&void 0!==u&&u.autoMargin?"page page--auto-margin":"page"},d)))}function A(e){return l.createElement(w,e,l.createElement(s,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-1-express-api-fr-mdx-f22533146a5555437b7b.js.map