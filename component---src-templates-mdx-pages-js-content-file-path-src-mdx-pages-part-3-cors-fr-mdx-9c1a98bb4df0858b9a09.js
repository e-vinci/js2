"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[3999],{3023:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var r=n(3905),l=n(7294);function a(e){const t=Object.assign({h1:"h1",p:"p",strong:"strong",code:"code",a:"a",pre:"pre",ul:"ul",li:"li",br:"br",em:"em"},(0,r.ah)(),e.components),{InternalPageMenu:n,PathViewer:a,PathViewerItem:o}=t;return n||s("InternalPageMenu",!0),a||s("PathViewer",!0),o||s("PathViewerItem",!0),l.createElement(l.Fragment,null,l.createElement(t.h1,null,"d) Autoriser des origines pour une API"),"\n",l.createElement(n,null,l.createElement(a,null,l.createElement(o,{to:"/"}," web2course "),l.createElement(o,{to:"/part1"}," Partie 1 "),l.createElement(o,{selected:!0}," d) Autoriser des origines "))),"\n",l.createElement(t.h1,null,"Autorisation d'origines & les CORS"),"\n",l.createElement(t.p,null,"A cette partie-ci, nous allons voir comment mettre Ã  jour une API afin que dans chaque rÃ©ponse faite Ã  un client, on ajoute un header permettant d'autoriser une ou plusieurs origines."),"\n",l.createElement(t.p,null,"C'est un moyen de relÃ¢cher la sÃ©curitÃ© d'une API tout en restant vigilant sur les origines autorisÃ©es."),"\n",l.createElement(t.p,null,"Pour ce nouveau tutoriel, nous allons partir de la derniÃ¨re version de la RESTful API de pizzas."),"\n",l.createElement(t.p,null,"Veuillez crÃ©er un nouveau projet nommÃ© ",l.createElement(t.strong,null,l.createElement(t.code,null,"/web2/tutorials/back/api/cors"))," sur base d'un copiÃ© collÃ© de ",l.createElement(t.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/services"},"services"),"."),"\n",l.createElement(t.p,null,"Dans ce projet, veuillez installer le package ",l.createElement(t.strong,null,l.createElement(t.code,null,"cors"))," et les types associÃ©s :"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-bash"},"npm i cors\nnpm i @types/cors -D\n")),"\n",l.createElement(t.p,null,"Nous allons configurer les headers de la RESTful API Ã  l'aide du middleware ",l.createElement(t.strong,null,l.createElement(t.code,null,"cors"))," offert par la librairie ",l.createElement(t.strong,null,l.createElement(t.code,null,"cors")),"."),"\n",l.createElement(t.p,null,"Pour configurer et utiliser les ",l.createElement(t.strong,null,"CORS"),", veuillez mettre Ã  jour le fichier ",l.createElement(t.strong,null,l.createElement(t.code,null,"/app.ts"))," :"),"\n",l.createElement(t.pre,{numbered:!0,highlighting:"2,10-12,14"},l.createElement(t.code,{className:"language-ts"},'import express, { ErrorRequestHandler } from "express";\nimport cors from "cors";\n\nimport usersRouter from "./routes/users";\nimport pizzaRouter from "./routes/pizzas";\nimport drinkRouter from "./routes/drinks";\n\nconst app = express();\n\nconst corsOptions = {\n  origin: [/^http:\\/\\/localhost/, "http://amazing.you.com"],\n};\n\napp.use(cors(corsOptions));\n\napp.use((_req, _res, next) => {\n  console.log(\n    "Time:",\n    new Date().toLocaleString("fr-FR", { timeZone: "Europe/Brussels" })\n  );\n  next();\n});\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use("/users", usersRouter);\napp.use("/pizzas", pizzaRouter);\napp.use("/drinks", drinkRouter);\n\nconst errorHandler: ErrorRequestHandler = (err, _req, res, _next) => {\n  console.error(err.stack);\n  return res.status(500).send("Something broke!");\n};\n\napp.use(errorHandler);\nexport default app;\n')),"\n",l.createElement(t.p,null,"Via ",l.createElement(t.strong,null,l.createElement(t.code,null,"/^http:\\/\\/localhost/")),", nous prÃ©cisons que l'API doit autoriser toutes les origines locales (REGEX qui accepte toutes les URL qui commencent par ",l.createElement(t.code,null,"http://localhost"),")."),"\n",l.createElement(t.p,null,"Il reste Ã  s'assurer que votre frontend (",l.createElement(t.strong,null,l.createElement(t.code,null,"/web2/tutorials/pizzeria/front/fetch-no-proxy")),') est lui aussi bien dÃ©marrÃ© et peut rÃ©aliser ses "fetch" vers l\'API.'),"\n",l.createElement(t.p,null,"Tout fonctionne correctement ?"),"\n",l.createElement(t.p,null,"Normalement oui, vous devriez avoir le site de la pizzeria qui affiche le menu des pizzas suite Ã  un appel Ã  l'API."),"\n",l.createElement(t.p,null,"En cas de souci, vous pouvez accÃ©der au code du tutoriel ici :"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"pour l'API : ",l.createElement(t.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/cors"},"cors"),"."),"\n",l.createElement(t.li,null,"pour le frontend :\n",l.createElement(t.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/front/fetch-no-proxy"},"fetch-no-proxy"),"."),"\n"),"\n",l.createElement(t.p,null,"ðŸ’­ OK, Ã§a fonctionne bien... Mais cela est possible seulement si nous sommes les propriÃ©taires de la RESTful API. Maintenant, que faire si une API tierce doit Ãªtre intÃ©grÃ©e dans notre frontend ?",l.createElement(t.br),"\n","Imaginez que vous souhaitez intÃ©grer une opÃ©ration d'une API offerte par Google...",l.createElement(t.br),"\n","Pensez-vous que vous pouvez leur donner un coup de fil et dire : ",l.createElement(t.em,null,'"Google, peux-tu STP autoriser l\'origine associÃ©e Ã  mon site web ?"...')),"\n",l.createElement(t.p,null,"Il y a une solution pour cela : le ",l.createElement(t.strong,null,"proxy")," qui est vu ailleurs dans ce cours."))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,r.ah)(),e.components);return t?l.createElement(t,e,l.createElement(a,e)):a(e)};function s(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var u=n(4160),i=n(5583),c=n(5679),m=n(307),p=n(7410),d=n(9523),g=n(8075),E=n(9063),f=n(1631),h=n(5772),v=n(2770),b=n(7008),I=n(9771),P=n(1218),z=(n(5258),n(9394)),k=n(4579),Z=n(7743),x=n(9256),w=n(6488),A=n(5175),y=n(6387),R=n(6044);const q={Link:u.Link,Image:c.Z,Section:m.Z,Content:p.Z,Background:d.Z,SectionHeader:g.Z,SectionFooter:E.Z,PageHeader:f.Z,CodeBlock:v.Z,LinkFile:b.Z,ScrollableImage:I.Z,PublicProjectsView:P.Z,AuthenticatedBlock:z.Z,UnAuthenticatedBlock:k.Z,NestedMdxBlock:Z.Z,YoutubeImage:x.Z,InternalPageMenu:w.Z,InternalPageMenuItem:A.Z,InternalPageTitle:y.Z,PathViewer:R.k,PathViewerItem:R.F};function S(e){var t,n,a,o,s;let{data:{mdx:u,allImages:c},children:m}=e;return q.PageHeader=(0,h.u)(f.Z,null==u?void 0:u.frontmatter),l.createElement(i.Z,Object.assign({},null!=u&&u.frontmatter?{frontmatter:u.frontmatter}:{},null!=u&&null!==(t=u.frontmatter)&&void 0!==t&&t.navbarExtraStyles?{navbarExtraStyles:u.frontmatter.navbarExtraStyles}:{},null!=u&&null!==(n=u.frontmatter)&&void 0!==n&&n.headerImage?{headerImage:u.frontmatter.headerImage}:{},null!=u&&null!==(a=u.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:u.frontmatter.featuredImage}:{},null!=u&&null!==(o=u.frontmatter)&&void 0!==o&&o.title?{pageTitle:u.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),l.createElement(r.Zo,{components:q},l.createElement("div",{className:null!=u&&null!==(s=u.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},m)))}function j(e){return l.createElement(S,e,l.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-3-cors-fr-mdx-9c1a98bb4df0858b9a09.js.map