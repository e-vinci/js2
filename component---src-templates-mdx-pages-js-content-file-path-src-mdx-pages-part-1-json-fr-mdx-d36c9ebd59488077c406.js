"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[1893],{7811:function(e,n,t){t.r(n),t.d(n,{default:function(){return O}});var r=t(5680),l=t(6540);function a(e){const n=Object.assign({h1:"h1",p:"p",br:"br",strong:"strong",ul:"ul",li:"li",code:"code",pre:"pre",h2:"h2",a:"a"},(0,r.RP)(),e.components),{InternalPageMenu:t,PathViewer:a,PathViewerItem:o,InternalPageMenuItem:i,InternalPageTitle:u}=n;return t||s("InternalPageMenu",!0),i||s("InternalPageMenuItem",!0),u||s("InternalPageTitle",!0),a||s("PathViewer",!0),o||s("PathViewerItem",!0),l.createElement(l.Fragment,null,l.createElement(n.h1,null,"b) Introduction au JSON et persistance des donn√©es"),"\n",l.createElement(t,null,l.createElement(a,null,l.createElement(o,{to:"/"}," web2course "),l.createElement(o,{to:"/part1"}," Partie 1 "),l.createElement(o,{selected:!0}," b) JSON ")),l.createElement(i,null," Le JSON, c'est quoi ? "),l.createElement(i,null," Communication de donn√©es en JSON √† une API "),l.createElement(i,null," Les g√©n√©riques en TS "),l.createElement(i,null," Lecture de donn√©es se trouvant dans un fichier JSON "),l.createElement(i,null," Sauvegarde de donn√©es dans un fichier JSON "),l.createElement(i,null," Exercice 1.7 : Persistance des donn√©es ")),"\n",l.createElement(n.h1,null,l.createElement(u,null," Le JSON, c'est quoi ? ")),"\n",l.createElement(n.p,null,"Pr√©c√©demment, nous avons d√©velopp√© notre premi√®re RESTful API.",l.createElement(n.br),"\n","Nous avons implicitement d√©couvert le JSON, notamment lorsque nous avons fait des requ√™tes vers nos API."),"\n",l.createElement(n.p,null,"Nous allons maintenant voir ce que permet le JSON, notamment la cr√©ation de fichiers permettant de sauvegarder des donn√©es facilement en JS."),"\n",l.createElement(n.p,null,l.createElement(n.strong,null,"JSON")," vient de ",l.createElement(n.strong,null,"J"),"ava",l.createElement(n.strong,null,"S"),"cript ",l.createElement(n.strong,null,"O"),"bject ",l.createElement(n.strong,null,"N"),"otation."),"\n",l.createElement(n.p,null,"C'est une syntaxe pour ",l.createElement(n.strong,null,"√©changer")," et ",l.createElement(n.strong,null,"faire persister des donn√©es"),"."),"\n",l.createElement(n.p,null,"Du JSON, c'est du texte en notation JS."),"\n",l.createElement(n.p,null,"Voici les types de donn√©es qui sont valides en JSON :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"string"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"number"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"object"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"array"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"boolean"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"null"))),"\n"),"\n",l.createElement(n.p,null,"‚ö° Il n'y a donc pas de ",l.createElement(n.strong,null,l.createElement(n.code,null,"function")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"date"))," et ",l.createElement(n.strong,null,l.createElement(n.code,null,"undefined")),"."),"\n",l.createElement(n.p,null,"Voici un exemple de repr√©sentation de donn√©es en JSON qui correspond √† ce que tr√®s souvent une API renvoie, un array d'objets :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'[\r\n  {\r\n    "email": "raphael@voila.com",\r\n    "fullname": "Raphael Baroni"\r\n  },\r\n  {\r\n    "email": "jkj@herenqn.com",\r\n    "fullname": "JK Roling"\r\n  },\r\n  {\r\n    "email": "serena@gmail.com",\r\n    "fullname": "Serena Here"\r\n  }\r\n]\n')),"\n",l.createElement(n.h1,null,l.createElement(u,null," Communication de donn√©es en JSON √† une API ")),"\n",l.createElement(n.h2,null,"Introduction"),"\n",l.createElement(n.p,null,"Dans le tutoriel pr√©c√©dent, nous avons communiqu√© des donn√©es au format JSON :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"soit lors des requ√™tes via REST Client : nous avons envoy√© les donn√©es permettant de cr√©er ou modifier une boisson :"),"\n",l.createElement(n.li,null,"soit lors du traitment des requ√™tes par l'API, afin de cr√©er ou modifier les boissons et les sauvegarder en m√©moire vive (dans un tableau d'objets)."),"\n"),"\n",l.createElement(n.p,null,"Nous allons maintenant approfondir comment les donn√©es au format JSON ont √©t√© trait√©es par l'API."),"\n",l.createElement(n.h2,null,"Envoi de donn√©es d'une API vers un client & s√©rialisation"),"\n",l.createElement(n.p,null,"Via Express, nous pouvons tr√®s facilement convertir un objet JS en JSON afin de l'envoyer vers une application cliente gr√¢ce √† la m√©thode ",l.createElement(n.strong,null,l.createElement(n.code,null,"res.json()")),"."),"\n",l.createElement(n.p,null,"C'est ce que nous appelons de la ",l.createElement(n.strong,null,"s√©rialisation"),' de donn√©es : nous passons du monde "objets en m√©moire" vers du texte (ou des octets) qui va voyager sur un r√©seau.'),"\n",l.createElement(n.p,null,"Le code actuel de notre RESTful API, renvoyant un array de pizzas au format JSON, est g√©r√© automatiquement via :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"return res.json(drinks);\n")),"\n",l.createElement(n.p,null,"Lorsque l'API renvoie ",l.createElement(n.strong,null,l.createElement(n.code,null,"drinks"))," pour les boissons par d√©faut, voici le JSON qui voyage sur le r√©seau :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'[\r\n  {\r\n    "id": 1,\r\n    "title": "Coca-Cola",\r\n    "image": "https://media.istockphoto.com/id/1289738725/fr/photo/bouteille-en-plastique-de-coke-avec-la-conception-et-le-chapeau-rouges-d%C3%A9tiquette.jpg?s=1024x1024&w=is&k=20&c=HBWfROrGDTIgD6fuvTlUq6SrwWqIC35-gceDSJ8TTP8=",\r\n    "volume": 0.33,\r\n    "price": 2.5\r\n  },\r\n  {\r\n    "id": 2,\r\n    "title": "Pepsi",\r\n    "image": "https://media.istockphoto.com/id/185268840/fr/photo/bouteille-de-cola-sur-un-fond-blanc.jpg?s=1024x1024&w=is&k=20&c=xdsxwb4bLjzuQbkT_XvVLyBZyW36GD97T1PCW0MZ4vg=",\r\n    "volume": 0.33,\r\n    "price": 2.5\r\n  },\r\n  {\r\n    "id": 3,\r\n    "title": "Eau Min√©rale",\r\n    "image": "https://media.istockphoto.com/id/1397515626/fr/photo/verre-deau-gazeuse-%C3%A0-boire-isol%C3%A9.jpg?s=1024x1024&w=is&k=20&c=iEjq6OL86Li4eDG5YGO59d1O3Ga1iMVc_Kj5oeIfAqk=",\r\n    "volume": 0.5,\r\n    "price": 1.5\r\n  },\r\n  {\r\n    "id": 4,\r\n    "title": "Jus d\'Orange",\r\n    "image": "https://images.unsplash.com/photo-1600271886742-f049cd451bba?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    "volume": 0.25,\r\n    "price": 4.5\r\n  },\r\n  {\r\n    "id": 5,\r\n    "title": "Limonade",\r\n    "image": "https://images.unsplash.com/photo-1583064313642-a7c149480c7e?q=80&w=1430&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    "volume": 0.33,\r\n    "price": 5\r\n  }\r\n]\n')),"\n",l.createElement(n.p,null,"üí≠ La puissance du JSON peut d√©j√† s'exprimer ici. Mais comment ?"),"\n",l.createElement(n.p,null,"L'API renvoie un array d'objets, des boissons, au format JSON, qui correspond en fait √† un format texte avec des conventions.",l.createElement(n.br),"\n","Il est donc possible √† n'importe quelle application cliente d'utiliser ces donn√©es, quelque soit la technologie, le langage utilis√© pour d√©velopper cette application cliente.",l.createElement(n.br),"\n","Ainsi, par exemple, une application Android, d√©velopp√©e en Java, pourrait consommer cette API pour afficher un menu des boissons !"),"\n",l.createElement(n.h2,null,"R√©ception de donn√©es d'un client par une API & parsing"),"\n",l.createElement(n.p,null,"Via Express, nous pouvons tr√®s facilement convertir du JSON vers un objet JS √† l'aide du middleware ",l.createElement(n.strong,null,l.createElement(n.code,null,"express.json()")),"."),"\n",l.createElement(n.p,null,"C'est ce que nous appelons du ",l.createElement(n.strong,null,"parsing")," de donn√©es, ou de la ",l.createElement(n.strong,null,"d√©s√©rialisation"),' : nous passons du monde texte / JSON (ou des octets) vers des "objets en m√©moire".'),"\n",l.createElement(n.p,null,"Le code actuel de notre RESTful API, r√©cup√©rant les donn√©es d'une boisson √† cr√©er, est tr√®s simple :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-ts"},"const { title, image, volume, price } = req.body as NewDrink;\n")),"\n",l.createElement(n.p,null,"Automatiquement, gr√¢ce √† Express et au middleware appel√© dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"apps.ts"))," (",l.createElement(n.strong,null,l.createElement(n.code,null,"app.use(express.json());")),"), ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.body"))," contient un objet JS repr√©sentant toutes les donn√©es JSON qui √©taient pr√©sentes dans le body de la requ√™te cliente, comme par exemple :"),"\n",l.createElement(n.pre,{highlighting:"5-10"},l.createElement(n.code,{className:"language-http"},'### Create a drink\r\nPOST {{baseUrl}}/drinks\r\nContent-Type: application/json\r\n\r\n{\r\n    "title":"Virgin Tonic",\r\n    "image":"https://plus.unsplash.com/premium_photo-1668771899398-1cdd763f745e?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    "volume":0.25,\r\n    "price":4.5    \r\n}\n')),"\n",l.createElement(n.p,null,'Il est important de communiquer le "',l.createElement(n.strong,null,"media type"),'" (ou ',l.createElement(n.strong,null,"MIME type"),") dans le corps de la requ√™te : ",l.createElement(n.strong,null,l.createElement(n.code,null,"application/json")),".",l.createElement(n.br),"\n","Cela indique √† l'application qui est la cible de la requ√™te (l'API dans notre cas) quel genre d'outil elle devra utiliser pour d√©coder les donn√©es.",l.createElement(n.br),"\n","Par exemple, il faut faire un traitement diff√©rent pour r√©cup√©rer des donn√©es au format JSON que pour r√©cup√©rer des donn√©es directement associ√©es √† un fichier image."),"\n",l.createElement(n.h1,null,l.createElement(u,null," Les g√©n√©riques en TS ")),"\n",l.createElement(n.p,null,"Les g√©n√©riques en TypeScript permettent de cr√©er des composants r√©utilisables qui fonctionnent avec diff√©rents types tout en maintenant la s√©curit√© de typage."),"\n",l.createElement(n.p,null,"Un bon exemple d'utilisation de type g√©n√©rique est le code de la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," donn√©e dans le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.ts"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-ts"},'/**\r\n * Parse items given in a .json file\r\n * @param {String} filePath - path to the .json file\r\n * If the file does not exist or it\'s content cannot be parsed as JSON data,\r\n * use the default data.\r\n * @param {Array} defaultArray - Content to be used when the .json file does not exists\r\n * @returns {Array} : the array that was parsed from the file (or defaultArray)\r\n */\r\nfunction parse<T>(filePath: string, defaultArray: T[] = []): T[] {\r\n  if (!fs.existsSync(filePath)) return defaultArray;\r\n  const fileData = fs.readFileSync(filePath, "utf8");\r\n  try {\r\n    // parse() Throws a SyntaxError exception if the string to parse is not valid JSON.\r\n    return JSON.parse(fileData) as T[];\r\n  } catch (err) {\r\n    return defaultArray;\r\n  }\r\n}\n')),"\n",l.createElement(n.p,null,l.createElement(n.strong,null,l.createElement(n.code,null,"function parse<T>(...)")),": Ici, ",l.createElement(n.strong,null,l.createElement(n.code,null,"T"))," est un param√®tre de type g√©n√©rique. Il agit comme un espace r√©serv√© pour le type que la fonction utilisera. Par convention, les param√®tres de type g√©n√©riques sont souvent des lettres simples comme ",l.createElement(n.strong,null,l.createElement(n.code,null,"T")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"U")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"V")),"..."),"\n",l.createElement(n.p,null,"Ensuite, on pr√©cise l√† o√π on utilise ",l.createElement(n.strong,null,l.createElement(n.code,null,"T"))," : tant en param√®tre de la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," que dans le type de retour de la fonction."),"\n",l.createElement(n.p,null,"La fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"JSON.parse(fileData) "))," permet de cr√©er un objet JS √† partir d'une ",l.createElement(n.strong,null,l.createElement(n.code,null,"string"))," contenant des donn√©es au format JSON."),"\n",l.createElement(n.p,null,"Lorsqu'on va utiliser la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse<T>")),", on pourrait pr√©ciser le type de donn√©es que l'on attend en retour. Par exemple, si on attend un array d'objets de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"Drink")),", on pourrait appeler la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse<T>"))," de la mani√®re suivante :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-ts"},"const drinks = parse<Drink>(jsonDbPath, defaultDrinks);\n")),"\n",l.createElement(n.p,null,"N√©anmoins, TypeScript est capable d'inf√©rer le type de retour de la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse")),". Il n'est donc pas n√©cessaire de pr√©ciser le type de retour de la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," si vous avez pr√©cis√© le type de l'argument ",l.createElement(n.strong,null,l.createElement(n.code,null,"defaultDrinks")),". Ce code serait donc valide :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-ts"},"const drinks = parse(jsonDbPath, defaultDrinks);\n")),"\n",l.createElement(n.h1,null,l.createElement(u,null," Lecture de donn√©es se trouvant dans un fichier JSON ")),"\n",l.createElement(n.p,null,"La fonction parse du fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.ts")),", introduite dans les g√©n√©riques, permet de lire des donn√©es se trouvant dans un fichier JSON."),"\n",l.createElement(n.p,null,"Veuillez cr√©er un nouveau projet ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/back/api/persistence"))," sur base d'un copier/coller de votre r√©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/back/api/basic")),"."),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez t√©l√©charger le code du tutoriel pr√©c√©dent ici : ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/basic"},"basic"),"."),"\n",l.createElement(n.p,null,"Plut√¥t que de lire le menu des boissons √† partir d'un array d'objets, on souhaite lire ce menu gr√¢ce au contenu d'un fichier contenant du JSON."),"\n",l.createElement(n.p,null,"Veuillez commencer par mettre √† jour le router de boissons pour faire un ",l.createElement(n.strong,null,l.createElement(n.code,null,"Rename Symbol"))," de la variable ",l.createElement(n.strong,null,l.createElement(n.code,null,"drinks"))," en ",l.createElement(n.strong,null,l.createElement(n.code,null,"defaultDrinks"))," : pour ce faire, vous pouvez cliquer sur la variable ",l.createElement(n.strong,null,l.createElement(n.code,null,"drinks"))," et appuyer sur ",l.createElement(n.strong,null,l.createElement(n.code,null,"F2"))," (√©quivalent de clic droit sur la variable, ",l.createElement(n.strong,null,l.createElement(n.code,null,"Rename Symbol"))," ) dans le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/drinks.js")),"."),"\n",l.createElement(n.p,null,"Ensuite, nous pr√©voyons que le chemin du futur fichier contenant les boissons sera ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/drinks.json")),"."),"\n",l.createElement(n.p,null,"Voici ce que donnerait l'op√©ration de lecture de toutes les boissons si le chemin et nom complet du fichier JSON √©tait donn√© dans la constante ",l.createElement(n.strong,null,l.createElement(n.code,null,"jsonDbPath")),". Veuillez mettre √† jour votre fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/drinks.js"))," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"2-4,9,12,15"},l.createElement(n.code,{className:"language-ts"},'// Code existant ...\r\nimport path from "node:path";\r\nimport { parse } from "../utils/json";\r\nconst jsonDbPath = path.join(__dirname, "/../data/drinks.json");\r\n\r\n// Suite du code\r\n\r\nrouter.get("/", (req, res) => {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  if (!req.query["budget-max"]) {\r\n    // Cannot call req.query.budget-max as "-" is an operator\r\n    return res.json(drinks);\r\n  }\r\n  const budgetMax = Number(req.query["budget-max"]);\r\n  const filteredDrinks = drinks.filter((drink) => {\r\n    return drink.price <= budgetMax;\r\n  });\r\n  return res.json(filteredDrinks);\r\n});\n')),"\n",l.createElement(n.p,null,"Actuellement, le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/drinks.json"))," n'existe pas, c'est donc le tableau ",l.createElement(n.strong,null,l.createElement(n.code,null,"defaultDrinks"))," qui est retourn√© par la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse")),"."),"\n",l.createElement(n.h1,null,l.createElement(u,null," Sauvegarde de donn√©es dans un fichier JSON ")),"\n",l.createElement(n.p,null,"La fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"JSON.stringify(objectToSerialised)"))," permet de cr√©er une ",l.createElement(n.strong,null,l.createElement(n.code,null,"string"))," contenant la repr√©sentation JSON d'un objet √† s√©rialiser."),"\n",l.createElement(n.p,null,"C√¥t√© serveur, il est ensuite facile de sauvegarder les donn√©es JSON au sein d'un fichier."),"\n",l.createElement(n.p,null,"Le boilerplate du cours pour une API offre d√©j√† une fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"serialize"))," (voir fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.ts")),") permettant √† une application Express de sauvegarder au format JSON un objet dans un fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,".json"))," dont son chemin et nom complet sont indiqu√©s dans le param√®tre ",l.createElement(n.strong,null,l.createElement(n.code,null,"filePath"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-ts"},"/**\r\n * Serialize the content of an Object within a file\r\n * @param {String} filePath - path to the .json file\r\n * @param {Array} object - Object to be written within the .json file.\r\n * Even if the file exists, its whole content is reset by the given object.\r\n */\r\nfunction serialize(filePath: string, object: object) {\r\n  const objectSerialized = JSON.stringify(object);\r\n  createPotentialLastDirectory(filePath);\r\n  fs.writeFileSync(filePath, objectSerialized);\r\n}\r\n\r\n/**\r\n *\r\n * @param {String} filePath - path to the .json file\r\n */\r\nfunction createPotentialLastDirectory(filePath: string) {\r\n  const pathToLastDirectory = filePath.substring(\r\n    0,\r\n    filePath.lastIndexOf(path.sep)\r\n  );\r\n\r\n  if (fs.existsSync(pathToLastDirectory)) return;\r\n\r\n  fs.mkdirSync(pathToLastDirectory);\r\n}\n")),"\n",l.createElement(n.p,null,"La fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"createPotentialLastDirectory"))," permet de cr√©er le r√©pertoire qui contiendra le fichier JSON si celui-ci n'existe pas. Par exemple, le r√©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data"))," sera cr√©√© si le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/drinks.json"))," doit √™tre cr√©√© et que ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data"))," n'existe pas."),"\n",l.createElement(n.p,null,"Il n'est pas int√©ressant de retenir par coeur le code donn√© dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.js")),". Par contre, il est important que vous compreniez celui-ci, ce qu'il fait."),"\n",l.createElement(n.p,null,'A pr√©sent, nous allons convertir le code du router de "drinks" pour rendre les donn√©es persistantes.',l.createElement(n.br),"\n","Voici ce que nous devons faire pour les op√©rations de :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"lecture de ressources")," : il suffit de faire appel √† la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," qui tentera de charger les ressources qui devraient se trouver dans le r√©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/drinks.json")),". Notons que le chemin vers ce fichier JSON est un simple choix, il doit √™tre configurable."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"√©criture de ressources")," : lors d'une op√©ration d'√©criture pour cr√©er une nouvelle ressource, ou pour mettre √† jour une ressource existante, voici les √©tapes :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"cr√©ation d'une liste de toutes les boissons dans un array : cela correspond √† l'utilisation de la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," pour tenter de charger ce qui est contenu dans la mini DB de drinks."),"\n",l.createElement(n.li,null,"mise √† jour de l'array soit en ajoutant un nouvel objet (une boisson), soit en modifiant un objet existant, soit en supprimant un objet."),"\n",l.createElement(n.li,null,"r√©√©criture compl√®te du fichier JSON contenant la liste des boissons sur base de l'array de boissons qui a pr√©c√©demment √©t√© mis √† jour via la m√©thode ",l.createElement(n.strong,null,l.createElement(n.code,null,"serialize")),"."),"\n"),"\n"),"\n"),"\n",l.createElement(n.p,null,"Veuillez mettre √† jour le code du router ",l.createElement(n.strong,null,l.createElement(n.code,null,"/router/drinks.js"))," afin de g√©rer la persistance selon la strat√©gie d√©finie ci-dessus, les modifications √©tant surlign√©es (on a repris les modifications associ√©es √† la lecture de toutes les boissons m√™me si nous l'avions d√©j√† vu pr√©c√©demment) :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"2,4-5,53,56,59,67-68,95,98,110,116,117,122,128,129,158"},l.createElement(n.code,{className:"language-ts"},'import { Router } from "express";\r\nimport path from "node:path";\r\nimport { Drink, NewDrink } from "../types";\r\nimport { parse, serialize } from "../utils/json";\r\nconst jsonDbPath = path.join(__dirname, "/../data/drinks.json");\r\n\r\nconst defaultDrinks: Drink[] = [\r\n  {\r\n    id: 1,\r\n    title: "Coca-Cola",\r\n    image:\r\n      "https://media.istockphoto.com/id/1289738725/fr/photo/bouteille-en-plastique-de-coke-avec-la-conception-et-le-chapeau-rouges-d%C3%A9tiquette.jpg?s=1024x1024&w=is&k=20&c=HBWfROrGDTIgD6fuvTlUq6SrwWqIC35-gceDSJ8TTP8=",\r\n    volume: 0.33,\r\n    price: 2.5,\r\n  },\r\n  {\r\n    id: 2,\r\n    title: "Pepsi",\r\n    image:\r\n      "https://media.istockphoto.com/id/185268840/fr/photo/bouteille-de-cola-sur-un-fond-blanc.jpg?s=1024x1024&w=is&k=20&c=xdsxwb4bLjzuQbkT_XvVLyBZyW36GD97T1PCW0MZ4vg=",\r\n    volume: 0.33,\r\n    price: 2.5,\r\n  },\r\n  {\r\n    id: 3,\r\n    title: "Eau Min√©rale",\r\n    image:\r\n      "https://media.istockphoto.com/id/1397515626/fr/photo/verre-deau-gazeuse-%C3%A0-boire-isol%C3%A9.jpg?s=1024x1024&w=is&k=20&c=iEjq6OL86Li4eDG5YGO59d1O3Ga1iMVc_Kj5oeIfAqk=",\r\n    volume: 0.5,\r\n    price: 1.5,\r\n  },\r\n  {\r\n    id: 4,\r\n    title: "Jus d\'Orange",\r\n    image:\r\n      "https://images.unsplash.com/photo-1600271886742-f049cd451bba?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    volume: 0.25,\r\n    price: 4.5,\r\n  },\r\n  {\r\n    id: 5,\r\n    title: "Limonade",\r\n    image:\r\n      "https://images.unsplash.com/photo-1583064313642-a7c149480c7e?q=80&w=1430&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    volume: 0.33,\r\n    price: 5,\r\n  },\r\n];\r\n\r\nconst router = Router();\r\n\r\nrouter.get("/", (req, res) => {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  if (!req.query["budget-max"]) {\r\n    // Cannot call req.query.budget-max as "-" is an operator\r\n    return res.json(drinks);\r\n  }\r\n  const budgetMax = Number(req.query["budget-max"]);\r\n  const filteredDrinks = drinks.filter((drink) => {\r\n    return drink.price <= budgetMax;\r\n  });\r\n  return res.json(filteredDrinks);\r\n});\r\n\r\nrouter.get("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  const drink = drinks.find((drink) => drink.id === id);\r\n  if (!drink) {\r\n    return res.sendStatus(404);\r\n  }\r\n  return res.json(drink);\r\n});\r\n\r\nrouter.post("/", (req, res) => {\r\n  const body: unknown = req.body;\r\n  if (\r\n    !body ||\r\n    typeof body !== "object" ||\r\n    !("title" in body) ||\r\n    !("image" in body) ||\r\n    !("volume" in body) ||\r\n    !("price" in body) ||\r\n    typeof body.title !== "string" ||\r\n    typeof body.image !== "string" ||\r\n    typeof body.volume !== "number" ||\r\n    typeof body.price !== "number" ||\r\n    !body.title.trim() ||\r\n    !body.image.trim() ||\r\n    body.volume <= 0 ||\r\n    body.price <= 0\r\n  ) {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const { title, image, volume, price } = body as NewDrink;\r\n\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n\r\n  const nextId =\r\n    drinks.reduce((maxId, drink) => (drink.id > maxId ? drink.id : maxId), 0) +\r\n    1;\r\n\r\n  const newDrink: Drink = {\r\n    id: nextId,\r\n    title,\r\n    image,\r\n    volume,\r\n    price,\r\n  };\r\n\r\n  drinks.push(newDrink);\r\n  serialize(jsonDbPath, drinks);\r\n  return res.json(newDrink);\r\n});\r\n\r\nrouter.delete("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  const index = drinks.findIndex((drink) => drink.id === id);\r\n  if (index === -1) {\r\n    return res.sendStatus(404);\r\n  }\r\n  const deletedElements = drinks.splice(index, 1); // splice() returns an array of the deleted elements\r\n  serialize(jsonDbPath, drinks);\r\n  return res.json(deletedElements[0]);\r\n});\r\n\r\nrouter.patch("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  const drink = drinks.find((drink) => drink.id === id);\r\n  if (!drink) {\r\n    return res.sendStatus(404);\r\n  }\r\n\r\n  const body: unknown = req.body;\r\n\r\n  if (\r\n    !body ||\r\n    typeof body !== "object" ||\r\n    ("title" in body &&\r\n      (typeof body.title !== "string" || !body.title.trim())) ||\r\n    ("image" in body &&\r\n      (typeof body.image !== "string" || !body.image.trim())) ||\r\n    ("volume" in body &&\r\n      (typeof body.volume !== "number" || body.volume <= 0)) ||\r\n    ("price" in body && (typeof body.price !== "number" || body.price <= 0))\r\n  ) {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const { title, image, volume, price }: Partial<NewDrink> = body;\r\n\r\n  if (title) {\r\n    drink.title = title;\r\n  }\r\n  if (image) {\r\n    drink.image = image;\r\n  }\r\n  if (volume) {\r\n    drink.volume = volume;\r\n  }\r\n  if (price) {\r\n    drink.price = price;\r\n  }\r\n\r\n  serialize(jsonDbPath, drinks);\r\n\r\n  return res.json(drink);\r\n});\r\n\r\nexport default router;\n')),"\n",l.createElement(n.p,null,"Veuillez testez le bon fonctionnement de l'application. Faites quelques requ√™tes pour ajouter et modifier des donn√©es et v√©rifiez, une fois que vous red√©marrer votre application, que les donn√©es persistent."),"\n",l.createElement(n.h1,null,l.createElement(u,null," Exercice 1.7 : Persistance des donn√©es ")),"\n",l.createElement(n.p,null,"Vous allez mettre √† jour la RESTful API de ",l.createElement(n.strong,null,"myMovies")," afin de rendre les donn√©es persistantes dans un fichier JSON : ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/films.json")),"."),"\n",l.createElement(n.p,null,"Veuillez repartir du code de la solution de votre ",l.createElement(n.a,{href:"../express-api/#exercice_1_6_suppression_modification_de_ressources"},"Exercice 1.6"),".",l.createElement(n.br),"\n","Le code de votre application doit se trouver dans votre repo git dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"/exercises/1.7")),"."),"\n",l.createElement(n.p,null,"Veuillez tester toutes les fonctions de la RESTful API pour la collection de films √† l'aide de REST Client en copiant les requ√™tes d√©velopp√©es pour l'exercice pr√©c√©dent (fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"films.http"))," du r√©pertoire ",l.createElement(n.strong,null,"REST Client"),"). Normalement, il n'y a pas de nouvelles requ√™tes √† √©crire, il suffit juste de les ex√©cuter."),"\n",l.createElement(n.p,null,"Veuillez faire un ",l.createElement(n.strong,null,l.createElement(n.code,null,"commit"))," de votre code avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new: ex1.7")),"."))}var o=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,r.RP)(),e.components);return n?l.createElement(n,e,l.createElement(a,e)):a(e)};function s(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var i=t(4810),u=t(2662),c=t(9640),d=t(5938),m=t(9460),p=t(7929),E=t(794),f=t(4092),g=t(4262),b=t(3528),h=t(9942),v=t(4698),y=t(2214),j=t(9838),k=(t(1262),t(1731)),x=t(7050),q=t(2483),S=t(4902),P=t(9294),D=t(7828),N=t(2035),A=t(5590);const I={Link:i.Link,Image:c.A,Section:d.A,Content:m.A,Background:p.A,SectionHeader:E.A,SectionFooter:f.A,PageHeader:g.A,CodeBlock:h.A,LinkFile:v.A,ScrollableImage:y.A,PublicProjectsView:j.A,AuthenticatedBlock:k.A,UnAuthenticatedBlock:x.A,NestedMdxBlock:q.A,YoutubeImage:S.A,InternalPageMenu:P.A,InternalPageMenuItem:D.A,InternalPageTitle:N.A,PathViewer:A.E,PathViewerItem:A.F};function w(e){var n,t,a,o,s;let{data:{mdx:i,allImages:c},children:d}=e;return I.PageHeader=(0,b.R)(g.A,null==i?void 0:i.frontmatter),l.createElement(u.A,Object.assign({},null!=i&&i.frontmatter?{frontmatter:i.frontmatter}:{},null!=i&&null!==(n=i.frontmatter)&&void 0!==n&&n.navbarExtraStyles?{navbarExtraStyles:i.frontmatter.navbarExtraStyles}:{},null!=i&&null!==(t=i.frontmatter)&&void 0!==t&&t.headerImage?{headerImage:i.frontmatter.headerImage}:{},null!=i&&null!==(a=i.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:i.frontmatter.featuredImage}:{},null!=i&&null!==(o=i.frontmatter)&&void 0!==o&&o.title?{pageTitle:i.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),l.createElement(r.xA,{components:I},l.createElement("div",{className:null!=i&&null!==(s=i.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},d)))}function O(e){return l.createElement(w,e,l.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-1-json-fr-mdx-d36c9ebd59488077c406.js.map