"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[1488],{6994:function(e,t,r){r.r(t),r.d(t,{default:function(){return V}});var n=r(5680),l=r(6540);function a(e){const t=Object.assign({h1:"h1",p:"p",strong:"strong",code:"code",a:"a",pre:"pre",ul:"ul",li:"li",br:"br",em:"em"},(0,n.RP)(),e.components),{InternalPageMenu:r,PathViewer:a,PathViewerItem:o}=t;return r||s("InternalPageMenu",!0),a||s("PathViewer",!0),o||s("PathViewerItem",!0),l.createElement(l.Fragment,null,l.createElement(t.h1,null,"ðŸ¬ a) Autoriser des origines pour une API"),"\n",l.createElement(r,null,l.createElement(a,null,l.createElement(o,{to:"/"}," web2course "),l.createElement(o,{to:"/part3"}," Partie 3 "),l.createElement(o,{selected:!0}," ðŸ¬ a) Autoriser des origines "))),"\n",l.createElement(t.h1,null,"Autorisation d'origines & les CORS"),"\n",l.createElement(t.p,null,"A cette partie-ci, nous allons voir comment mettre Ã  jour une API afin que dans chaque rÃ©ponse faite Ã  un client, on ajoute un header permettant d'autoriser une ou plusieurs origines."),"\n",l.createElement(t.p,null,"C'est un moyen de relÃ¢cher la sÃ©curitÃ© d'une API tout en restant vigilant sur les origines autorisÃ©es."),"\n",l.createElement(t.p,null,"Pour ce nouveau tutoriel, nous allons partir de la derniÃ¨re version de la RESTful API de pizzas."),"\n",l.createElement(t.p,null,"Veuillez crÃ©er un nouveau projet nommÃ© ",l.createElement(t.strong,null,l.createElement(t.code,null,"/web2/tutorials/back/api/cors"))," sur base d'un copiÃ© collÃ© de ",l.createElement(t.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/services"},"services"),"."),"\n",l.createElement(t.p,null,"Dans ce projet, veuillez installer le package ",l.createElement(t.strong,null,l.createElement(t.code,null,"cors"))," et les types associÃ©s :"),"\n",l.createElement(t.pre,null,l.createElement(t.code,{className:"language-bash"},"npm i cors\r\nnpm i @types/cors -D\n")),"\n",l.createElement(t.p,null,"Nous allons configurer les headers de la RESTful API Ã  l'aide du middleware ",l.createElement(t.strong,null,l.createElement(t.code,null,"cors"))," offert par la librairie ",l.createElement(t.strong,null,l.createElement(t.code,null,"cors")),"."),"\n",l.createElement(t.p,null,"Pour configurer et utiliser les ",l.createElement(t.strong,null,"CORS"),", veuillez mettre Ã  jour le fichier ",l.createElement(t.strong,null,l.createElement(t.code,null,"/app.ts"))," :"),"\n",l.createElement(t.pre,{numbered:!0,highlighting:"2,10-12,14"},l.createElement(t.code,{className:"language-ts"},'import express, { ErrorRequestHandler } from "express";\r\nimport cors from "cors";\r\n\r\nimport usersRouter from "./routes/users";\r\nimport pizzaRouter from "./routes/pizzas";\r\nimport drinkRouter from "./routes/drinks";\r\n\r\nconst app = express();\r\n\r\nconst corsOptions = {\r\n  origin: [/^http:\\/\\/localhost/, "http://amazing.you.com"],\r\n};\r\n\r\napp.use(cors(corsOptions));\r\n\r\napp.use((_req, _res, next) => {\r\n  console.log(\r\n    "Time:",\r\n    new Date().toLocaleString("fr-FR", { timeZone: "Europe/Brussels" })\r\n  );\r\n  next();\r\n});\r\n\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\n\r\napp.use("/users", usersRouter);\r\napp.use("/pizzas", pizzaRouter);\r\napp.use("/drinks", drinkRouter);\r\n\r\nconst errorHandler: ErrorRequestHandler = (err, _req, res, _next) => {\r\n  console.error(err.stack);\r\n  return res.status(500).send("Something broke!");\r\n};\r\n\r\napp.use(errorHandler);\r\nexport default app;\n')),"\n",l.createElement(t.p,null,"Via ",l.createElement(t.strong,null,l.createElement(t.code,null,"/^http:\\/\\/localhost/")),", nous prÃ©cisons que l'API doit autoriser toutes les origines locales (REGEX qui accepte toutes les URL qui commencent par ",l.createElement(t.code,null,"http://localhost"),")."),"\n",l.createElement(t.p,null,"Il reste Ã  s'assurer que votre frontend (",l.createElement(t.strong,null,l.createElement(t.code,null,"/web2/tutorials/pizzeria/front/fetch-no-proxy")),') est lui aussi bien dÃ©marrÃ© et peut rÃ©aliser ses "fetch" vers l\'API.'),"\n",l.createElement(t.p,null,"Tout fonctionne correctement ?"),"\n",l.createElement(t.p,null,"Normalement oui, vous devriez avoir le site de la pizzeria qui affiche le menu des pizzas suite Ã  un appel Ã  l'API."),"\n",l.createElement(t.p,null,"En cas de souci, vous pouvez accÃ©der au code du tutoriel ici :"),"\n",l.createElement(t.ul,null,"\n",l.createElement(t.li,null,"pour l'API : ",l.createElement(t.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/cors"},"cors"),"."),"\n",l.createElement(t.li,null,"pour le frontend :\r\n",l.createElement(t.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/front/fetch-no-proxy"},"fetch-no-proxy"),"."),"\n"),"\n",l.createElement(t.p,null,"ðŸ’­ OK, Ã§a fonctionne bien... Mais cela est possible seulement si nous sommes les propriÃ©taires de la RESTful API. Maintenant, que faire si une API tierce doit Ãªtre intÃ©grÃ©e dans notre frontend ?",l.createElement(t.br),"\n","Imaginez que vous souhaitez intÃ©grer une opÃ©ration d'une API offerte par Google...",l.createElement(t.br),"\n","Pensez-vous que vous pouvez leur donner un coup de fil et dire : ",l.createElement(t.em,null,'"Google, peux-tu STP autoriser l\'origine associÃ©e Ã  mon site web ?"...')),"\n",l.createElement(t.p,null,"Il y a une solution pour cela : le ",l.createElement(t.strong,null,"proxy")," qui est vu ailleurs dans ce cours."))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,n.RP)(),e.components);return t?l.createElement(t,e,l.createElement(a,e)):a(e)};function s(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var u=r(4810),i=r(2662),c=r(9640),m=r(5938),p=r(9460),d=r(7929),E=r(794),g=r(4092),f=r(4262),h=r(3528),v=r(9942),A=r(4698),b=r(2214),I=r(9838),P=(r(1262),r(1731)),z=r(7050),k=r(2483),x=r(4902),R=r(9294),w=r(7828),y=r(2035),q=r(5590);const S={Link:u.Link,Image:c.A,Section:m.A,Content:p.A,Background:d.A,SectionHeader:E.A,SectionFooter:g.A,PageHeader:f.A,CodeBlock:v.A,LinkFile:A.A,ScrollableImage:b.A,PublicProjectsView:I.A,AuthenticatedBlock:P.A,UnAuthenticatedBlock:z.A,NestedMdxBlock:k.A,YoutubeImage:x.A,InternalPageMenu:R.A,InternalPageMenuItem:w.A,InternalPageTitle:y.A,PathViewer:q.E,PathViewerItem:q.F};function j(e){var t,r,a,o,s;let{data:{mdx:u,allImages:c},children:m}=e;return S.PageHeader=(0,h.R)(f.A,null==u?void 0:u.frontmatter),l.createElement(i.A,Object.assign({},null!=u&&u.frontmatter?{frontmatter:u.frontmatter}:{},null!=u&&null!==(t=u.frontmatter)&&void 0!==t&&t.navbarExtraStyles?{navbarExtraStyles:u.frontmatter.navbarExtraStyles}:{},null!=u&&null!==(r=u.frontmatter)&&void 0!==r&&r.headerImage?{headerImage:u.frontmatter.headerImage}:{},null!=u&&null!==(a=u.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:u.frontmatter.featuredImage}:{},null!=u&&null!==(o=u.frontmatter)&&void 0!==o&&o.title?{pageTitle:u.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),l.createElement(n.xA,{components:S},l.createElement("div",{className:null!=u&&null!==(s=u.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},m)))}function V(e){return l.createElement(j,e,l.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-3-cors-fr-mdx-cef4037a8a1c6b1a6209.js.map