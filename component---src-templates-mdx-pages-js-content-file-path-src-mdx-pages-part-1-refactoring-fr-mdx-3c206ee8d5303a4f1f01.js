"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[489],{7646:function(e,n,r){r.r(n),r.d(n,{default:function(){return M}});var t=r(5680),l=r(6540);function a(e){const n=Object.assign({h1:"h1",p:"p",a:"a",br:"br",ul:"ul",li:"li",strong:"strong",code:"code",pre:"pre",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",h4:"h4"},(0,t.RP)(),e.components),{InternalPageMenu:r,PathViewer:a,PathViewerItem:i,InternalPageMenuItem:o,YoutubeImage:u,InternalPageTitle:d}=n;return r||s("InternalPageMenu",!0),o||s("InternalPageMenuItem",!0),d||s("InternalPageTitle",!0),a||s("PathViewer",!0),i||s("PathViewerItem",!0),u||s("YoutubeImage",!0),l.createElement(l.Fragment,null,l.createElement(n.h1,null,"c) Refactoring Ã  l'aide de services"),"\n",l.createElement(r,null,l.createElement(a,null,l.createElement(i,{to:"/"}," web2course "),l.createElement(i,{to:"/part1"}," Partie 1)"),l.createElement(i,{selected:!0}," c) Refactoring ")),l.createElement(o,null," Architectures web possibles pour une API ? "),l.createElement(o,null," Architecture Express & services "),l.createElement(o,null," Exercice 1.8 : Refactoring Ã  l'aide d'un service "),l.createElement(o,null," Exercice 1.9 : Encore un service ")),"\n",l.createElement("div",{className:"card card__simple-youtube-container"},l.createElement(u,{src:"https://youtu.be/FihV6wXpIQE"})),"\n",l.createElement(n.h1,null,l.createElement(d,null," Architectures web possibles pour une API ? ")),"\n",l.createElement(n.p,null,"Si nous reprenons le code actuel du tutoriel de l'API gÃ©rant des boissons (",l.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/back/api/persistence"},"persistence"),"), nous pouvons dÃ©tecter que celui-ci pourrait Ãªtre plus propre."),"\n",l.createElement(n.p,null,"Par exemple, le routeur de \"drinks\" s'occupe tant de gÃ©rer les requÃªtes des clients que d'accÃ©der directement aux donnÃ©es.",l.createElement(n.br),"\n","GÃ©nÃ©ralement, nous prÃ©fÃ©rons sÃ©parer le code gÃ©rant les accÃ¨s aux donnÃ©es du code gÃ©rant la prÃ©sentation du rÃ©sultat des opÃ©rations."),"\n",l.createElement(n.p,null,"On peut donc se demander comment sÃ©parer le code traitant de sujets trÃ¨s diffÃ©rents. Il existe une multitude d'architectures possibles, voici par exemple certains des plus grands noms :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Architecture MVC (Model View Controller)")," ; au niveau backend, ce genre d'architecture est gÃ©nÃ©ralement trÃ¨s utile quand on fait des MPA (ou Multi-Page Applications) via du Server-Side Rendering. Les ",l.createElement(n.strong,null,"Views")," permettent de gÃ©nÃ©rer le frontend Ã  l'aide d'un moteur de templating ; le ",l.createElement(n.strong,null,"Controller")," s'occupe de traiter les requÃªtes en appelant le ",l.createElement(n.strong,null,"Model")," pour l'accÃ¨s aux opÃ©rations sur les donnÃ©es et en renvoyant les ",l.createElement(n.strong,null,"Views")," adÃ©quates. Pour une API, cette architecture n'est pas la plus adaptÃ©e."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,'Architecture classique "three-tier"')," ; au niveau backend, quand on dÃ©veloppe une architecture trois tiers, cela signifie que l'on dÃ©coupe notre API en trois couches :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"couche de prÃ©sentation")," : cette couche est responsable de prÃ©senter les ressources aux clients et d'interprÃ©ter les reprÃ©sentations des ressources donnÃ©es dans les requÃªtes ;"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"couche business")," : cette couche s'occupe de toute la logique de l'API, elle fait l'intermÃ©diaire entre la couche de prÃ©sentation et la couche de donnÃ©es ;"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"couche de donnÃ©es")," : cette couche s'occupe des accÃ¨s aux donnÃ©es et permet notamment la persistance des ressources au sein de bases de donnÃ©es.",l.createElement(n.br),"\n","Le modÃ¨le trois tiers est fort intÃ©ressant, mais il demande un peu trop d'Ã©criture de codes sans grande valeur ajoutÃ©e quand nous utilisons le framework Express."),"\n"),"\n"),"\n",l.createElement(n.li,null,"..."),"\n"),"\n",l.createElement(n.p,null,"Finalement, parmi les architectures classiques, il n'y a pas rÃ©ellement une architecture qui colle parfaitement Ã  ce qui est offert par le framework Express, sans devoir Ã©crire du code sans valeur ajoutÃ©e."),"\n",l.createElement(n.p,null,'Ainsi, nous allons simplement crÃ©er notre propre architecture "maison", sur base de ces points :'),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"On souhaite pouvoir ",l.createElement(n.strong,null,"facilement remplacer la couche d'accÃ¨s aux donnÃ©es sans changer la reprÃ©sentation des ressources")," ; en effet, dans un premier temps, nous sauvegarderons des donnÃ©es dans des fichiers JSON. Plus tard, si l'on venait Ã  sauvegarder les donnÃ©es dans un systÃ¨me de gestion de base de donnÃ©es, on ne veut pas devoir mettre Ã  jour le code prenant en compte les requÃªtes des clients et prÃ©sentant la rÃ©ponse Ã  ces requÃªtes ; en gros, on souhaite que le code de nos routers, au sein d'Express, soit indÃ©pendant de l'implÃ©mentation des accÃ¨s aux donnÃ©es."),"\n",l.createElement(n.li,null,"Nous n'avons pas vraiment de contraintes pour l'aspect \"business\" de nos APIs : la logique de l'application peut soit s'associer Ã  la couche de donnÃ©es, soit Ã  la couche prÃ©sentation. NÃ©anmoins, nous allons prÃ©fÃ©rer ",l.createElement(n.strong,null,"associer un maximum de la logique de notre application")," Ã  ce que nous allons appeler un ",l.createElement(n.strong,null,"service"),". Le ",l.createElement(n.strong,null,"service")," contiendra toutes les ",l.createElement(n.strong,null,"opÃ©rations possibles sur les ressources"),", ainsi que les ",l.createElement(n.strong,null,"accÃ¨s aux donnÃ©es"),"."),"\n",l.createElement(n.li,null,"Le ",l.createElement(n.strong,null,"service")," peut Ãªtre soit Ã©crit en orientÃ© objet, soit simplement Ãªtre un module fournissant des fonctions. Dans le cadre de ce cours, nous choisissons de prÃ©senter un maximum de programmation fonctionnelle plutÃ´t que de l'orientÃ© objet.",l.createElement(n.br),"\n","NÃ©anmoins, n'hÃ©sitez pas Ã  Ã©crire des classes si cela vous tient Ã  coeur ðŸ˜‰."),"\n"),"\n",l.createElement(n.h1,null,l.createElement(d,null," Architecture Express & services ")),"\n",l.createElement(n.p,null,"Dans un nouveau tutoriel, nous allons maintenant faire un refactor de notre API de gestion des pizzas en crÃ©ant et utilisant un service."),"\n",l.createElement(n.p,null,"Veuillez crÃ©er un nouveau projet ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/back/api/services"))," sur base d'un copier/coller de votre rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/back/api/persistence")),"."),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez tÃ©lÃ©charger le code du tutoriel prÃ©cÃ©dent ici : ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/persistence"},"persistence"),"."),"\n",l.createElement(n.p,null,"Nous allons commencer par crÃ©er le ",l.createElement(n.strong,null,"service")," offrant les opÃ©rations sur les boissons.",l.createElement(n.br),"\n","Veuillez crÃ©er le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/services/drinks.ts")),".",l.createElement(n.br),"\n",'Au sein de ce fichier, veuillez ajouter le code s\'occupant des opÃ©rations sur les ressources de type "drinks" :'),"\n",l.createElement(n.pre,{numbered:!0},l.createElement(n.code,{className:"language-ts"},'import path from "node:path";\r\nimport { Drink, NewDrink } from "../types";\r\nimport { parse, serialize } from "../utils/json";\r\nconst jsonDbPath = path.join(__dirname, "/../data/drinks.json");\r\n\r\nconst defaultDrinks: Drink[] = [\r\n  {\r\n    id: 1,\r\n    title: "Coca-Cola",\r\n    image:\r\n      "https://media.istockphoto.com/id/1289738725/fr/photo/bouteille-en-plastique-de-coke-avec-la-conception-et-le-chapeau-rouges-d%C3%A9tiquette.jpg?s=1024x1024&w=is&k=20&c=HBWfROrGDTIgD6fuvTlUq6SrwWqIC35-gceDSJ8TTP8=",\r\n    volume: 0.33,\r\n    price: 2.5,\r\n  },\r\n  {\r\n    id: 2,\r\n    title: "Pepsi",\r\n    image:\r\n      "https://media.istockphoto.com/id/185268840/fr/photo/bouteille-de-cola-sur-un-fond-blanc.jpg?s=1024x1024&w=is&k=20&c=xdsxwb4bLjzuQbkT_XvVLyBZyW36GD97T1PCW0MZ4vg=",\r\n    volume: 0.33,\r\n    price: 2.5,\r\n  },\r\n  {\r\n    id: 3,\r\n    title: "Eau MinÃ©rale",\r\n    image:\r\n      "https://media.istockphoto.com/id/1397515626/fr/photo/verre-deau-gazeuse-%C3%A0-boire-isol%C3%A9.jpg?s=1024x1024&w=is&k=20&c=iEjq6OL86Li4eDG5YGO59d1O3Ga1iMVc_Kj5oeIfAqk=",\r\n    volume: 0.5,\r\n    price: 1.5,\r\n  },\r\n  {\r\n    id: 4,\r\n    title: "Jus d\'Orange",\r\n    image:\r\n      "https://images.unsplash.com/photo-1600271886742-f049cd451bba?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    volume: 0.25,\r\n    price: 4.5,\r\n  },\r\n  {\r\n    id: 5,\r\n    title: "Limonade",\r\n    image:\r\n      "https://images.unsplash.com/photo-1583064313642-a7c149480c7e?q=80&w=1430&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",\r\n    volume: 0.33,\r\n    price: 5,\r\n  },\r\n];\r\n\r\nfunction readAllDrinks(budgetMax: number): Drink[] {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  if (!budgetMax) {\r\n    return drinks;\r\n  }\r\n\r\n  const budgetMaxNumber = Number(budgetMax);\r\n\r\n  const filteredDrinks = drinks.filter((drink) => {\r\n    return drink.price <= budgetMaxNumber;\r\n  });\r\n  return filteredDrinks;\r\n}\r\n\r\nfunction readOneDrink(id: number): Drink | undefined {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  const drink = drinks.find((drink) => drink.id === id);\r\n  if (!drink) {\r\n    return undefined;\r\n  }\r\n  return drink;\r\n}\r\n\r\nfunction createOneDrink(newDrink: NewDrink): Drink {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n\r\n  const nextId =\r\n    drinks.reduce((maxId, drink) => (drink.id > maxId ? drink.id : maxId), 0) +\r\n    1;\r\n\r\n  const createdDrink = {\r\n    id: nextId,\r\n    ...newDrink,\r\n  };\r\n\r\n  drinks.push(createdDrink);\r\n  serialize(jsonDbPath, drinks);\r\n\r\n  return createdDrink;\r\n}\r\n\r\nfunction deleteOneDrink(drinkId: number): Drink | undefined {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  const index = drinks.findIndex((drink) => drink.id === drinkId);\r\n  if (index === -1) {\r\n    return undefined;\r\n  }\r\n\r\n  const deletedElements = drinks.splice(index, 1);\r\n  serialize(jsonDbPath, drinks);\r\n  return deletedElements[0];\r\n}\r\n\r\nfunction updateOneDrink(\r\n  drinkId: number,\r\n  newDrink: Partial<NewDrink>\r\n): Drink | undefined {\r\n  const drinks = parse(jsonDbPath, defaultDrinks);\r\n  const drink = drinks.find((drink) => drink.id === drinkId);\r\n  if (!drink) {\r\n    return undefined;\r\n  }\r\n\r\n  if (newDrink.title !== undefined) {\r\n    drink.title = newDrink.title!; // the router already checks for the presence of title\r\n  }\r\n  if (newDrink.image !== undefined) {\r\n    drink.image = newDrink.image!;\r\n  }\r\n  if (newDrink.volume !== undefined) {\r\n    drink.volume = newDrink.volume!;\r\n  }\r\n  if (newDrink.price !== undefined) {\r\n    drink.price = newDrink.price!;\r\n  }\r\n\r\n  serialize(jsonDbPath, drinks);\r\n  return drink;\r\n}\r\n\r\nexport {\r\n  readAllDrinks,\r\n  readOneDrink,\r\n  createOneDrink,\r\n  deleteOneDrink,\r\n  updateOneDrink,\r\n};\n')),"\n",l.createElement(n.p,null,"Maintenant, nous allons mettre Ã  jour le router ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/drinks.ts"))," afin de faire les appels aux fonctions offertes par le modÃ¨le :"),"\n",l.createElement(n.pre,{numbered:!0},l.createElement(n.code,{className:"language-ts"},'import { Router } from "express";\r\nimport { NewDrink } from "../types";\r\nimport {\r\n  createOneDrink,\r\n  deleteOneDrink,\r\n  readAllDrinks,\r\n  readOneDrink,\r\n  updateOneDrink,\r\n} from "../services/drinks";\r\n\r\nconst router = Router();\r\n\r\nrouter.get("/", (req, res) => {\r\n  const budgetMax = Number(req.query["budget-max"]);\r\n  const drinks = readAllDrinks(budgetMax);\r\n  return res.json(drinks);\r\n});\r\n\r\nrouter.get("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const drink = readOneDrink(id);\r\n  if (!drink) {\r\n    return res.sendStatus(404);\r\n  }\r\n  return res.json(drink);\r\n});\r\n\r\nrouter.post("/", (req, res) => {\r\n  const body: unknown = req.body;\r\n  if (\r\n    !body ||\r\n    typeof body !== "object" ||\r\n    !("title" in body) ||\r\n    !("image" in body) ||\r\n    !("volume" in body) ||\r\n    !("price" in body) ||\r\n    typeof body.title !== "string" ||\r\n    typeof body.image !== "string" ||\r\n    typeof body.volume !== "number" ||\r\n    typeof body.price !== "number" ||\r\n    !body.title.trim() ||\r\n    !body.image.trim() ||\r\n    body.volume <= 0 ||\r\n    body.price <= 0\r\n  ) {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const { title, image, volume, price } = body as NewDrink;\r\n\r\n  const newDrink = createOneDrink({ title, image, volume, price });\r\n  return res.json(newDrink);\r\n});\r\n\r\nrouter.delete("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const deletedDrink = deleteOneDrink(id);\r\n  if (!deletedDrink) {\r\n    return res.sendStatus(404);\r\n  }\r\n  return res.json(deletedDrink);\r\n});\r\n\r\nrouter.patch("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n\r\n  const body: unknown = req.body;\r\n\r\n  if (\r\n    !body ||\r\n    typeof body !== "object" ||\r\n    ("title" in body &&\r\n      (typeof body.title !== "string" || !body.title.trim())) ||\r\n    ("image" in body &&\r\n      (typeof body.image !== "string" || !body.image.trim())) ||\r\n    ("volume" in body &&\r\n      (typeof body.volume !== "number" || body.volume <= 0)) ||\r\n    ("price" in body && (typeof body.price !== "number" || body.price <= 0))\r\n  ) {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const { title, image, volume, price }: Partial<NewDrink> = body;\r\n\r\n  const updatedDrink = updateOneDrink(id, { title, image, volume, price });\r\n\r\n  if (!updatedDrink) {\r\n    return res.sendStatus(404);\r\n  }\r\n\r\n  return res.json(updatedDrink);\r\n});\r\n\r\nexport default router;\n')),"\n",l.createElement(n.p,null,"Lancer votre API soit via le debugger, soit via la commande ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm run dev")),".",l.createElement(n.br),"\n","Veuillez ensuite tester que les opÃ©rations sur les boissons fonctionnent bien en exÃ©cutant les requÃªtes HTTP dÃ©jÃ  prÃ©sentes dans le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"REST Client"))," du boilerplate."),"\n",l.createElement(n.p,null,'Maintenant, nous allons aussi mettre Ã  jour l\'architecture pour traiter des ressources de type "pizzas". Veuillez crÃ©er un fichier ',l.createElement(n.strong,null,l.createElement(n.code,null,"/services/pizzas.ts"))," :"),"\n",l.createElement(n.pre,{numbered:!0},l.createElement(n.code,{className:"language-ts"},'// Create the pizzas service based on the drinks.ts service\r\nimport path from "node:path";\r\nimport { Pizza, NewPizza } from "../types";\r\nimport { parse, serialize } from "../utils/json";\r\nconst jsonDbPath = path.join(__dirname, "/../data/pizzas.json");\r\n\r\nconst defaultPizzas: Pizza[] = [\r\n  {\r\n    id: 1,\r\n    title: "4 fromages",\r\n    content: "GruyÃ¨re, SÃ©rac, Appenzel, Gorgonzola, Tomates",\r\n  },\r\n  {\r\n    id: 2,\r\n    title: "Vegan",\r\n    content: "Tomates, Courgettes, Oignons, Aubergines, Poivrons",\r\n  },\r\n  {\r\n    id: 3,\r\n    title: "Vegetarian",\r\n    content: "Mozarella, Tomates, Oignons, Poivrons, Champignons, Olives",\r\n  },\r\n  {\r\n    id: 4,\r\n    title: "Alpage",\r\n    content: "GruyÃ¨re, Mozarella, Lardons, Tomates",\r\n  },\r\n  {\r\n    id: 5,\r\n    title: "Diable",\r\n    content: "Tomates, Mozarella, Chorizo piquant, Jalapenos",\r\n  },\r\n];\r\n\r\nfunction readAllPizzas(order: string | undefined): Pizza[] {\r\n  const orderByTitle = order && order.includes("title") ? order : undefined;\r\n\r\n  let orderedMenu: Pizza[] = [];\r\n  const pizzas = parse(jsonDbPath, defaultPizzas);\r\n  if (orderByTitle)\r\n    orderedMenu = [...pizzas].sort((a, b) => a.title.localeCompare(b.title));\r\n\r\n  if (orderByTitle === "-title") orderedMenu = orderedMenu.reverse();\r\n\r\n  return orderedMenu.length === 0 ? pizzas : orderedMenu;\r\n}\r\n\r\nfunction readPizzaById(id: number): Pizza | undefined {\r\n  const pizzas = parse(jsonDbPath, defaultPizzas);\r\n  return pizzas.find((pizza) => pizza.id === id);\r\n}\r\n\r\nfunction createPizza(newPizza: NewPizza): Pizza {\r\n  const pizzas = parse(jsonDbPath, defaultPizzas);\r\n  const lastId = pizzas[pizzas.length - 1].id;\r\n  const pizza: Pizza = { id: lastId + 1, ...newPizza };\r\n  const updatedPizzas = [...pizzas, pizza];\r\n  serialize(jsonDbPath, updatedPizzas);\r\n  return pizza;\r\n}\r\n\r\nfunction deletePizza(id: number): Pizza | undefined {\r\n  const pizzas = parse(jsonDbPath, defaultPizzas);\r\n  const index = pizzas.findIndex((pizza) => pizza.id === id);\r\n  if (index === -1) return undefined;\r\n\r\n  const deletedElements = pizzas.splice(index, 1);\r\n  serialize(jsonDbPath, pizzas);\r\n  return deletedElements[0];\r\n}\r\n\r\nfunction updatePizza(\r\n  id: number,\r\n  updatedPizza: Partial<NewPizza>\r\n): Pizza | undefined {\r\n  const pizzas = parse(jsonDbPath, defaultPizzas);\r\n  const pizza = pizzas.find((pizza) => pizza.id === id);\r\n  if (!pizza) return undefined;\r\n\r\n  if (updatedPizza.title !== undefined) {\r\n    pizza.title = updatedPizza.title;\r\n  }\r\n  if (updatedPizza.content !== undefined) {\r\n    pizza.content = updatedPizza.content;\r\n  }\r\n\r\n  serialize(jsonDbPath, pizzas);\r\n  return pizza;\r\n}\r\n\r\nexport { readAllPizzas, readPizzaById, createPizza, deletePizza, updatePizza };\n')),"\n",l.createElement(n.p,null,"Et le router ",l.createElement(n.strong,null,l.createElement(n.code,null,"/routes/pizzas.ts"))," doit aussi Ãªtre mis Ã  jour :"),"\n",l.createElement(n.pre,{numbered:!0},l.createElement(n.code,{className:"language-ts"},'import { Router } from "express";\r\n\r\nimport { NewPizza, PizzaToUpdate } from "../types";\r\nimport {\r\n  createPizza,\r\n  deletePizza,\r\n  readAllPizzas,\r\n  readPizzaById,\r\n  updatePizza,\r\n} from "../services/pizzas";\r\n\r\nconst router = Router();\r\n\r\nrouter.get("/error", (_req, _res, _next) => {\r\n  throw new Error("This is an error");\r\n  // equivalent of next(new Error("This is an error"));\r\n});\r\n\r\n/* Read all the pizzas from the menu\r\n   GET /pizzas?order=title : ascending order by title\r\n   GET /pizzas?order=-title : descending order by title\r\n*/\r\nrouter.get("/", (req, res) => {\r\n  if (req.query.order && typeof req.query.order !== "string") {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const pizzas = readAllPizzas(req.query.order);\r\n  return res.json(pizzas);\r\n});\r\n\r\n// Read the pizza identified by an id in the menu\r\nrouter.get("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const pizza = readPizzaById(id);\r\n  if (!pizza) return res.sendStatus(404);\r\n  return res.json(pizza);\r\n});\r\n\r\n// Create a pizza to be added to the menu.\r\nrouter.post("/", (req, res) => {\r\n  const body: unknown = req.body;\r\n  if (\r\n    !body ||\r\n    typeof body !== "object" ||\r\n    !("title" in body) ||\r\n    !("content" in body) ||\r\n    typeof body.title !== "string" ||\r\n    typeof body.content !== "string" ||\r\n    !body.title.trim() ||\r\n    !body.content.trim()\r\n  ) {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const { title, content } = body as NewPizza;\r\n\r\n  const addedPizza = createPizza({ title, content });\r\n\r\n  return res.json(addedPizza);\r\n});\r\n\r\n// Delete a pizza from the menu based on its id\r\nrouter.delete("/:id", (req, res) => {\r\n  const id = Number(req.params.id);\r\n  const deletedPizza = deletePizza(id);\r\n  if (!deletedPizza) return res.sendStatus(404);\r\n\r\n  return res.json(deletedPizza);\r\n});\r\n\r\n// Update a pizza based on its id and new values for its parameters\r\nrouter.patch("/:id", (req, res) => {\r\n  const body: unknown = req.body;\r\n  if (\r\n    !body ||\r\n    typeof body !== "object" ||\r\n    ("title" in body &&\r\n      (typeof body.title !== "string" || !body.title.trim())) ||\r\n    ("content" in body &&\r\n      (typeof body.content !== "string" || !body.content.trim()))\r\n  ) {\r\n    return res.sendStatus(400);\r\n  }\r\n\r\n  const pizzaToUpdate: PizzaToUpdate = body;\r\n\r\n  const id = Number(req.params.id);\r\n  const updatedPizza = updatePizza(id, pizzaToUpdate);\r\n  if (!updatedPizza) return res.sendStatus(404);\r\n\r\n  return res.json(updatedPizza);\r\n});\r\n\r\nexport default router;\n')),"\n",l.createElement(n.p,null,"Lancer votre API soit via le debugger, soit via la commande ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm run dev")),".",l.createElement(n.br),"\n","Veuillez ensuite tester que tout fonctionne bien en exÃ©cutant quelques requÃªtes HTTP associÃ©es aux pizzas et dÃ©jÃ  prÃ©sentes dans le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"REST Client"))," du boilerplate."),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez accÃ©der au code du tutoriel ici :\r\n",l.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/back/api/services"},"services"),"."),"\n",l.createElement(n.h1,null,l.createElement(d,null," Exercice 1.8 : Refactoring Ã  l'aide d'un service ")),"\n",l.createElement(n.p,null,"Vous allez faire un nouveau refactor de la RESTful API de ",l.createElement(n.strong,null,"myMovies"),", afin de restructurer l'application selon l'architecture recommandÃ©e, en utilisant un service pour gÃ©rer les opÃ©rations sur les films."),"\n",l.createElement(n.p,null,"Veuillez repartir du code de la solution de votre ",l.createElement(n.a,{href:"../json/#exercice_1_7_persistance_des_donnees"},"Exercice 1.7"),".",l.createElement(n.br),"\n","Le code de votre application doit se trouver dans votre repo git dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"/exercises/1.8")),"."),"\n",l.createElement(n.p,null,"Veuillez faire un refactor de votre API gÃ©rant les films afin que tout ce qui traite des opÃ©rations sur les ressources soit fait au sein du service ",l.createElement(n.strong,null,l.createElement(n.code,null,"/services/films.ts")),"."),"\n",l.createElement(n.p,null,"Veuillez tester que votre API fonctionne toujours aussi bien aprÃ¨s le refactoring."),"\n",l.createElement(n.p,null,"Veuillez faire un ",l.createElement(n.strong,null,l.createElement(n.code,null,"commit"))," de votre code avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new: ex1.8")),"."),"\n",l.createElement(n.h1,null,l.createElement(d,null," Exercice 1.9 : Encore un service ")),"\n",l.createElement(n.p,null,"Vous allez crÃ©er une nouvelle API mettant Ã  disposition des opÃ©rations CRUD (",l.createElement(n.strong,null,"C"),"reate, ",l.createElement(n.strong,null,"R"),"ead, ",l.createElement(n.strong,null,"U"),"pdate & ",l.createElement(n.strong,null,"D"),'elete) sur des ressources de type "texte Ã  dactylographier".'),"\n",l.createElement(n.p,null,"Vous devez appliquer les outils de dÃ©veloppement et l'architecture recommandÃ©e dans ce cours-ci en mettant en place un service."),"\n",l.createElement(n.p,null,"Pour ce faire, veuillez crÃ©er un nouveau projet dans votre repo git dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"/exercises/1.9"))," sur base du boilerplate ",l.createElement(n.a,{href:"https://github.com/e-vinci/basic-ts-api-boilerplate"},"basic-ts-api-boilerplate")," ou sur base de votre exercice prÃ©cÃ©dent (",l.createElement(n.strong,null,l.createElement(n.code,null,"/exercises/1.8")),")."),"\n",l.createElement(n.p,null,"âš¡ Si vous avez fait un clone du boilerplate, attention au Git dans le Git, n'oubliez pas de supprimer le dossier ",l.createElement(n.strong,null,l.createElement(n.code,null,".git"))," prÃ©sent dans votre nouveau projet."),"\n",l.createElement(n.p,null,"Un texte Ã  dactylographier contient comme propriÃ©tÃ©s :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"id"))," : un uuid gÃ©nÃ©rÃ© via la librairie ",l.createElement(n.a,{href:"https://www.npmjs.com/package/uuid"},"https://www.npmjs.com/package/uuid")," ;"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"content"))," : un contenu textuel ;"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"level"))," : le niveau associÃ© au texte; les seules valeurs autorisÃ©es sont : ",l.createElement(n.strong,null,"easy"),", ",l.createElement(n.strong,null,"medium")," et ",l.createElement(n.strong,null,"hard"),"."),"\n"),"\n",l.createElement(n.p,null,"Voici le tableau formalisant toutes les opÃ©rations que vous devez implÃ©menter :"),"\n",l.createElement(n.table,null,l.createElement(n.thead,null,l.createElement(n.tr,null,l.createElement(n.th,null,"URI"),l.createElement(n.th,null,"MÃ©thode"),l.createElement(n.th,null,"MÃ©thode"))),l.createElement(n.tbody,null,l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"texts"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ALL : Lire toutes les ressources de la collection")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"texts?level=value"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ALL FILTERED : Lire toutes les ressources de la collection selon le filtre donnÃ©")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"texts/:id"))),l.createElement(n.td,null,"GET"),l.createElement(n.td,null,"READ ONE : Lire la ressource identifiÃ©e")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"texts"))),l.createElement(n.td,null,"POST"),l.createElement(n.td,null,"CREATE ONE : CrÃ©er une ressource basÃ©e sur les donnÃ©es de la requÃªte")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"texts/:id"))),l.createElement(n.td,null,"DELETE"),l.createElement(n.td,null,"DELETE ONE : Effacer la ressource identifiÃ©e")),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"texts/:id"))),l.createElement(n.td,null,"PUT"),l.createElement(n.td,null,"UPDATE ONE : Remplacer l'entiÃ¨retÃ© de la ressource par les donnÃ©es de la requÃªte")))),"\n",l.createElement("br"),"\n",l.createElement(n.p,null,"Veuillez bien valider les valeurs des paramÃ¨tres. Notamment, une ",l.createElement(n.strong,null,l.createElement(n.code,null,"level"))," doit Ãªtre compris dans les valeurs autorisÃ©es, sinon un code d'erreur appropriÃ© doit Ãªtre renvoyÃ©."),"\n",l.createElement(n.p,null,"Veuillez tester toutes les mÃ©thodes offertes par votre application Ã  l'aide du client HTTP de REST Client."),"\n",l.createElement(n.h4,null,"ðŸ¤ Tips"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"Pour utiliser la librairie ",l.createElement(n.strong,null,l.createElement(n.code,null,"uuid")),", consultez la documentation en ligne : ",l.createElement(n.a,{href:"https://www.npmjs.com/package/uuid"},"https://www.npmjs.com/package/uuid")),"\n",l.createElement(n.li,null,"Si vous avez oubliÃ© d'installer les dÃ©finitions de type pour ",l.createElement(n.strong,null,l.createElement(n.code,null,"uuid")),", vous pouvez le faire via la commande ",l.createElement(n.strong,null,l.createElement(n.code,null,"npm install --save-dev @types/uuid")),". Pour rappel, cela est expliquÃ© dans l'",l.createElement(n.a,{href:"../../part0/nodejs-app/#introduction_aux_packages_node_js_npm"},"Introduction aux packages Node.js & npm"),' (voir "Installer un package").'),"\n"),"\n",l.createElement(n.p,null,"Veuillez faire un ",l.createElement(n.strong,null,l.createElement(n.code,null,"commit"))," de votre code avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new: ex1.9")),"."))}var i=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,t.RP)(),e.components);return n?l.createElement(n,e,l.createElement(a,e)):a(e)};function s(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var o=r(4810),u=r(2662),d=r(9640),c=r(5938),m=r(9460),p=r(7929),E=r(794),z=r(4092),f=r(4262),g=r(3528),b=r(9942),h=r(4698),k=r(2214),v=r(9838),P=(r(1262),r(1731)),y=r(7050),D=r(2483),x=r(4902),w=r(9294),j=r(7828),q=r(2035),A=r(5590);const I={Link:o.Link,Image:d.A,Section:c.A,Content:m.A,Background:p.A,SectionHeader:E.A,SectionFooter:z.A,PageHeader:f.A,CodeBlock:b.A,LinkFile:h.A,ScrollableImage:k.A,PublicProjectsView:v.A,AuthenticatedBlock:P.A,UnAuthenticatedBlock:y.A,NestedMdxBlock:D.A,YoutubeImage:x.A,InternalPageMenu:w.A,InternalPageMenuItem:j.A,InternalPageTitle:q.A,PathViewer:A.E,PathViewerItem:A.F};function T(e){var n,r,a,i,s;let{data:{mdx:o,allImages:d},children:c}=e;return I.PageHeader=(0,g.R)(f.A,null==o?void 0:o.frontmatter),l.createElement(u.A,Object.assign({},null!=o&&o.frontmatter?{frontmatter:o.frontmatter}:{},null!=o&&null!==(n=o.frontmatter)&&void 0!==n&&n.navbarExtraStyles?{navbarExtraStyles:o.frontmatter.navbarExtraStyles}:{},null!=o&&null!==(r=o.frontmatter)&&void 0!==r&&r.headerImage?{headerImage:o.frontmatter.headerImage}:{},null!=o&&null!==(a=o.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:o.frontmatter.featuredImage}:{},null!=o&&null!==(i=o.frontmatter)&&void 0!==i&&i.title?{pageTitle:o.frontmatter.title}:{},d&&d.length>0?{allImages:d}:{}),l.createElement(t.xA,{components:I},l.createElement("div",{className:null!=o&&null!==(s=o.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},c)))}function M(e){return l.createElement(T,e,l.createElement(i,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-1-refactoring-fr-mdx-3c206ee8d5303a4f1f01.js.map