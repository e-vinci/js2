"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[5037],{8653:function(e,n,t){t.r(n),t.d(n,{default:function(){return k}});var r=t(5680),l=t(6540);function a(e){const n=Object.assign({h1:"h1",p:"p",strong:"strong",ul:"ul",li:"li",h2:"h2",code:"code",pre:"pre",br:"br",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",a:"a",em:"em",h4:"h4"},(0,r.RP)(),e.components),{InternalPageMenu:t,PathViewer:a,PathViewerItem:o,InternalPageMenuItem:u,InternalPageTitle:i}=n;return t||s("InternalPageMenu",!0),u||s("InternalPageMenuItem",!0),i||s("InternalPageTitle",!0),a||s("PathViewer",!0),o||s("PathViewerItem",!0),l.createElement(l.Fragment,null,l.createElement(n.h1,null,"c) S√©curisation d'un frontend"),"\n",l.createElement(t,null,l.createElement(a,null,l.createElement(o,{to:"/"}," web2course "),l.createElement(o,{to:"/part3"}," Partie 3 "),l.createElement(o,{selected:!0}," c) Sessions & JWT ")),l.createElement(u,null," O√π sauvegarder de l'info dans un browser ? "),l.createElement(u,null," Persistance de donn√©es de session via le web storage "),l.createElement(u,null," Exercice 3.3 : Persistence d'un th√®me  "),l.createElement(u,null," Authentification d'un utilisateur via une IHM & JWT "),l.createElement(u,null," Sauvegarde des donn√©es de session "),l.createElement(u,null," D√©connexion d'un utilisateur "),l.createElement(u,null," Autorisation de l'appel √† une op√©ration prot√©g√©e "),l.createElement(u,null," Exercice 3.4 : Authentification et appel d'op√©rations prot√©g√©es par JWT "),l.createElement(u,null," Exercice 3.4b : Modification de ressources & JWT "),l.createElement(u,null," üç¨ Persistance de donn√©es de session via des cookies ")),"\n",l.createElement(n.h1,null,l.createElement(i,null," O√π sauvegarder de l'info dans un browser ? ")),"\n",l.createElement(n.p,null,"Nous avons vu qu'une des exigences associ√©es √† la cr√©ation d'une application selon l'architecture REST, c'est qu'elle soit ",l.createElement(n.strong,null,"stateless")," : l'API ne peut pas garder l'√©tat du client, sa session, c√¥t√© serveur."),"\n",l.createElement(n.p,null,"C'est donc au client de sauvegarder ses donn√©es de session."),"\n",l.createElement(n.p,null,"Mais o√π pouvons nous sauvegarder des donn√©es de mani√®re persistante c√¥t√© client ?"),"\n",l.createElement(n.p,null,"Il existe deux fa√ßons principales de sauvegarder de l'info dans un browser :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"le ",l.createElement(n.strong,null,"web storage")," ;"),"\n",l.createElement(n.li,null,"les ",l.createElement(n.strong,null,"cookies"),"."),"\n"),"\n",l.createElement(n.p,null,"Dans le cadre de ce cours, nous allons principalement voir comment sauvegarder de l'info √† l'aide du ",l.createElement(n.strong,null,"web storage"),". Dans la partie du cours sur la gestion de l'authentification et l'autorisation d'utilisateurs, vous pourrez optionnellement voir comment les cookies peuvent √™tre utilis√©s pour sauvegarder des donn√©es de session c√¥t√© client."),"\n",l.createElement(n.p,null,"NB : le browser met √† disposition d'autres API un peu moins connues pour sauvegarder des infos. Nous ne les verrons pas dans le cadre de ce cours, mais il reste n√©anmoins int√©ressant de lire tr√®s rapidement de quoi il s'agit :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"IndexedDB API")," : permet de sauvegarder c√¥t√© client de grandes quantit√©s d'infos structur√©es, incluant des fichiers ; c'est une base de donn√©es orient√©e objets en JS qui permet les transactions."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Cache API")," : permet d'enregistrer et retrouver des requ√™tes et leur r√©ponses. Bien qu'√† la base cr√©√© pour pouvoir fournir des r√©ponses plus rapides √† certaines requ√™tes, cette API peut aussi √™tre utilis√©e comme m√©canisme g√©n√©ral de stockage."),"\n"),"\n",l.createElement(n.h1,null,l.createElement(i,null," Persistance de donn√©es de session via le web storage ")),"\n",l.createElement(n.h2,null,"Introduction"),"\n",l.createElement(n.p,null,"Le ",l.createElement(n.strong,null,"Web Storage API")," fournit un m√©canisme permettant aux browser d'enregistrer des paires ",l.createElement(n.strong,null,"cl√© / valeur")," d'une mani√®re plus intuitive que l'utilisation de cookies."),"\n",l.createElement(n.p,null,"Il existe deux m√©canismes au sein du web storage :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"sessionStorage"))," :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"offre un espace de stockage s√©par√© pour chaque origine pour la dur√©e de la session d'une page, tant que le browser est ouvert."),"\n",l.createElement(n.li,null,"les cl√©s / valeurs y sont enregistr√©es sous forme de string uniquement ;"),"\n",l.createElement(n.li,null,"met √† disposition un espace de stockage plus grand qu'un cookie, ~5MB maximum par origine ;"),"\n"),"\n"),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"localStorage"))," :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"offre aussi un espace de stockage s√©par√© pour chaque origine, mais les donn√©es persistent quand le browser est ferm√© et rouvert ;"),"\n",l.createElement(n.li,null,"est un espace de stockage plus grand qu'un cookie, limit√© √† ~10MB en cas de crash/restart du browser."),"\n"),"\n"),"\n"),"\n",l.createElement(n.p,null,"Les principales m√©thodes offertes par ",l.createElement(n.strong,null,l.createElement(n.code,null,"sessionStorage"))," et ",l.createElement(n.strong,null,l.createElement(n.code,null,"localStorage"))," sont les m√™mes. Voici quelques exemples de codes par m√©thode."),"\n",l.createElement(n.h2,null,l.createElement(n.code,null,"setItem()")),"\n",l.createElement(n.p,null,"Cette m√©thode permet d'enregistrer, pour une cl√© donn√©e, la valeur associ√©e :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"4-5"},l.createElement(n.code,{className:"language-ts"},"const¬†storeName¬†=¬†'user';\r\n\r\nconst¬†setUserSessionData¬†=¬†(user)¬†=>¬†{\r\n¬†¬†const¬†storageValue¬†=¬†JSON.stringify(user);\r\n¬†¬†localStorage.setItem(storeName,¬†storageValue);\r\n};\n")),"\n",l.createElement(n.p,null,"Pour enregistrer un objet JS sous forme de string, il suffit de le s√©rialiser √† l'aide de la m√©thode ",l.createElement(n.code,null,"JSON.stringify()"),"."),"\n",l.createElement(n.h2,null,l.createElement(n.code,null,"getItem()")),"\n",l.createElement(n.p,null,"Cette m√©thode permet d'obtenir la valeur associ√©e √† la cl√© donn√©e en argument :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"4,6"},l.createElement(n.code,{className:"language-ts"},"const storeName =¬†'user';\r\n\r\nconst¬†getUserSessionData¬†=¬†()¬†=>¬†{\r\n¬†¬†const¬†retrievedUser¬†=¬†localStorage.getItem(storeName);\r\n¬†¬†if¬†(!retrievedUser)¬†return;\r\n¬†¬†return¬†JSON.parse(retrievedUser);\r\n};\n")),"\n",l.createElement(n.p,null,"Pour cet exemple, comme la valeur a √©t√© s√©rialis√©e, nous pouvons r√©cup√©rer l'objet gr√¢ce √† la m√©thode ",l.createElement(n.strong,null,l.createElement(n.code,null,"JSON.parse()")),"."),"\n",l.createElement(n.h2,null,l.createElement(n.code,null,"removeITem()")),"\n",l.createElement(n.p,null,"Cette m√©thode permet d'effacer une cl√© / valeur :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"4"},l.createElement(n.code,{className:"language-ts"},"const storeName =¬†'user';\r\n\r\nconst¬†removeSessionData¬†=¬†()¬†=>¬†{\r\n¬†¬†localStorage.removeItem(storeName);\r\n};\n")),"\n",l.createElement(n.h2,null,l.createElement(n.code,null,"clear()")),"\n",l.createElement(n.p,null,"Cette m√©thode permet d'effacer tout l'espace de stockage pour une origine donn√©e."),"\n",l.createElement(n.p,null,"Cette m√©thode est tr√®s utile lorsque l'on souhaite effacer toute la session d'un utilisateur, notamment lors du logout d'un utilisateur."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Exercice 3.3 : Persistence d'un th√®me ")),"\n",l.createElement(n.p,null,"Veuillez partir d'une copie de l'exercice (",l.createElement(n.code,null,"/exercises/2.15b"),") pour cr√©er un nouveau projet nomm√© ",l.createElement(n.code,null,"exercises/3.3-4")," afin de continuer l'application ",l.createElement(n.code,null,"myMovies"),"."),"\n",l.createElement(n.p,null,'Vous devez ajouter un moyen de switcher d\'un th√®me "light" ou "dark" au sein de votre application.'),"\n",l.createElement(n.p,null,"Par exemple, vous pouvez le faire via un bouton dans le header ou le footer permettant de basculer d'un th√®me √† l'autre."),"\n",l.createElement(n.p,null,"L'effet du th√®me doit √™tre visible seulement sur le footer et le header... Il n'est pas n√©cessaire de faire un th√®me \"dark\" complet sur la page. Veuillez donc changer les couleurs des backgrounds du header & du footer et de certains de leurs textes en fonction du th√®me."),"\n",l.createElement(n.p,null,"Vous devez sauvegarder le th√®me s√©lectionn√© par l'utilisateur comme donn√©e de session persistante. Ainsi, vous allez sauvegarder l'information du th√®me dans le ",l.createElement(n.code,null,"localStorage"),"."),"\n",l.createElement(n.p,null,"Au red√©marrage du browser, ou lors du refresh du frontend, l'application doit toujours afficher ses √©crans selon le dernier th√®me s√©lectionn√©."),"\n",l.createElement(n.p,null,"Une fois tout fonctionnel, veuillez faire un commit avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new:ex3.3")),"."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Authentification d'un utilisateur via une IHM & JWT ")),"\n",l.createElement(n.p,null,"Pour authentifier un utilisateur via une IHM, il suffit de faire une requ√™te √† une RESTful API."),"\n",l.createElement(n.p,null,"G√©n√©ralement, l'utilisateur devra d'abord cr√©er son compte. Il utilisera un formulaire demandant au minimum un identifiant (username, adresse e-mail ou autres) et un password.",l.createElement(n.br),"\n","Dans le cadre d'une SPA, l'IHM fera appel √† une op√©ration de type ",l.createElement(n.code,null,"register")," lorsque l'utilisateur soumet le formulaire."),"\n",l.createElement(n.p,null,"Par la suite, lorsque le compte de l'utilisateur existe, l'IHM fera appel √† une op√©ration de type ",l.createElement(n.code,null,"login")," lorsque l'utilisateur tentera de se connecter √† l'aide d'un formulaire."),"\n",l.createElement(n.p,null,"Dans les deux cas, ",l.createElement(n.code,null,"register")," ou ",l.createElement(n.code,null,"login"),", le d√©veloppeur devra conna√Ætre les op√©rations mises √† disposition par l'API."),"\n",l.createElement(n.p,null,"Dans le cadre du site de la pizzeria, nous savons que l'API met √† disposition ces deux op√©rations :"),"\n",l.createElement(n.table,null,l.createElement(n.thead,null,l.createElement(n.tr,null,l.createElement(n.th,null,"URI"),l.createElement(n.th,null,"M√©thode HTTP"),l.createElement(n.th,null,"Op√©ration"))),l.createElement(n.tbody,null,l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"auths/login"))),l.createElement(n.td,null,l.createElement(n.strong,null,"POST")),l.createElement(n.td,null,'V√©rifier les credentials d\'une ressource de type "users" et renvoyer le username et un token JWT si les credentials sont OK')),l.createElement(n.tr,null,l.createElement(n.td,null,l.createElement(n.strong,null,l.createElement(n.code,null,"auths/register"))),l.createElement(n.td,null,l.createElement(n.strong,null,"POST")),l.createElement(n.td,null,'Cr√©er une ressource de type "users" et renvoyer le username et un token JWT')))),"\n",l.createElement("br"),"\n",l.createElement(n.p,null,"Pour ce tutoriel, veuillez cr√©er une copie du tutoriel ",l.createElement(n.code,null,"fetch-proxy"),", si n√©cessaire voici le code du tutoriel ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/front/fetch-proxy"},"fetch-proxy"),", et l'appeler ",l.createElement(n.code,null,"session-jwt"),". Changez le nom du projet dans ",l.createElement(n.code,null,"package.json"),"."),"\n",l.createElement(n.p,null,"Veuillez d√©marrer la version ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/auths"},"auths")," de l'API de la pizzeria."),"\n",l.createElement(n.p,null,"Pour notre tutoriel, nous avons besoin de cr√©er deux nouvelles pages :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.code,null,"RegisterPage")," qui offrira un formulaire pour cr√©er un compte utilisateur ; nous consid√©rons qu'un utilisateur qui vient d'√™tre cr√©√© est connect√© (il ne doit donc pas se loguer)."),"\n",l.createElement(n.li,null,l.createElement(n.code,null,"LoginPage")," qui offrira un formulaire pour se connecter √† son compte utilisateur."),"\n"),"\n",l.createElement(n.p,null,"Nous allons commencer par ",l.createElement(n.code,null,"RegisterPage"),"."),"\n",l.createElement(n.p,null,"üí≠ Tr√®s souvent, nous allons devoir penser si c'est √† ",l.createElement(n.code,null,"RegisterPage")," de faire le fetch des donn√©es, ou si ce fetch doit √™tre fait ailleurs."),"\n",l.createElement(n.p,null,"S'il n'y a pas d'√©tat associ√© √† une op√©ration de \"register\", alors tout serait OK de faire le fetch dans ",l.createElement(n.code,null,"RegisterPage"),". N√©anmoins, si un utilisateur est connect√©, il va falloir mettre  jour la ",l.createElement(n.code,null,"Navbar"),"... et qui dit mise √† jour de la UI, dit gestion de l'√©tat...",l.createElement(n.br),"\n","Ainsi, nous nous rendons compte qu'il est important de d√©finir une variable d'√©tat qui correspondra √† l'utilisateur connect√©, et qui nous permettra notamment d'afficher le nom de l'utilisateur connect√©, d'afficher dynamiquement la ",l.createElement(n.code,null,"Navbar")," (quand on est connect√©, les √©l√©ments de la barre permettant de cr√©er un compte ou de se connecter doivent dispara√Ætre...)."),"\n",l.createElement(n.p,null,"Notons que nous souhaitons appliquer le m√™me format √† tous les formulaires de chacune des pages. D√®s lors, le plus direct est de renommer ",l.createElement(n.code,null,"AddPizzaPage.css")," en ",l.createElement(n.code,null,"index.css"),". Nous allons utiliser ",l.createElement(n.code,null,"index.css")," tant dans ",l.createElement(n.code,null,"AddPizzaPage")," que ",l.createElement(n.code,null,"RegisterPage")," (et plus tard ",l.createElement(n.code,null,"LoginPage"),")."),"\n",l.createElement(n.p,null,"Ainsi, nous allons d√©finir le fetch du register au sein de ",l.createElement(n.code,null,"App")," en y ajoutant la nouvelle fonction ",l.createElement(n.code,null,"registerUser"),", en mettant √† jour le contexte, et en cr√©ant une nouvelle variable d'√©tat ",l.createElement(n.code,null,"authenticatedUser")," (associ√© √† un nouveau type ",l.createElement(n.code,null,"MaybeAuthenticatedUser")," construit sur ",l.createElement(n.code,null,"AuthenticatedUser"),") :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"5-30,41"},l.createElement(n.code,{className:"language-tsx"},'// code existant\r\nconst [authenticatedUser, setAuthenticatedUser] =\r\n    useState<MaybeAuthenticatedUser>(undefined);\r\n// ...\r\nconst registerUser = async (newUser: User) => {\r\n    try {\r\n      const options = {\r\n        method: "POST",\r\n        body: JSON.stringify(newUser),\r\n        headers: {\r\n          "Content-Type": "application/json",\r\n        },\r\n      };\r\n\r\n      const response = await fetch("/api/auths/register", options);\r\n\r\n      if (!response.ok)\r\n        throw new Error(\r\n          `fetch error : ${response.status} : ${response.statusText}`\r\n        );\r\n\r\n      const createdUser: AuthenticatedUser = await response.json();\r\n\r\n      setAuthenticatedUser(createdUser);\r\n      console.log("createdUser: ", createdUser);\r\n    } catch (err) {\r\n      console.error("registerUser::error: ", err);\r\n      throw err;\r\n    }\r\n  }\r\n  // reste du code\r\n\r\n  const fullPizzaContext: PizzeriaContext = {\r\n    addPizza,\r\n    pizzas,\r\n    setPizzas,\r\n    actionToBePerformed,\r\n    setActionToBePerformed,\r\n    clearActionToBePerformed,\r\n    drinks,\r\n    registerUser,\r\n  };\n')),"\n",l.createElement(n.p,null,"Comme le contexte a √©t√© mis √† jour, nous devons mettre √† jour le type associ√© ",l.createElement(n.code,null,"PizzeriaContext"),", ainsi que cr√©er :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"un nouveau type ",l.createElement(n.code,null,"User")),"\n",l.createElement(n.li,null,"un nouveau type ",l.createElement(n.code,null,"AuthenticatedUser")),"\n",l.createElement(n.li,null,"un nouveau type ",l.createElement(n.code,null,"MaybeAuthenticatedUser")," (qui est un ",l.createElement(n.code,null,"AuthenticatedUser")," ou `undefined)."),"\n"),"\n",l.createElement(n.p,null,"Pour cela, veuillez mettre √† jour ",l.createElement(n.code,null,"/src/types.ts")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"9,17-20,22,30-31"},l.createElement(n.code,{className:"language-ts"},"interface PizzeriaContext {\r\n  pizzas: Pizza[];\r\n  setPizzas: (pizzas: Pizza[]) => void;\r\n  actionToBePerformed: boolean;\r\n  setActionToBePerformed: (actionToBePerformed: boolean) => void;\r\n  clearActionToBePerformed: () => void;\r\n  drinks: Drink[];\r\n  addPizza: (newPizza: NewPizza) => Promise<void>;\r\n  registerUser: (newUser: User) => Promise<void>;\r\n}\r\n\r\ninterface User {\r\n  username: string;\r\n  password: string;\r\n}\r\n\r\ninterface AuthenticatedUser {\r\n  username: string;\r\n  token: string;\r\n}\r\n\r\ntype MaybeAuthenticatedUser = AuthenticatedUser | undefined;\r\n\r\nexport type {\r\n  Pizza,\r\n  NewPizza,\r\n  Drink,\r\n  PizzeriaContext,\r\n  User,\r\n  AuthenticatedUser,\r\n  MaybeAuthenticatedUser,\r\n};\n")),"\n",l.createElement(n.p,null,"Et voici le code de la nouvelle ",l.createElement(n.code,null,"RegisterPage")," (veuillez la cr√©er) qui fait appel au contexte pour r√©cup√©rer la fonction ",l.createElement(n.code,null,"registerUser")," :"),"\n",l.createElement(n.pre,{numbered:!0},l.createElement(n.code,{className:"language-tsx"},'import { useState, SyntheticEvent } from "react";\r\nimport "./index.css";\r\nimport { useNavigate, useOutletContext } from "react-router-dom";\r\nimport { PizzeriaContext } from "../../types";\r\n\r\nconst RegisterPage = () => {\r\n  const { registerUser }: PizzeriaContext = useOutletContext();\r\n\r\n  const navigate = useNavigate();\r\n  const [username, setUsername] = useState("");\r\n  const [password, setPassword] = useState("");\r\n\r\n  const handleSubmit = async (e: SyntheticEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      await registerUser({ username, password });\r\n      navigate("/");\r\n    } catch (err) {\r\n      console.error("RegisterPage::error: ", err);\r\n    }\r\n  };\r\n\r\n  const handleUsernameInputChange = (e: SyntheticEvent) => {\r\n    const input = e.target as HTMLInputElement;\r\n    setUsername(input.value);\r\n  };\r\n\r\n  const handlePasswordChange = (e: SyntheticEvent) => {\r\n    const input = e.target as HTMLInputElement;\r\n    setPassword(input.value);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h1>Ajoutez un utilisateur</h1>\r\n      <form onSubmit={handleSubmit}>\r\n        <label htmlFor="username">Username</label>\r\n        <input\r\n          value={username}\r\n          type="text"\r\n          id="username"\r\n          name="username"\r\n          onChange={handleUsernameInputChange}\r\n          required\r\n        />\r\n        <label htmlFor="password">Password</label>\r\n        <input\r\n          value={password}\r\n          type="text"\r\n          id="password"\r\n          name="password"\r\n          onChange={handlePasswordChange}\r\n          required\r\n        />\r\n        <button type="submit">Cr√©er le compte</button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RegisterPage;\n')),"\n",l.createElement(n.p,null,"Maintenant nous devons mettre √† jour la configuration de notre router pour offrir la ",l.createElement(n.code,null,"RegisterPage")," : pour ce faire, veuillez mettre √† jour ",l.createElement(n.code,null,"/src/main.tsx")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"14-17"},l.createElement(n.code,{className:"language-tsx"},'const router = createBrowserRouter([\r\n  {\r\n    path: "/",\r\n    element: <App />,\r\n    children: [\r\n      {\r\n        path: "",\r\n        element: <HomePage />,\r\n      },\r\n      {\r\n        path: "add-pizza",\r\n        element: <AddPizzaPage />,\r\n      },\r\n      {\r\n        path: "register",\r\n        element: <RegisterPage />,\r\n      },\r\n    ],\r\n  },\r\n]);\n')),"\n",l.createElement(n.p,null,"Il faut aussi mettre √† jour la ",l.createElement(n.code,null,"Navbar")," pour offrir un lien vers la ",l.createElement(n.code,null,"RegisterPage")," et avoir un affichage dynamique des √©l√©ments de navigation en fonction que les utilisateurs sont connect√©s ou non :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"1-3,5,8,15,17-23"},l.createElement(n.code,{className:"language-tsx"},'interface NavBarProps {\r\n  authenticatedUser: MaybeAuthenticatedUser;\r\n}\r\n\r\nconst NavBar = ({authenticatedUser} : NavBarProps) => {\r\n  const navigate = useNavigate();\r\n\r\n  if(authenticatedUser) {\r\n    return (\r\n      <nav>\r\n        <button onClick={() => navigate("/")}>Home</button>\r\n        <button onClick={() => navigate("/add-pizza")}>Ajouter une pizza</button>\r\n      </nav>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <nav>\r\n      <button onClick={() => navigate("/")}>Home</button>\r\n      <button onClick={() => navigate("/register")}>Cr√©er un utilisateur</button>\r\n      <button onClick={() => navigate("/login")}>Se connecter</button>\r\n    </nav>\r\n  );\r\n};\n')),"\n",l.createElement(n.p,null,"Ici nous avons ajout√© un param√®tre qui contiendra, l'√©ventuel ",l.createElement(n.code,null,"authenticatedUser")," si l'utilisateur vient de cr√©er son compte (ou s'il s'est logu√©, mais nous verrons √ßa plus tard)."),"\n",l.createElement(n.p,null,"Nous mettons donc √† jour le ",l.createElement(n.code,null,"return")," de ",l.createElement(n.code,null,"App")," afin de passer cette variable ",l.createElement(n.code,null,"authenticatedUser")," √† la ",l.createElement(n.code,null,"Navbar")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"9"},l.createElement(n.code,{className:"language-tsx"},'return (\r\n    <div className="page">\r\n      <Header\r\n        title="We love Pizza"\r\n        version={0 + 1}\r\n        handleHeaderClick={handleHeaderClick}\r\n      />\r\n      <main>\r\n        <NavBar authenticatedUser={authenticatedUser} />\r\n        <Outlet context={fullPizzaContext} />\r\n      </main>\r\n      <Footer />\r\n    </div>\r\n  );\n')),"\n",l.createElement(n.p,null,"Veuillez ex√©cuter le frontend (ainsi que l'API ",l.createElement(n.code,null,"auths"),") et vous assurer que l'utilisateur que vous tentez de cr√©er est bien cr√©√© par votre API."),"\n",l.createElement(n.p,null,"Veuillez utiliser le formulaire de cr√©ation de compte et v√©rifier que cela fonctionne. Une fois un nouveau compte cr√©√©, votre ",l.createElement(n.code,null,"Navbar")," ne devrait plus afficher ",l.createElement(n.code,null,"Cr√©er un utilisateur"),"."),"\n",l.createElement(n.p,null,"Nous allons maintenant apporter des modifications quasi identiques pour g√©rer la ",l.createElement(n.code,null,"LoginPage"),"."),"\n",l.createElement(n.p,null,"Commen√ßons par cr√©er la fonction ",l.createElement(n.code,null,"loginUser")," dans ",l.createElement(n.code,null,"App")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"1-26,39"},l.createElement(n.code,{className:"language-tsx"},'const loginUser = async (user: User) => {\r\n    try {\r\n      const options = {\r\n        method: "POST",\r\n        body: JSON.stringify(user),\r\n        headers: {\r\n          "Content-Type": "application/json",\r\n        },\r\n      };\r\n\r\n      const response = await fetch("/api/auths/login", options);\r\n\r\n      if (!response.ok)\r\n        throw new Error(\r\n          `fetch error : ${response.status} : ${response.statusText}`\r\n        );\r\n\r\n      const authenticatedUser: AuthenticatedUser = await response.json();\r\n      console.log("authenticatedUser: ", authenticatedUser);\r\n\r\n      setAuthenticatedUser(authenticatedUser);\r\n    } catch (err) {\r\n      console.error("loginUser::error: ", err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // Reste du code\r\n\r\n  const fullPizzaContext: PizzeriaContext = {\r\n    addPizza,\r\n    pizzas,\r\n    setPizzas,\r\n    actionToBePerformed,\r\n    setActionToBePerformed,\r\n    clearActionToBePerformed,\r\n    drinks,\r\n    registerUser,\r\n    loginUser,\r\n  };\n')),"\n",l.createElement(n.p,null,"Comme le contexte a √©t√© mis √† jour, nous devons mettre √† jour le type associ√© ",l.createElement(n.code,null,"PizzeriaContext")," au sein de ",l.createElement(n.code,null,"/src/types.ts")," :"),"\n",l.createElement(n.pre,{highlighting:"10"},l.createElement(n.code,{className:"language-ts"},"interface PizzeriaContext {\r\n  pizzas: Pizza[];\r\n  setPizzas: (pizzas: Pizza[]) => void;\r\n  actionToBePerformed: boolean;\r\n  setActionToBePerformed: (actionToBePerformed: boolean) => void;\r\n  clearActionToBePerformed: () => void;\r\n  drinks: Drink[];\r\n  addPizza: (newPizza: NewPizza) => Promise<void>;\r\n  registerUser: (newUser: User) => Promise<void>;\r\n  loginUser: (user: User) => Promise<void>;\r\n}\n")),"\n",l.createElement(n.p,null,"Et voici le code de la nouvelle ",l.createElement(n.code,null,"LoginPage")," (veuillez cr√©er cette page) qui fait appel au contexte pour r√©cup√©rer la fonction ",l.createElement(n.code,null,"loginUser")," :"),"\n",l.createElement(n.pre,{numbered:!0},l.createElement(n.code,{className:"language-tsx"},'import { useState, SyntheticEvent } from "react";\r\nimport "./index.css";\r\nimport { useNavigate, useOutletContext } from "react-router-dom";\r\nimport { PizzeriaContext } from "../../types";\r\n\r\nconst LoginPage = () => {\r\n\r\n   const { loginUser } : PizzeriaContext = useOutletContext();\r\n  \r\n    const navigate = useNavigate();\r\n    const [username, setUsername] = useState("");\r\n    const [password, setPassword] = useState("");\r\n  \r\n    const handleSubmit = async (e: SyntheticEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      await loginUser({ username, password });\r\n      navigate("/");\r\n    } catch (err) {\r\n      console.error("LoginPage::error: ", err);\r\n    }\r\n  };\r\n  \r\n    const handleUsernameInputChange = (e: SyntheticEvent) => {\r\n      const input = e.target as HTMLInputElement;\r\n      setUsername(input.value);\r\n    };\r\n  \r\n    const handlePasswordChange = (e: SyntheticEvent) => {\r\n      const input = e.target as HTMLInputElement;\r\n      setPassword(input.value);\r\n    };\r\n  \r\n    return (\r\n      <div>\r\n        <h1>Connectez un utilisateur</h1>\r\n        <form onSubmit={handleSubmit}>\r\n          <label htmlFor="username">Username</label>\r\n          <input\r\n            value={username}\r\n            type="text"\r\n            id="username"\r\n            name="username"\r\n            onChange={handleUsernameInputChange}\r\n            required\r\n          />\r\n          <label htmlFor="password">Password</label>\r\n          <input\r\n            value={password}\r\n            type="text"\r\n            id="password"\r\n            name="password"\r\n            onChange={handlePasswordChange}\r\n            required\r\n          />\r\n          <button type="submit">S\'authentifier</button>\r\n        </form>\r\n      </div>\r\n    );\r\n  };\r\n  \r\n  export default LoginPage;\n')),"\n",l.createElement(n.p,null,"Maintenant nous devons mettre √† jour la configuration de notre router pour offrir la ",l.createElement(n.code,null,"LoginPage")," : pour ce faire, veuillez mettre √† jour ",l.createElement(n.code,null,"/src/main.tsx")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"18-21"},l.createElement(n.code,{className:"language-tsx"},'const router = createBrowserRouter([\r\n  {\r\n    path: "/",\r\n    element: <App />,\r\n    children: [\r\n      {\r\n        path: "",\r\n        element: <HomePage />,\r\n      },\r\n      {\r\n        path: "add-pizza",\r\n        element: <AddPizzaPage />,\r\n      },\r\n      {\r\n        path: "register",\r\n        element: <RegisterPage />,\r\n      },\r\n      {\r\n        path: "login",\r\n        element: <LoginPage />,\r\n      }\r\n    ],\r\n  },\r\n]);\n')),"\n",l.createElement(n.p,null,"Il faut aussi mettre √† jour la ",l.createElement(n.code,null,"Navbar")," pour offrir un lien vers la ",l.createElement(n.code,null,"LoginPage")," seulement si les utilisateurs ne sont pas connect√©s :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"17"},l.createElement(n.code,{className:"language-tsx"},'const NavBar = ({authenticatedUser} : NavBarProps) => {\r\n  const navigate = useNavigate();\r\n\r\n  if(authenticatedUser) {\r\n    return (\r\n      <nav>\r\n        <button onClick={() => navigate("/")}>Home</button>\r\n        <button onClick={() => navigate("/add-pizza")}>Ajouter une pizza</button>\r\n      </nav>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <nav>\r\n      <button onClick={() => navigate("/")}>Home</button>\r\n      <button onClick={() => navigate("/register")}>Cr√©er un utilisateur</button>\r\n      <button onClick={() => navigate("/login")}>Se connecter</button>\r\n    </nav>\r\n  );\r\n};\n')),"\n",l.createElement(n.p,null,"Veuillez ex√©cuter le frontend et vous assurer que pour l'utilisateur pr√©alablement cr√©√©, vous pouvez l'utiliser pour vous loguer."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Sauvegarde des donn√©es de session ")),"\n",l.createElement(n.p,null,"Maintenant, bien que l'utilisateur soit connect√© et donc authentifi√©, si nous faisons un refresh de la page, nous perdons les donn√©es de session."),"\n",l.createElement(n.p,null,"Nous allons donc voir comment sauvegarder ",l.createElement(n.code,null,"authenticatedUser")," dans le ",l.createElement(n.code,null,"localStorage"),"."),"\n",l.createElement(n.p,null,"üí≠ Mais quel est le format d'un ",l.createElement(n.code,null,"AuthenticatedUser")," ?",l.createElement(n.br),"\n","Celui-ci est fix√© par notre API et nous l'avons d√©j√† d√©fini dans ",l.createElement(n.code,null,"types.ts"),"... Voici un exemple de sa forme :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'{\r\n    "username": "me",\r\n    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1lIiwiaWF0IjoxNzE5ODIxMTEwLCJleHAiOjE4MDYyMjExMTB9.cyw8HYhLxEWIsdAJQ0dO_wuokib20zTNxqYLpj74Wp4"\r\n}\n')),"\n",l.createElement(n.p,null,"üí≠ A quel moment sauvegarder les donn√©es de session ?",l.createElement(n.br),"\n","Ici, l'utilisateur est connect√© lors du register, ou lors du login. C'est donc √† se moment l√† qu'il faut sauvegarder ses donn√©es dans le ",l.createElement(n.code,null,"localStorage"),".",l.createElement(n.br),"\n","Comme nous allons r√©utiliser un m√™me traitement (tant dans login que dans register), nous pouvons directement √©viter une duplication de code en cr√©ant une fonction ",l.createElement(n.code,null,"storeAuthenticatedUser"),". De plus, nous avons besoin d'une fonction qui nous permettra de r√©cup√©rer l'utilisateur authentifi√© du ",l.createElement(n.code,null,"localStorage"),".",l.createElement(n.br),"\n","Et finalement, afin de pr√©voir le nettoyage des donn√©es de session, nous allons cr√©er une fonction ",l.createElement(n.code,null,"clearAuthenticatedUser"),"."),"\n",l.createElement(n.p,null,"Veuillez cr√©er un nouveau script ",l.createElement(n.code,null,"/src/utils/session.ts")," et y ajouter ce code-ci :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-ts"},'import { AuthenticatedUser, MaybeAuthenticatedUser } from "../types";\r\n\r\nconst storeAuthenticatedUser = (authenticatedUser: AuthenticatedUser) => {\r\n  localStorage.setItem("authenticatedUser", JSON.stringify(authenticatedUser));\r\n};\r\n\r\nconst getAuthenticatedUser = (): MaybeAuthenticatedUser => {\r\n  const authenticatedUser = localStorage.getItem("authenticatedUser");\r\n\r\n  if (!authenticatedUser) return undefined;\r\n\r\n  return JSON.parse(authenticatedUser);\r\n};\r\n\r\nconst clearAuthenticatedUser = () => {\r\n  localStorage.removeItem("authenticatedUser");\r\n};\r\n\r\nexport { storeAuthenticatedUser, getAuthenticatedUser, clearAuthenticatedUser };\n')),"\n",l.createElement(n.p,null,"Veuillez mettre √† jour ",l.createElement(n.code,null,"App")," afin de faire appelle √† ",l.createElement(n.code,null,"storeAuthenticatedUser")," lors du login et du register :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"21,51"},l.createElement(n.code,{className:"language-tsx"},' const registerUser = async (newUser: User) => {\r\n    try {\r\n      const options = {\r\n        method: "POST",\r\n        body: JSON.stringify(newUser),\r\n        headers: {\r\n          "Content-Type": "application/json",\r\n        },\r\n      };\r\n\r\n      const response = await fetch("/api/auths/register", options);\r\n\r\n      if (!response.ok)\r\n        throw new Error(\r\n          `fetch error : ${response.status} : ${response.statusText}`\r\n        );\r\n\r\n      const createdUser: AuthenticatedUser = await response.json();\r\n\r\n      setAuthenticatedUser(createdUser);\r\n      storeAuthenticatedUser(createdUser);\r\n\r\n      console.log("createdUser: ", createdUser);\r\n    } catch (err) {\r\n      console.error("registerUser::error: ", err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  const loginUser = async (user: User) => {\r\n    try {\r\n      const options = {\r\n        method: "POST",\r\n        body: JSON.stringify(user),\r\n        headers: {\r\n          "Content-Type": "application/json",\r\n        },\r\n      };\r\n\r\n      const response = await fetch("/api/auths/login", options);\r\n\r\n      if (!response.ok)\r\n        throw new Error(\r\n          `fetch error : ${response.status} : ${response.statusText}`\r\n        );\r\n\r\n      const authenticatedUser: AuthenticatedUser = await response.json();\r\n      console.log("authenticatedUser: ", authenticatedUser);\r\n\r\n      setAuthenticatedUser(authenticatedUser);\r\n      storeAuthenticatedUser(authenticatedUser);\r\n    } catch (err) {\r\n      console.error("loginUser::error: ", err);\r\n      throw err;\r\n    }\r\n  };\n')),"\n",l.createElement(n.p,null,"üí≠ A quel moment devons nous faire appel √† ",l.createElement(n.code,null,"getAuthenticatedUser")," pour r√©cup√©rer les donn√©es du ",l.createElement(n.code,null,"localStorage")," ?",l.createElement(n.br),"\n","En fait, cela doit se faire au chargement de la page. Et nous souhaitons, si nous r√©cup√©rons un utilisateur authentifi√©, passer cet utilisateur √† la ",l.createElement(n.code,null,"Navbar"),". Une fa√ßon simple de r√©aliser cette action, c'est la toute premi√®re fois que ",l.createElement(n.code,null,"App")," est appel√©, en utilisant son ",l.createElement(n.code,null,"useEffect"),". Veuillez donc mettre √† jour le ",l.createElement(n.code,null,"useEffect")," de ",l.createElement(n.code,null,"App")," :"),"\n",l.createElement(n.pre,{highlighting:"3-6"},l.createElement(n.code,{className:"language-tsx"},"useEffect(() => {\r\n    fetchPizzas();\r\n    const authenticatedUser = getAuthenticatedUser();\r\n    if (authenticatedUser) {\r\n      setAuthenticatedUser(authenticatedUser);\r\n    }\r\n  }, []);\n")),"\n",l.createElement(n.p,null,"Nous allons voir dans le ",l.createElement(n.code,null,"localStorage")," s'il existe des donn√©es de session et r√©cup√©rons l'utilisateur authentifi√© si c'est le cas. Ensuite, nous mettons √† jour l'√©tat ",l.createElement(n.code,null,"authenticatedUser")," avec cet utilisateur authentifi√©, ce qui permet un \"rerender\" de l'UI (dont la mise √† jour de l'affichage de la ",l.createElement(n.code,null,"Navbar"),")."),"\n",l.createElement(n.p,null,"Veuillez connecter un utilisateur et faire un refresh de la page...  Et voila, vous devriez rester connect√© : )"),"\n",l.createElement(n.p,null,"N'h√©sitez pas √† aller voir le ",l.createElement(n.code,null,"localStorage")," de votre browser. Pour Chrome, dans vos outils de d√©veloppeurs, celui-ci se trouve dans l'onglet ",l.createElement(n.code,null,"Application"),"."),"\n",l.createElement(n.h1,null,l.createElement(i,null," D√©connexion d'un utilisateur ")),"\n",l.createElement(n.p,null,"Il est √† noter que pour avoir une application compl√®te, il va aussi falloir penser √† faire effacer les donn√©es de session."),"\n",l.createElement(n.p,null,"Nous allons ajouter un √©l√©ment √† la ",l.createElement(n.code,null,"Navbar")," qui se nomme ",l.createElement(n.code,null,"Se d√©connecter"),". Lorsqu'on cliquera sur cet √©l√©ment, nous devons mettre √† jour la variable d'√©tat ",l.createElement(n.code,null,"authenticatedUser")," qui se trouve dans ",l.createElement(n.code,null,"App")," et nous devons effacer les donn√©es de session du ",l.createElement(n.code,null,"localStorage"),'. Comme l\'√©tat est g√©r√© dans le composant "parent" de la ',l.createElement(n.code,null,"Navbar"),", nous allons cr√©er une fonction dans ",l.createElement(n.code,null,"App")," qui permette d'agir sur cet √©tat."),"\n",l.createElement(n.p,null,"Veuillez donc mettre √† jour ",l.createElement(n.code,null,"App")," en lui ajoutant cette fonction ",l.createElement(n.code,null,"clearUser")," et en passant cette fonction √† la ",l.createElement(n.code,null,"Navbar")," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"2-5,15"},l.createElement(n.code,{className:"language-tsx"},'  //....\r\n  const clearUser = () => {\r\n    clearAuthenticatedUser();\r\n    setAuthenticatedUser(undefined);\r\n  }\r\n  // ... reste du code\r\n  return (\r\n    <div className="page">\r\n      <Header\r\n        title="We love Pizza"\r\n        version={0 + 1}\r\n        handleHeaderClick={handleHeaderClick}\r\n      />\r\n      <main>\r\n        <NavBar authenticatedUser={authenticatedUser} clearUser={clearUser}/>\r\n        <Outlet context={fullPizzaContext} />\r\n      </main>\r\n      <Footer />\r\n    </div>\r\n  );\n')),"\n",l.createElement(n.p,null,"Voici le code de la ",l.createElement(n.code,null,"Navbar")," mis √† jour pour ajouter l‚Äô√©l√©ment de d√©connexion et l'action associ√©e :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"3,6,16"},l.createElement(n.code,{className:"language-tsx"},'interface NavBarProps {\r\n  authenticatedUser: MaybeAuthenticatedUser;\r\n  clearUser: () => void;\r\n}\r\n\r\nconst NavBar = ({ authenticatedUser, clearUser }: NavBarProps) => {\r\n  const navigate = useNavigate();\r\n\r\n  if (authenticatedUser) {\r\n    return (\r\n      <nav>\r\n        <button onClick={() => navigate("/")}>Home</button>\r\n        <button onClick={() => navigate("/add-pizza")}>\r\n          Ajouter une pizza\r\n        </button>\r\n        <button onClick={() => clearUser()}>Se d√©connecter</button>\r\n      </nav>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <nav>\r\n      <button onClick={() => navigate("/")}>Home</button>\r\n      <button onClick={() => navigate("/register")}>\r\n        Cr√©er un utilisateur\r\n      </button>\r\n      <button onClick={() => navigate("/login")}>Se connecter</button>\r\n    </nav>\r\n  );\r\n};\n')),"\n",l.createElement(n.p,null,"Veuillez tester l'application, vous connecter, d√©connecter... Cela devrait bien fonctionner."),"\n",l.createElement(n.p,null,"Il nous reste √† faire en sorte que l'on puisse autoriser l'op√©ration de cr√©ation de pizza."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Autorisation de l'appel √† une op√©ration prot√©g√©e  ")),"\n",l.createElement(n.p,null,"Veuillez connecter un utilisateur, cliquer sur ",l.createElement(n.code,null,"Ajouter une pizza"),", compl√©ter le formulaire d'ajout d'une pizza, cliquer sur ",l.createElement(n.code,null,"Ajouter"),' et regarder dans la console : il devrait y avoir une erreur qui s\'affiche avec le "status code" ',l.createElement(n.strong,null,l.createElement(n.code,null,"401 : Unauthorized")),".",l.createElement(n.br),"\n","En effet, l'API attend un token pour autoriser l'op√©ration de cr√©ation d'une pizza."),"\n",l.createElement(n.p,null,"Nous allons donc mettre √† jour la fonction permettant de cr√©er une pizza qui est d√©finie dans ",l.createElement(n.code,null,"App")," pour ajouter le token de l'utilisateur authentifi√© au sein du header de la requ√™te :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"11"},l.createElement(n.code,{className:"language-tsx"},' const addPizza = async (newPizza: NewPizza) => {\r\n    try {\r\n      if(!authenticatedUser)  {\r\n        throw new Error("You must be authenticated to add a pizza");\r\n      }\r\n      const options = {\r\n        method: "POST",\r\n        body: JSON.stringify(newPizza),\r\n        headers: {\r\n          "Content-Type": "application/json",\r\n          Authorization: authenticatedUser.token,\r\n        },\r\n      };\r\n      // Suite du code\n')),"\n",l.createElement(n.p,null,"Veuillez vous connecter √† l'IHM √† l'aide du compte ",l.createElement(n.strong,null,l.createElement(n.code,null,"manager"))," et tenter d'ajouter une pizza. Cela ne devrait toujours pas fonctionner. Veuillez regarder dans la console : il devrait y avoir une erreur qui s'affiche avec le \"status code\" ",l.createElement(n.strong,null,l.createElement(n.code,null,"403 : Forbidden")),".",l.createElement(n.br),"\n","En effet, l'API attend un token pour autoriser l'op√©ration de cr√©ation d'une pizza, mais seulement l'utilisatrice ou l'utilisateur ",l.createElement(n.strong,null,l.createElement(n.code,null,"admin"))," a le privil√®ge d'ajouter une pizza au menu !"),"\n",l.createElement(n.p,null,"D√©connectez-vous, reconnectez-vous √† l'aide du compte ",l.createElement(n.strong,null,l.createElement(n.code,null,"admin"))," (password ",l.createElement(n.code,null,"admin")," par d√©faut ; ), et ajoutez une pizza.\r\nVoila ! Le site devrait √™tre enti√®rement fonctionnel !"),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez utiliser le code du tutoriel ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/front/session-jwt"},"session-jwt"),"."),"\n",l.createElement(n.p,null,'üí≠ Est-ce que c\'est "safe" que notre IHM affiche le menu "Ajouter une pizza" pour un utilisateur qui n\'est pas l\'admin ?',l.createElement(n.br),"\n",l.createElement(n.em,null,"En fait oui, c'est \"safe\", vous l'avez test√©. L'API ne doit jamais faire confiance aux applications clientes pour appliquer la s√©curit√©. Ainsi, m√™me si le frontend autorise l'acc√®s √† des op√©rations qui ne devraient pas √™tre permises, au regard des autorisations appliqu√©es par l'API, √ßa n'a pas d'importance point de vue s√©curit√©.",l.createElement(n.br),"\n","De la m√™me fa√ßon, c'est pour √ßa qu'une API doit aussi toujours valider les param√®tres qu'elle re√ßoit. Elle ne peut pas faire confiance aux applications clientes, comme par exemple √† une application web tournant dans un browser, pour valider tous les champs d'un formulaire.",l.createElement(n.br),"\n","La raison est simple, l'API est d√©velopp√©e ind√©pendamment des applications clientes, elle ne peut pas supposer que les requ√™tes seront toujours bien construites.")),"\n",l.createElement(n.p,null,"üí≠ OK, tout est \"safe\" si l'API fait toutes les v√©rifications n√©cessaires. N√©anmoins, n'y a-t-il pas des r√®gles de bonnes pratiques au niveau des IHM, pour ne pas permettre de faire n'importe quelles requ√™tes vers des API ?",l.createElement(n.br),"\n",l.createElement(n.em,null,"Et bien oui, au niveau des IHM, pour des questions d'",l.createElement(n.strong,null,"ergonomie"),", d'exp√©rience utilisateur, on va faire en sorte :")),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.em,null,"de ne pas offrir des op√©rations qui ne seront pas autoris√©es. Par exemple, dans le cadre de ce tutoriel sur un site permettant de g√©rer une pizzeria, il ne faut pas \"frustrer\" les utilisateurs en leur faisant croire qu'ils ont acc√®s √† l'op√©ration de cr√©er une pizza ! Imaginez-vous, vous cr√©ez une nouvelle pizza de 32 ingr√©dients, et lors de la soumission, vous recevez un message comme quoi vous n'√™tes pas l'admin du site et que vous n'avez donc pas le droit de cr√©er une pizza üò≤!")),"\n",l.createElement(n.li,null,l.createElement(n.em,null,"de ne pas demander du travail √† une API quand l'IHM peut d√©tecter que ce n'est pas utile.\r\nAinsi, quand une IHM offre des formulaires, qui am√®neront √† des requ√™tes vers des API, on √©vitera d'autoriser la soumission des donn√©es tant que les champs n'ont pas √©t√© valid√©s. Tout ce que l'IHM peut valider c√¥t√© client, elle doit le faire. Le feedback sera plus rapide pour l'utilisateur, et les ressources de l'API seront √©conomis√©es (pas d'appel inutile).")),"\n"),"\n",l.createElement(n.p,null,"N'h√©sitez donc pas √† mettre √† jour ce tutoriel pour faire en sorte d'afficher \"Ajouter une pizza\" que si le compte connect√© est ",l.createElement(n.strong,null,l.createElement(n.code,null,"admin")),"."),"\n",l.createElement(n.p,null,'üí≠ Ca n\'est pas un peu "cheap" que seul le compte ',l.createElement(n.strong,null,l.createElement(n.code,null,"admin"))," puisse avoir le privil√®ge d'admin du site ?",l.createElement(n.br),"\n",l.createElement(n.em,null,"H√© bien oui, c'est \"cheap\". G√©n√©ralement, dans le cadre d'applications plus robustes, nous allons ajouter un ou plusieurs r√¥le(s) aux utilisateurs. Par exemple, dans le cadre d'applications o√π les r√¥les sont simples, qu'il n'y a jamais qu'un seul r√¥le associ√© √† un utilisateur, il suffirait d'ajouter au niveau de l'API la propri√©t√© ",l.createElement(n.strong,null,l.createElement(n.code,null,"role"))," aux utilisateurs. La majorit√© des utilisateurs pourrait avoir un r√¥le dont la valeur serait ",l.createElement(n.strong,null,l.createElement(n.code,null,"default")),", et une minorit√© d'utilisateurs aurait le r√¥le d'",l.createElement(n.strong,null,l.createElement(n.code,null,"admin")),"...")),"\n",l.createElement(n.p,null,"On n'affiche actuellement ",l.createElement(n.strong,null,"pas de message d'erreur")," aux utilisateurs lorsque la r√©ponse d'une API renvoie une erreur. Pour am√©liorer l'exp√©rience de l'utilisateur, ce serait une am√©lioration √† faire."),"\n",l.createElement(n.h1,null,l.createElement(i,null," Exercice 3.4 : Authentification et appel d'op√©rations prot√©g√©es par JWT  ")),"\n",l.createElement(n.p,null,"Veuillez continuer l'exercice pr√©c√©dent nomm√© ",l.createElement(n.code,null,"/exercises/3.3-4-4b")," afin de compl√©ter l'application ",l.createElement(n.code,null,"myMovies"),"."),"\n",l.createElement(n.p,null,"Pour tout cette exercice, vous devez avoir d√©marr√© l'API s√©curis√©e par JWT de vos films. Veuillez donc ex√©cuter le code de votre exercice pr√©c√©dent ",l.createElement(n.code,null,"/exercises/3.1"),". En cas de souci, vous trouvez le code de cette API ici : ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-exercises"},"https://github.com/e-vinci/ts-exercises")),"\n",l.createElement(n.h2,null,"Authentification et appel d'op√©rations n√©cessitant une autorisation JWT"),"\n",l.createElement(n.p,null,"Veuillez impl√©menter ces cas d'utilisation :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"register"))," : les utilisateurs doivent pouvoir cr√©er un compte."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"login"))," : les utilisateur doivent pouvoir se loguer."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"logout"))," : les utilisateurs doivent pouvoir se d√©connecter."),"\n"),"\n",l.createElement(n.p,null,"N'h√©sitez pas √† reprendre le code du tutoriel ; )"),"\n",l.createElement(n.p,null,"Une fois tout fonctionnel, veuillez faire un commit avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new:ex3.4-authentification")),"."),"\n",l.createElement(n.p,null,"Votre application doit maintenant autoriser les op√©rations suivantes que pour des utilisateurs authentifi√©s :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"UC2 : l'ajout d'une ressource de type films via un formulaire d'ajout d'un film."),"\n",l.createElement(n.li,null,"UC3 : la suppression d'un film."),"\n"),"\n",l.createElement(n.p,null,"Comme auparavant, cette op√©ration est permise pour tous les utilisateurs, anonymes ou authentifi√©s :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"UC1 : l'affichage, sous forme de tableau, de toutes les ressources de type films."),"\n"),"\n",l.createElement(n.p,null,"Pensez √† bien mettre √† jour votre ",l.createElement(n.strong,null,l.createElement(n.code,null,"Navbar"))," pour afficher les bons √©l√©ments en fonction que l'utilisateur est authentifi√© ou pas."),"\n",l.createElement(n.p,null,"Faites attention, il n'est pas autoris√©, pour des raisons d'ergonomie, que le frontend offre les fonctionnalit√©s d'√©criture de ressources pour les utilisateur non authentifi√©s. Vous devez donc rendre invisible les op√©rations non autoris√©es aux utilisateurs."),"\n",l.createElement(n.p,null,"UC2 (create) & UC3 (delete) doivent donc √™tre invisibles pour les utilisateurs anonymes."),"\n",l.createElement(n.p,null,"Veuillez faire en sorte de rajouter dans le web storage ces nouvelles donn√©es de session lors du login ou du register : le token et le username."),"\n",l.createElement(n.p,null,"Une fois tout fonctionnel, veuillez faire un commit avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new:ex3.4")),"."),"\n",l.createElement(n.h4,null,"ü§ù Tips"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"üí≠ Comment rendre invisible les op√©rations d'√©criture de certaines ressources au sein du frontend ?",l.createElement(n.br),"\n","Par exemple, vous pourriez afficher des boutons de type ",l.createElement(n.strong,null,l.createElement(n.code,null,"Effacer"))," que si l'utilisateur est authentifi√©."),"\n"),"\n",l.createElement(n.h1,null,l.createElement(i,null," Exercice 3.4b : Modification de ressources & JWT  ")),"\n",l.createElement(n.p,null,"Veuillez continuer l'exercice pr√©c√©dent nomm√© ",l.createElement(n.code,null,"/exercises/3.3-4-4b")," afin de compl√©ter l'application ",l.createElement(n.code,null,"myMovies"),"."),"\n",l.createElement(n.p,null,"Votre application doit maintenant autoriser cette op√©ration suivante que pour des utilisateurs authentifi√©s :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"UC4 : la mise √† jour des donn√©es d'un film (√† l'exception de l'id associ√© √† un film)."),"\n"),"\n",l.createElement(n.p,null,"Faites attention, il n'est pas autoris√©, pour des raisons d'ergonomie, que le frontend offre les fonctionnalit√©s d'√©criture de ressources pour les utilisateur non authentifi√©s. Vous devez donc rendre invisible les op√©rations non autoris√©es aux utilisateurs."),"\n",l.createElement(n.p,null,"UC4 (update) doit donc √™tre invisible pour les utilisateurs anonymes."),"\n",l.createElement(n.p,null,"Une fois tout fonctionnel, veuillez faire un commit avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new:ex3.4b")),"."),"\n",l.createElement(n.h2,null,"üç¨ Challenge optionnel : Gestion de session & remember me"),"\n",l.createElement(n.p,null,'S\'il vous reste du temps, vous pourriez continuer l\'exercice pr√©c√©dent et ajouter une fonction "remember me" √† votre formulaire de "login" et de "register" et faire en sorte que vos donn√©es de session soient sauvegard√©es :'),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"dans le ",l.createElement(n.strong,null,l.createElement(n.code,null,"localStorage")),' si l\'on clique sur une checkbox "Remember me" ;'),"\n",l.createElement(n.li,null,"dans le ",l.createElement(n.strong,null,l.createElement(n.code,null,"sessionStorage")),' si l\'on ne clique pas sur la checkbox "Remember me" lors du login ou du register.'),"\n"),"\n",l.createElement(n.p,null,"Une fois tout fonctionnel, veuillez faire un commit avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"new:ex3.4b+")),"."),"\n",l.createElement(n.h1,null,l.createElement(i,null," üç¨ Persistance de donn√©es de session via des cookies ")),"\n",l.createElement(n.h2,null,"Authentification & autorisation JWT √† l'aide de cookies"),"\n",l.createElement(n.p,null,"Dans la partie optionnelle sur l'",l.createElement(n.a,{href:"../auths-api/#%F0%9F%8D%AC_authentification_autorisation_jwt_a_laide_de_cookies"},"Authentification & autorisation JWT √† l'aide de cookies"),", nous avons vu comment mettre √† jour l'API afin d'int√©grer les tokens JWT aux cookies."),"\n",l.createElement(n.p,null,"Veuillez d√©marrer la version ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/back/api/cookies"},"cookies")," de l'API de la pizzeria."),"\n",l.createElement(n.p,null,"Nous allons voir maintenant comment le frontend peut utiliser ces cookies."),"\n",l.createElement(n.h2,null,"Gestion de session c√¥t√© client via une IHM et des cookies"),"\n",l.createElement(n.p,null,"Pour ce tutoriel, veuillez cr√©er une copie du tutoriel ",l.createElement(n.code,null,"session-jwt"),", si n√©cessaire voici le code du tutoriel ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/front/session-jwt"},"session-jwt"),", et l'appeler ",l.createElement(n.code,null,"cookies"),". Changez le nom du projet dans ",l.createElement(n.code,null,"package.json"),"."),"\n",l.createElement(n.p,null,"Afin de sauvegarder les donn√©es de session, c'est √† dire l'objet ",l.createElement(n.strong,null,l.createElement(n.code,null,"authenticatedUser"))," contenant juste un username, nous ne devons m√™me pas mettre √† jour le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/src/utils/session.js")),". En effet, l'API ",l.createElement(n.strong,null,l.createElement(n.code,null,"cookies"))," renvoie un objet du genre ",l.createElement(n.strong,null,l.createElement(n.code,null,'{username: "manager"}')),". Au niveau de l'IHM, le code est donc toujours fonctionnel pour sauvegarder le username gr√¢ce √† ",l.createElement(n.code,null,"authenticatedUser"),"."),"\n",l.createElement(n.p,null,"Il ne reste donc qu'√† changer le code o√π nous avons besoin d'une autorisation. Pour l'application de gestion de la pizzeria, il s'agit de la cr√©ation de pizza.",l.createElement(n.br),"\n","Veuillez donc mettre √† jour ",l.createElement(n.strong,null,l.createElement(n.code,null,"App"))," pour enlever la ligne s'occupant de l'authorization header : ",l.createElement(n.strong,null,l.createElement(n.code,null,"Authorization: authenticatedUser.token"))," :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"9-11"},l.createElement(n.code,{className:"language-tsx"},'const addPizza = async (newPizza: NewPizza) => {\r\n    try {\r\n      if (!authenticatedUser) {\r\n        throw new Error("You must be authenticated to add a pizza");\r\n      }\r\n      const options = {\r\n        method: "POST",\r\n        body: JSON.stringify(newPizza),\r\n        headers: {\r\n          "Content-Type": "application/json",\r\n        },\r\n      };\r\n      // Suite du code ...\n')),"\n",l.createElement(n.p,null,"Veuillez tester votre derni√®re version du frontend.\r\nLoguez-vous avec l'utilisateur ",l.createElement(n.strong,null,l.createElement(n.code,null,"admin"))," (et le password ",l.createElement(n.strong,null,l.createElement(n.code,null,"admin")),").",l.createElement(n.br),"\n","Ajoutez une pizza et v√©rifiez qu'elle s'affiche bien."),"\n",l.createElement(n.p,null,"üí≠ Comment v√©rifier le cookie ?",l.createElement(n.br),"\n","Tout en ayant la fen√™tre de votre application ouverte, via Chrome, allez dans vos outils de d√©veloppeurs : ",l.createElement(n.strong,null,l.createElement(n.code,null,"F12")),".",l.createElement(n.br),"\n","Puis, dans l'onglet ",l.createElement(n.strong,null,l.createElement(n.code,null,"Application")),", cliquez sur ",l.createElement(n.strong,null,l.createElement(n.code,null,"Cookies")),", vous verrez appara√Ætre ",l.createElement(n.strong,null,l.createElement(n.code,null,"http://localhost:8080")),". Cliquez sur cette URL, et vous verrez vos 2 cookies de session, ",l.createElement(n.strong,null,l.createElement(n.code,null,"user.sig"))," et ",l.createElement(n.strong,null,l.createElement(n.code,null,"user")),".",l.createElement(n.br),"\n","N'h√©sitez pas √† aller d√©coder la valeur du cookie ",l.createElement(n.strong,null,l.createElement(n.code,null,"user"))," sur ",l.createElement(n.a,{href:"https://www.base64decode.org/"},"base64decode")," en faisant un copier / coller de ",l.createElement(n.strong,null,l.createElement(n.code,null,"Value")),". Vous devriez voir quelque chose appara√Ætre du style ",l.createElement(n.strong,null,l.createElement(n.code,null,'{"username":"manager","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1hbmFnZXIiLCJpYXQiOjE2NjE3NzUxMDgsImV4cCI6MTc0ODE3NTEwOH0.sAZqq6vbrjCCZZoLH-n8hJKBoXJJJ8jEoupk8xKu5WI"}')),"  !"),"\n",l.createElement(n.p,null,"Toujours dans l'onglet ",l.createElement(n.strong,null,l.createElement(n.code,null,"Application"))," des outils de d√©veloppeurs de Chrome, faites un clear des cookies : clic droit sur ",l.createElement(n.strong,null,l.createElement(n.code,null,"http://localhost:8080")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"Clear")),".",l.createElement(n.br),"\n","Tentez maintenant d'ajouter une pizza... Ca ne fonctionne plus, et c'est bien normal, car il n'y a plus de token qui est envoy√© √† l'API !"),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez utiliser le code du tutoriel ",l.createElement(n.a,{href:"https://github.com/e-vinci/ts-demos/tree/main/front/cookies"},"cookies"),"."),"\n",l.createElement(n.p,null,"üí≠ Notons que cette version de notre frontend pourrait √™tre am√©lior√©e. Actuellement, lorsqu'on fait un logout, on n'efface pas le cookie du browser.",l.createElement(n.br),"\n","Comment feriez vous ?",l.createElement(n.br),"\n",l.createElement(n.em,null,"Vous pourriez par exemple appeler la m√©thode ",l.createElement(n.strong,null,l.createElement(n.code,null,"GET /auths/logout"))," üòâ.")))}var o=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,r.RP)(),e.components);return n?l.createElement(n,e,l.createElement(a,e)):a(e)};function s(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var u=t(4810),i=t(2662),c=t(9640),d=t(5938),m=t(9460),p=t(7929),E=t(794),g=t(4092),h=t(4262),f=t(3528),v=t(9942),z=t(4698),b=t(2214),P=t(9838),U=(t(1262),t(1731)),A=t(7050),x=t(2483),I=t(4902),q=t(9294),y=t(7828),w=t(2035),C=t(5590);const j={Link:u.Link,Image:c.A,Section:d.A,Content:m.A,Background:p.A,SectionHeader:E.A,SectionFooter:g.A,PageHeader:h.A,CodeBlock:v.A,LinkFile:z.A,ScrollableImage:b.A,PublicProjectsView:P.A,AuthenticatedBlock:U.A,UnAuthenticatedBlock:A.A,NestedMdxBlock:x.A,YoutubeImage:I.A,InternalPageMenu:q.A,InternalPageMenuItem:y.A,InternalPageTitle:w.A,PathViewer:C.E,PathViewerItem:C.F};function N(e){var n,t,a,o,s;let{data:{mdx:u,allImages:c},children:d}=e;return j.PageHeader=(0,f.R)(h.A,null==u?void 0:u.frontmatter),l.createElement(i.A,Object.assign({},null!=u&&u.frontmatter?{frontmatter:u.frontmatter}:{},null!=u&&null!==(n=u.frontmatter)&&void 0!==n&&n.navbarExtraStyles?{navbarExtraStyles:u.frontmatter.navbarExtraStyles}:{},null!=u&&null!==(t=u.frontmatter)&&void 0!==t&&t.headerImage?{headerImage:u.frontmatter.headerImage}:{},null!=u&&null!==(a=u.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:u.frontmatter.featuredImage}:{},null!=u&&null!==(o=u.frontmatter)&&void 0!==o&&o.title?{pageTitle:u.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),l.createElement(r.xA,{components:j},l.createElement("div",{className:null!=u&&null!==(s=u.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},d)))}function k(e){return l.createElement(N,e,l.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-3-auths-hmi-fr-mdx-9dad6b8d544ae6024676.js.map