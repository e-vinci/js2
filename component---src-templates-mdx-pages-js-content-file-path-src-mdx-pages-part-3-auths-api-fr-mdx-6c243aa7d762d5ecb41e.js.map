{"version":3,"file":"component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-3-auths-api-fr-mdx-6c243aa7d762d5ecb41e.js","mappings":"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","sources":["webpack://myjscourse/./src/mdx-pages/part3/auths-api.fr.mdx","webpack://myjscourse/./src/templates/mdx-pages.js"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    h2: \"h2\",\n    p: \"p\",\n    strong: \"strong\",\n    ul: \"ul\",\n    li: \"li\",\n    br: \"br\",\n    em: \"em\",\n    h3: \"h3\",\n    h4: \"h4\",\n    code: \"code\",\n    a: \"a\",\n    pre: \"pre\",\n    h5: \"h5\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    ol: \"ol\"\n  }, _provideComponents(), props.components), {InternalPageMenu, PathViewer, PathViewerItem, InternalPageMenuItem, YoutubeImage, InternalPageTitle, ScrollableImage} = _components;\n  if (!InternalPageMenu) _missingMdxReference(\"InternalPageMenu\", true);\n  if (!InternalPageMenuItem) _missingMdxReference(\"InternalPageMenuItem\", true);\n  if (!InternalPageTitle) _missingMdxReference(\"InternalPageTitle\", true);\n  if (!PathViewer) _missingMdxReference(\"PathViewer\", true);\n  if (!PathViewerItem) _missingMdxReference(\"PathViewerItem\", true);\n  if (!ScrollableImage) _missingMdxReference(\"ScrollableImage\", true);\n  if (!YoutubeImage) _missingMdxReference(\"YoutubeImage\", true);\n  return React.createElement(React.Fragment, null, React.createElement(_components.h1, null, \"b) Sécurisation d'une RESTful API\"), \"\\n\", React.createElement(InternalPageMenu, null, React.createElement(PathViewer, null, React.createElement(PathViewerItem, {\n    to: \"/\"\n  }, \" web2course \"), React.createElement(PathViewerItem, {\n    to: \"/part3\"\n  }, \" Partie 3 \"), React.createElement(PathViewerItem, {\n    selected: true\n  }, \" b) API & JWT & bcrypt \")), React.createElement(InternalPageMenuItem, null, \" C'est quoi l'authentification et l'autorisation ? \"), React.createElement(InternalPageMenuItem, null, \" Stateful VS stateless authentication \"), React.createElement(InternalPageMenuItem, null, \" C'est quoi les tokens JWT ? \"), React.createElement(InternalPageMenuItem, null, \" Authentification et création de token \"), React.createElement(InternalPageMenuItem, null, \" Autorisation et vérification de token \"), React.createElement(InternalPageMenuItem, null, \" Client REST avec JWT \"), React.createElement(InternalPageMenuItem, null, \" Protection des opérations d'écriture d'une API \"), React.createElement(InternalPageMenuItem, null, \" Sécurisation des passwords \"), React.createElement(InternalPageMenuItem, null, \" Exercice 3.1 : Authentification & autorisation d'opérations \"), React.createElement(InternalPageMenuItem, null, \" 🍬 Exercice 3.2 : une autre API sécurisée \"), React.createElement(InternalPageMenuItem, null, \" 🍬 Authentification & autorisation JWT à l'aide de cookies \"), React.createElement(InternalPageMenuItem, null, \" 🍬 Test via REST Client d'une RESTful API attendant des cookies \")), \"\\n\", React.createElement(\"div\", {\n    className: \"card card__simple-youtube-container\"\n  }, React.createElement(YoutubeImage, {\n    src: \"https://youtu.be/jCUyii3hcwY\"\n  })), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" C'est quoi l'authentification et l'autorisation ? \")), \"\\n\", React.createElement(_components.h2, null, \"Authentification, c'est quoi ?\"), \"\\n\", React.createElement(_components.p, null, \"L'authentification, c'est le processus de \", React.createElement(_components.strong, null, \"vérifier qui est l'utilisateur\"), \" d'une application.\"), \"\\n\", React.createElement(_components.p, null, \"Pour authentifier un utilisateur, on va généralement passer via un formulaire de connexion, lui demandant un username et un password.\"), \"\\n\", React.createElement(_components.h2, null, \"Autorisation, c'est quoi ?\"), \"\\n\", React.createElement(_components.p, null, \"L'autorisation, c'est le processus de \", React.createElement(_components.strong, null, \"vérifier ce à quoi un utilisateur à accès\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Une API va autoriser les accès à certaines opérations en fonction des privilèges associés aux utilisateurs. Il y aura des opérations qui seront autorisées :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour tous les utilisateurs\"), \", tant anonymes qu'authentifiés ;\", React.createElement(_components.br), \"\\n\", React.createElement(_components.em, null, \"imaginez par exemple les opérations de lecture de produits sur un site \\\"vitrine\\\". Il ne faut pas devoir créer de compte utilisateur pour pouvoir afficher les produits du site.\")), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour tous les utilisateurs authentifiés\"), \", peu importe leurs privilèges ;\", React.createElement(_components.br), \"\\n\", React.createElement(_components.em, null, \"imaginez le fait de pouvoir poster des messages dans un forum ; il faut avoir un compte pour pouvoir le faire, mais il ne faut pas de privilèges spécifiques (pas besoin d'être admin).\")), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour seulement un ou plusieurs utilisateur(s) authentifié(s)\"), \" ayant les privilèges requis ;\", React.createElement(_components.br), \"\\n\", React.createElement(_components.em, null, \"imaginez une opération de lecture de tous les profils des utilisateurs d'une banque ; il faut avoir un compte admin de la banque pour pouvoir le faire. Ca serait catastrophique si n'importe quel utilisateur authentifié pourrait accéder aux profils de tous les utilisateurs !\")), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"Différents moyens d'authentification\"), \"\\n\", React.createElement(_components.h3, null, \"Authentification stateful\"), \"\\n\", React.createElement(_components.p, null, \"Traditionnellement, ou anciennement, nous avons l'authentification qui est supportée à l'aide de cookies. L'utilisateur envoie via un formulaire son username et password, le serveur vérifie ceux-ci et crée un id de session et le renvoie à l'utilisateur via un cookie.\", React.createElement(_components.br), \"\\n\", \"Après l'authentification, à chaque requête du client sur ce serveur, le cookie est envoyé, et le serveur, qui a sauvegardé la session, va la retrouver sur base de l'id de session présent dans le cookie et va autoriser ou non l'accès à l'opération demandée par le client.\", React.createElement(_components.br), \"\\n\", \"C'est ce qu'on appelle une authentification \", React.createElement(_components.strong, null, \"stateful\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Un mécanisme d'authentification \", React.createElement(_components.strong, null, \"stateful\"), \" indique que le serveur est responsable de sauvegarder les données de session des utilisateurs.\"), \"\\n\", React.createElement(_components.p, null, \"On parle de \", React.createElement(_components.strong, null, \"session\"), \" d'un utilisateur comme étant toute la durée où le client s'authentifie à l'application web jusqu'à ce qu'il quitte cette application, lorsqu'il ferme son browser.\"), \"\\n\", React.createElement(_components.h3, null, \"Authentification stateless\"), \"\\n\", React.createElement(_components.p, null, \"De manière plus moderne, nous avons des mécanismes d'authentification qui sont dits \", React.createElement(_components.strong, null, \"stateless\"), \". Dans ce genre de mécanisme, c'est le client qui doit sauvegarder les données de session, et donc le browser. L'authentification à l'aide de \", React.createElement(_components.strong, null, \"tokens\"), \" devient très populaire.\", React.createElement(_components.br), \"\\n\", \"Il existe différents moyen de l'implémenter. Dans le cadre de ce cours, nous focaliserons sur la façon la plus habituelle, les \", React.createElement(_components.strong, null, \"JSON Web Tokens\"), \", ou \", React.createElement(_components.strong, null, \"JWT\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Il existe d'autres mécanismes très modernes qui utilisent des tokens, et qui sont mis en place par des tiers : \", React.createElement(_components.strong, null, \"OAuth\"), \", \", React.createElement(_components.strong, null, \"OpenId\"), \"... Ces mécanismes sont offerts par Microsoft, Google, Facebook... Nous ne les verrons pas dans le cadre de cours. Néanmoins, à la fin de ce cours, vous devriez être apte à pouvoir les utiliser, sous réserve de bien lire la documentation 😉.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Stateful VS stateless authentication  \")), \"\\n\", React.createElement(_components.p, null, \"Quels sont les avantages & inconvénients d'une authentification stateful ? et d'une authentification stateless ?\"), \"\\n\", React.createElement(_components.h4, null, \"Authentification stateful\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, \"Inconvénients\"), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"La session utilise de la mémoire pour chaque utilisateur.\"), \"\\n\", React.createElement(_components.li, null, \"Le backend n'a aucune manière de déterminer si le frontend s'est déconnecté du site ou non : gestion de l'expiration d'une session plus compliquée, notamment si le frontend revient après une longue durée.\"), \"\\n\", React.createElement(_components.li, null, \"Toutes les sessions sont perdues en cas de redémarrage du serveur (ré-authentification).\"), \"\\n\", React.createElement(_components.li, null, \"Load balancing compliqué ; en effet, si un client fait une requête, pendant toute la durée de la session, s'il y a plusieurs serveurs qui peuvent y répondre, comment est gérée la session de ce client ? Par quel(s) serveur(s) ? Comment se partagent-ils les données de session ? Est-ce que ça doit toujours être le même serveur qui réponde au même client ?\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, \"Avantages\"), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Peu gourmand en ressource point de vue processing et très rapide ; en effet, une fois qu'une session est en place, la vérification que le cookie contient le bon id de session se fait vite.\"), \"\\n\"), \"\\n\", React.createElement(_components.h4, null, \"Authentification stateless\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, \"Inconvénients\"), \" :\\nComme le serveur ne retient plus l'utilisateur en mémoire, il doit utiliser de la cryptographie pour créer et valider les token ; c'est donc consommateur en ressource point de vue processing.\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, \"Avantages\"), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Pas de session à gérer, même après redémarrage du serveur, il n'y a pas de ré-authentification nécessaire.\"), \"\\n\", React.createElement(_components.li, null, \"Évolutif, utilisation facile de plusieurs serveurs si du load balancing est nécessaire ; en effet, comme chaque requête du client contient toutes les infos pour se faire autoriser, il n'est pas nécessaire de savoir quel serveur va prendre en charge la requête.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Notons que la \\\"scalability\\\" horizontale, la possibilité de permettre à une application d'augmenter sa capacité de répondre à une charge grandissante simplement en ajoutant des machines, est quelque chose de très important à notre époque.\", React.createElement(_components.br), \"\\n\", \"Certaines applications web ont des centaines de millions d'utilisateurs ; pour celles-ci, on ne peut pas compter sur la \\\"scalability\\\" verticale, c'est-à-dire le fait d'augmenter les ressources d'une machine, en augmentant sa RAM, son processeur, son espace de stockage...\"), \"\\n\", React.createElement(_components.p, null, \"Dès lors, dans le cadre de ce cours, nous allons préférer les applications web qui peuvent tourner sur des serveurs \", React.createElement(_components.strong, null, \"stateless\"), \".\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" C'est quoi les tokens JWT ? \")), \"\\n\", React.createElement(_components.p, null, \"Les \", React.createElement(_components.strong, null, \"JSON Web token\"), \", ou \", React.createElement(_components.strong, null, \"JWT\"), \", appartiennent à un standard internet permettant l'échange sécurisé de tokens entre plusieurs parties.\"), \"\\n\", React.createElement(_components.p, null, \"Un \", React.createElement(_components.strong, null, \"JWT\"), \" contient \", React.createElement(_components.strong, null, \"trois parties encodées en base64\"), \" et ressemble à qqch du style :\", React.createElement(_components.br), \"\\n\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.\")), React.createElement(_components.br), \"\\n\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.\")), React.createElement(_components.br), \"\\n\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\"))), \"\\n\", React.createElement(_components.p, null, \"Voici les 3 parties d'un JWT et leurs caractéristiques :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"l'\", React.createElement(_components.strong, null, \"entête\"), \" (ou header) : un objet JSON identifiant le type de token (JWT) et l'algorithme utilisé pour générer la signature du token (HS256), un algorithme de hachage.\"), \"\\n\", React.createElement(_components.li, null, \"le \", React.createElement(_components.strong, null, \"payload\"), \" : un objet JSON permettant de spécifier le \", React.createElement(_components.strong, null, \"claim\"), \" ; ce sont des paramètres optionnels précisant les affirmations associées au token, comme la date d'expiration du token, son créateur, le fait que l'utilisateur est admin... généralement, on y met pas trop d'info, principalement l'identifiant de l'utilisateur ; si l'API a besoin de plus d'info concernant l'utilisateur, elle ira généralement les chercher dans ses données.\"), \"\\n\", React.createElement(_components.li, null, \"la \", React.createElement(_components.strong, null, \"signature\"), \" : c'est une signature numérique construite à partir d'un secret privé ou d'une clé publique/privée, via l'algorithme précisé dans la signature.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"💭 C'est bien joli tout ça, mais comment ça permet de sécuriser la session d'un utilisateur ?\", React.createElement(_components.br), \"\\n\", \"Généralement, l'API, et elle uniquement, connaît le secret privé. Elle va donc créer le token d'un utilisateur authentifié, en y ajoutant le claim (ou les affirmations) qu'elle juge utile.\", React.createElement(_components.br), \"\\n\", \"Lorsque le client reçoit son token, il va le sauvegarder dans son browser.\", React.createElement(_components.br), \"\\n\", \"Pour chaque requête nécessitant une autorisation de l'API, le client enverra son token au sein du header de la requête.\", React.createElement(_components.br), \"\\n\", \"L'API utilisera le secret privé, connu d'elle-même uniquement, pour vérifier la signature du token. Si tout est OK, c'est que l'utilisateur est bien authentifié et que son claim est OK.\"), \"\\n\", React.createElement(_components.p, null, \"Imaginez maintenant qu'un hacker tente de modifier le token, pour modifier le claim, notamment en changeant l'id de l'utilisateur présent dans le payload du token.\\nEt bien la signature ne correspondra plus à ce token là ! L'API le détectera.\", React.createElement(_components.br), \"\\n\", \"Pour que le hacker réussisse son acte malicieux, il est obligé de connaître le secret privé qui ne doit être connu que de l'API. Ca ne serait que sur base du secret privé que les hackers pourraient générer un nouveau token qui serait validé par l'API. Pas évident à faire...\"), \"\\n\", React.createElement(_components.p, null, \"Ainsi, on peut imaginer un token comme une enveloppe sécurisé par un cadenas très spécial : ce cadenas, qui est mis sur l'enveloppe contenant, par exemple, l'identifiant d'un utilisateur, est fermé par la clé 🔑 que seulement connaît l'API.\\nSi quelqu'un touche à l'enveloppe, le cadenas ne s'ouvrira plus avec la 🔑 de l'API : la tentative de hack sera détectée !\\nSi quelqu'un tente de créer une enveloppe sécurisé, il le fera avec une autre clé, \", React.createElement(_components.strong, null, \"🗝\"), \" par exemple, car il ne connaît pas 🔑. L'API, tentant d'ouvrir l'enveloppe sécurisée à l'aide de 🔑, elle ne s'ouvrira pas : la tentative de hacking sera détectée !\"), \"\\n\", React.createElement(_components.p, null, \"💭 Est-ce que cette métaphore d'enveloppe sécurisée vous parle ?\\nAttention que dans la réalité, le payload classique d'un token sera decodable, que l'on connaisse ou pas le secret privé. Il est encodé en base64 ! Ne mettez donc jamais de secrets dans le payload d'un token !\", React.createElement(_components.br), \"\\n\", \"Si vraiment un jour vous deviez mettre un secret dans un payload, bien que déconseillé, vous pourriez toujours le faire en cryptant le payload.\"), \"\\n\", React.createElement(_components.p, null, \"👍 Le mécanisme de token assure que l'on aie une très haute probabilité de détecter les altérations faites sur les tokens, les tentatives de forgeage, grâce à la signature de ceux-ci.\"), \"\\n\", React.createElement(_components.p, null, \"⚡ Par contre, si nous laissions traîner des informations dans le payload d'un token, comme un password d'un utilisateur et son username, alors là, c'est juste un beau cadeau que l'on offre aux hackers ; ils n'auraient plus qu'à trouver un moyen de voler à distance nos données de session ; ils pourraient ensuite utiliser le formulaire de connexion et prendre possession de notre identité 😨.\"), \"\\n\", React.createElement(_components.p, null, \"Il existe un site fort intéressant qui montre la structure d'un token et qui permet de les décoder : \", React.createElement(_components.a, {\n    href: \"https://jwt.io/\"\n  }, \"jwt.io\"), \" \", React.createElement(_components.a, {\n    href: \"/js2/references/#r63\"\n  }, \"[R.63]\"), \". Nous l'utiliserons plus tard pour décoder les tokens générés par nos RESTful API.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Authentification et création de token \")), \"\\n\", React.createElement(_components.h2, null, \"Introduction\"), \"\\n\", React.createElement(_components.p, null, \"Via un exemple concret associé à notre RESTful API qui gère les ressources de type \\\"pizzas\\\" et de type \\\"boisson\\\", nous allons mettre en place un processus d'authentification et d'autorisation JWT.\"), \"\\n\", React.createElement(_components.p, null, \"La librairie que nous allons utiliser dans le cadre de ce cours pour gérer des tokens JWT est \", React.createElement(_components.a, {\n    href: \"https://www.npmjs.com/package/jsonwebtoken\"\n  }, \"jsonwebtoken\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Dans ce nouveau tutoriel, nous allons continuer le développement de l'API \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/ts-demos/tree/main/back/api/services\"\n  }, \"services\"), \" pour ajouter des opérations permettant l'authentification et l'autorisation d'utilisateurs.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer un nouveau projet nommé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \" (dans votre repo git \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/auths\")), \") sur base d'un copié/collé du tutoriel \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/ts-demos/tree/main/back/api/services\"\n  }, \"services\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez installer la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jsonwebtoken\")), \" au sein de votre nouveau projet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i jsonwebtoken\\n\")), \"\\n\", React.createElement(_components.p, null, \"Comme nous utilisons TS, nous devons aussi installer les types de cette librairie :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i -D @types/jsonwebtoken\\n\")), \"\\n\", React.createElement(_components.h2, null, \"Mécanisme d'authentification et création du token\"), \"\\n\", React.createElement(_components.p, null, \"Toujours à l'aide d'Express, nous allons créer un router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \" qui mettra à disposition les opérations de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" et de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \".\\nVoici le contrat associé à ces nouvelles opérations :\"), \"\\n\", React.createElement(_components.h5, null, \"Opérations sur les ressources de type \\\"auths\\\"\"), \"\\n\", React.createElement(_components.table, null, React.createElement(_components.thead, null, React.createElement(_components.tr, null, React.createElement(_components.th, null, \"URI\"), React.createElement(_components.th, null, \"Méthode HTTP\"), React.createElement(_components.th, null, \"Opération\"))), React.createElement(_components.tbody, null, React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths/login\"))), React.createElement(_components.td, null, React.createElement(_components.strong, null, \"POST\")), React.createElement(_components.td, null, \"Vérifier les credentials d'une ressource de type \\\"users\\\" et renvoyer le username et un token JWT si les credentials sont OK\")), React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths/register\"))), React.createElement(_components.td, null, React.createElement(_components.strong, null, \"POST\")), React.createElement(_components.td, null, \"Créer une ressource de type \\\"users\\\" et renvoyer le username et un token JWT\")))), \"\\n\", React.createElement(\"br\"), \"\\n\", React.createElement(_components.p, null, \"Le service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \" s'occupera de créer les utilisateur, de vérifier leurs credentials ainsi que de créer des tokens.\"), \"\\n\", React.createElement(_components.p, null, \"Voici le workflow attendu pour une opération de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" ou de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" :\"), \"\\n\", React.createElement(ScrollableImage, {\n    name: \"login.png\",\n    minWidth: \"879px\",\n    maxWidth: \"879x\"\n  }), \"\\n\", React.createElement(\"figcaption\", null, \"Appel à une RESTful API pour s'authentifier et obtenir un JWT\"), \"\\n\", React.createElement(_components.p, null, \"Ce que l'on voit dans l'image ci-dessus :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"si le service considère que l'utilisateur est authentifiable, que ses credentials sont OK, alors il va utiliser la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"sign\")), \" de l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwt\")), \" pour créer un token.\"), \"\\n\", React.createElement(_components.li, null, \"le token est envoyé dans le body de la réponse à l'utilisateur.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Ce que l'on ne voit pas dans l'image ci-dessus :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"c'est le job du client de sauvegarder le token. Si l'application cliente est un browser, alors celui-ci pourra être sauvegardé dans le web storage du browser.\"), \"\\n\", React.createElement(_components.li, null, \"l'application cliente peut être faite avec n'importe quelle technologie. Par exemple, nous pourrons utiliser REST Client pour faire une requête à l'API...\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Dans notre RESTful API, nous avons décidé que lorsqu'un client s'enregistre, quand il fait appel à l'opération \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" pour créer un compte, l'API considère automatiquement que cet utilisateur est authentifié. Tout comme la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \", la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" créera et renverra un token JWT à l'utilisateur.\"), \"\\n\", React.createElement(_components.p, null, \"NB : Il est possible d'envisager un workflow différent : après le \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", l'application demanderait à l'utilisateur un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \", \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" ne renvoyant jamais de token à l'utilisateur.\"), \"\\n\", React.createElement(_components.h2, null, \"Implémentation de login & register\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons à présent mettre en place le code permettant d'implémenter le workflow que l'on vient de découvrir.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer le service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \" en créant le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/services/users.ts\")), \" et y inclure ce code :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"1,5-6,27-31,33-36,50-54,56-59\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import jwt from \\\"jsonwebtoken\\\";\\nimport path from \\\"node:path\\\";\\nimport { parse, serialize } from \\\"../utils/json\\\";\\nimport { AuthenticatedUser, User } from \\\"../types\\\";\\n\\nconst jwtSecret = \\\"ilovemypizza!\\\";\\nconst lifetimeJwt = 24 * 60 * 60 * 1000; // in ms : 24 * 60 * 60 * 1000 = 24h\\n\\nconst jsonDbPath = path.join(__dirname, \\\"/../data/users.json\\\");\\n\\nconst defaultUsers: User[] = [\\n  {\\n    id: 1,\\n    username: \\\"admin\\\",\\n    password: \\\"admin\\\",\\n  },\\n];\\n\\nfunction login(\\n  username: string,\\n  password: string\\n): AuthenticatedUser | undefined {\\n  const userFound = readOneUserFromUsername(username);\\n  if (!userFound) return undefined;\\n  if (userFound.password !== password) return undefined;\\n\\n  const token = jwt.sign(\\n    { username }, // session data added to the payload (payload : part 2 of a JWT)\\n    jwtSecret, // secret used for the signature (signature part 3 of a JWT)\\n    { expiresIn: lifetimeJwt } // lifetime of the JWT (added to the JWT payload)\\n  );\\n\\n  const authenticatedUser: AuthenticatedUser = {\\n    username,\\n    token,\\n  };\\n\\n  return authenticatedUser;\\n}\\n\\nfunction register(\\n  username: string,\\n  password: string\\n): AuthenticatedUser | undefined {\\n  const userFound = readOneUserFromUsername(username);\\n  if (userFound) return undefined;\\n\\n  createOneUser(username, password);\\n\\n  const token = jwt.sign(\\n    { username }, // session data added to the payload (payload : part 2 of a JWT)\\n    jwtSecret, // secret used for the signature (signature part 3 of a JWT)\\n    { expiresIn: lifetimeJwt } // lifetime of the JWT (added to the JWT payload)\\n  );\\n\\n  const authenticatedUser: AuthenticatedUser = {\\n    username,\\n    token,\\n  };\\n\\n  return authenticatedUser;\\n}\\n\\nfunction readOneUserFromUsername(username: string) {\\n  const users = parse(jsonDbPath, defaultUsers);\\n  const userFound = users.find((user) => user.username === username);\\n  if (!userFound) return undefined;\\n\\n  return userFound;\\n}\\n\\nfunction createOneUser(username: string, password: string) {\\n  const users = parse(jsonDbPath, defaultUsers);\\n\\n  const nextId =\\n    users.reduce((acc, user) => (user.id > acc ? user.id : acc), 0) + 1;\\n\\n  const createdUser: User = {\\n    id: nextId,\\n    username,\\n    password,\\n  };\\n\\n  users.push(createdUser);\\n\\n  serialize(jsonDbPath, users);\\n\\n  return createdUser;\\n}\\n\\nexport { login, register, readOneUserFromUsername };\\n\")), \"\\n\", React.createElement(_components.p, null, \"Dans le code ci-dessus, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwtSecret\")), \" est le secret privé connu uniquement du serveur. C'est la même secret qu'il faudra utiliser pour vérifier un token.\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwt.sign()\")), \" permet de créer le token et ses 3 parties :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"le payload du token, la 2ème partie du token, est complété principalement via le permier argument de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"sign()\")), \" ; ici, le token affirme que l'utilisateur possédant le \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"username\")), \" donné est authentifié.\"), \"\\n\", React.createElement(_components.li, null, \"le payload du token sera aussi modifié sur base de la durée d'expiration du token, selon l'argument \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"expiresIn\")), \".\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwtSecret\")), \" est utilisé pour créer la 3ème partie du token, sa signature.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Pour le service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \", nous avons du créer deux nouveaux types : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"AuthenticatedUser\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"User\")), \". Veuillez mettre à jour le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/types.ts\")), \" et y inclure ce code :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"1-4,6-10,18-19\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"interface AuthenticatedUser {\\n  username: string;\\n  token: string;\\n}\\n\\ninterface User {\\n  id: number;\\n  username: string;\\n  password: string;\\n}\\n\\nexport type {\\n  Pizza,\\n  NewPizza,\\n  PizzaToUpdate,\\n  Drink,\\n  NewDrink,\\n  AuthenticatedUser,\\n  User,\\n};\\n\")), \"\\n\", React.createElement(_components.p, null, \"Il faut maintenant que nous créions le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \" offrant les opérations de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" et de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", en faisant appel au service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \".\", React.createElement(_components.br), \"\\n\", \"Veuillez créer le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/auths.ts\")), \" et y inclure le code suivant :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import { Router } from \\\"express\\\";\\nimport { PotentialUser } from \\\"../types\\\";\\nimport { login, register } from \\\"../services/users\\\";\\nconst router = Router();\\n\\n/* Register a user */\\nrouter.post(\\\"/register\\\", (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"username\\\" in body) ||\\n    !(\\\"password\\\" in body) ||\\n    typeof body.username !== \\\"string\\\" ||\\n    typeof body.password !== \\\"string\\\" ||\\n    !body.username.trim() ||\\n    !body.password.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { username, password } = body as PotentialUser;\\n\\n  const authenticatedUser = register(username, password);\\n\\n  if (!authenticatedUser) {\\n    return res.sendStatus(409);\\n  }\\n\\n  return res.json(authenticatedUser);\\n});\\n\\n/* Login a user */\\nrouter.post(\\\"/login\\\", (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"username\\\" in body) ||\\n    !(\\\"password\\\" in body) ||\\n    typeof body.username !== \\\"string\\\" ||\\n    typeof body.password !== \\\"string\\\" ||\\n    !body.username.trim() ||\\n    !body.password.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { username, password } = body as PotentialUser;\\n\\n  const authenticatedUser = login(username, password);\\n\\n  if (!authenticatedUser) {\\n    return res.sendStatus(401);\\n  }\\n\\n  return res.json(authenticatedUser);\\n});\\n\\nexport default router;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Il n'y a rien de bien spécial à ce code. On fait simplement appel aux opérations du service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \".\", React.createElement(_components.br), \"\\n\", \"Nous avons néanmoins du créer un nouveau type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"PotentialUser\")), \". Veuillez mettre à jour le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/types.ts\")), \" et y inclure ce code :\"), \"\\n\", React.createElement(_components.pre, {\n    highlighting: \"1,11\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"type PotentialUser = Omit<User, \\\"id\\\">;\\n\\nexport type {\\n  Pizza,\\n  NewPizza,\\n  PizzaToUpdate,\\n  Drink,\\n  NewDrink,\\n  AuthenticatedUser,\\n  User,\\n  PotentialUser,\\n};\\n\")), \"\\n\", React.createElement(_components.p, null, \"Attention, il faut rajouter le nouveau router au sein de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"app.js\")), \" pour que notre API puisse offrir les nouvelles opérations ; veuillez donc ajouter ce code dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/app.ts\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"6,24\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import express, { ErrorRequestHandler } from \\\"express\\\";\\n\\nimport usersRouter from \\\"./routes/users\\\";\\nimport pizzaRouter from \\\"./routes/pizzas\\\";\\nimport drinkRouter from \\\"./routes/drinks\\\";\\nimport authsRouter from \\\"./routes/auths\\\";\\n\\nconst app = express();\\n\\napp.use((_req, _res, next) => {\\n  console.log(\\n    \\\"Time:\\\",\\n    new Date().toLocaleString(\\\"fr-FR\\\", { timeZone: \\\"Europe/Brussels\\\" })\\n  );\\n  next();\\n});\\n\\napp.use(express.json());\\napp.use(express.urlencoded({ extended: false }));\\n\\napp.use(\\\"/users\\\", usersRouter);\\napp.use(\\\"/pizzas\\\", pizzaRouter);\\napp.use(\\\"/drinks\\\", drinkRouter);\\napp.use(\\\"/auths\\\", authsRouter);\\n\\nconst errorHandler: ErrorRequestHandler = (err, _req, res, _next) => {\\n  console.error(err.stack);\\n  return res.status(500).send(\\\"Something broke!\\\");\\n};\\n\\napp.use(errorHandler);\\nexport default app;\\n\")), \"\\n\", React.createElement(_components.h2, null, \"Utilisation de Rest Client pour tester les nouvelles opérations\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez démarrer votre API \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"On va utiliser REST Client pour tester ces nouvelles opérations.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/auths.http\")), \" et y ajouter le code suivant :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"@baseUrl = http://localhost:3000\\n\\n### Try to login an unknown user\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"unknown\\\",\\n    \\\"password\\\":\\\"admin\\\"\\n}\\n\\n### Login the default admin\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"admin\\\",\\n    \\\"password\\\":\\\"admin\\\"\\n}\\n\\n\\n### Create the manager user\\nPOST {{baseUrl}}/auths/register\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"manager\\\",\\n    \\\"password\\\":\\\"manager\\\"\\n}\\n\\n### Login the manager user\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"manager\\\",\\n    \\\"password\\\":\\\"manager\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Veuillez exécuter les différentes requêtes. Tout devrait fonctionner, vous devriez récupérer le username et le token d'un utilisateur authentifié.\"), \"\\n\", React.createElement(_components.p, null, \"Pour le fun, nous allons décoder un token :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Veuillez copier le token de ce que renvoie votre API pour la requête de login de l'utilisateur \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"manager\")), \" (qqch qui doit ressembler à une string du genre : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1hbmFnZXIiLCJpYXQiOjE2NjEyNDg1MjksImV4cCI6MTc0NzY0ODUyOX0.JvYzM0gtmVkqFr9R3f1Bf6ow_QuyHJY-vedJ39N7JKw\")), \").\"), \"\\n\", React.createElement(_components.li, null, \"Veuillez vous rendre sur le site \", React.createElement(_components.a, {\n    href: \"https://jwt.io/\"\n  }, \"JWT\"), \" et coller votre token dans le champs \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Encoded\")), \". Dans la colonne \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Decoded\")), \", vous devriez voir l'algorithme utilisé par la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"sign\")), \", ainsi que les données présentes dans le payload, dont \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"\\\"username\\\": \\\"manager\\\"\")), \" !\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Vous comprenez maintenant pourquoi on n'ajoute pas des secrets dans un token 😉.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Autorisation et vérification de token \")), \"\\n\", React.createElement(_components.h2, null, \"Mécanisme d'autorisation d'utilisateurs à des opérations d'une API\"), \"\\n\", React.createElement(_components.h3, null, \"Intro\"), \"\\n\", React.createElement(_components.p, null, \"Dans le workflow que nous avons choisi, les utilisateurs reçoivent un token lors du \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" ou du \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \". C'est le job de l'application cliente de trouver un moyen de sauvegarder ce token.\"), \"\\n\", React.createElement(_components.p, null, \"Lorsqu'une application client souhaite créer une pizza, on souhaite autoriser cette opération qu'à l'administrateur du site gérant la pizzeria.\", React.createElement(_components.br), \"\\n\", \"Nous décidons donc pour l'\", React.createElement(_components.strong, null, \"opération de création de pizza que l'utilisateur doit\"), \" non seulement être \", React.createElement(_components.strong, null, \"authentifié\"), \", mais qu'en plus, il doit être l'\", React.createElement(_components.strong, null, \"admin\"), \" du site.\"), \"\\n\", React.createElement(_components.h3, null, \"Mécanisme d'autorisation quand le token JWT est valide\"), \"\\n\", React.createElement(_components.p, null, \"Pour que l'application client qui fait la requête à l'API puisse s'autoriser, elle doit ajouter un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorization header\")), \" à sa requête contenant comme valeur le token reçu lors du \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" ou du \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" :\"), \"\\n\", React.createElement(ScrollableImage, {\n    name: \"authorizeOK.png\",\n    minWidth: \"879px\",\n    maxWidth: \"879x\"\n  }), \"\\n\", React.createElement(\"figcaption\", null, \"Appel à une opération d'une RESTful API nécessitant une autorisation JWT : autorisation valide\"), \"\\n\", React.createElement(_components.p, null, \"Le router de \\\"pizzas\\\", avant même de passer la requête à la route \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /pizzas\")), \", va lancer la fonction middleware d'autorisation nommée \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \". La fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" va s'occuper de vérifier le token envoyé par le client dans un header à l'aide de la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"verifiy\")), \" de l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwt\")), \" (de la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jsonwebtoken\")), \").\"), \"\\n\", React.createElement(_components.p, null, \"💭 Si le token est valide, est-ce que ça signifie que l'utilisateur est bien authentifié ?\", React.createElement(_components.br), \"\\n\", React.createElement(_components.em, null, \"Hé bien non, car imaginez qu'entre le moment où l'utilisateur se soit logué, il ait été supprimé de l'application par un admin... dans ce cas-ci, on ne veut pas l'autoriser à ajouter une pizza au menu de la pizzeria ! Il n'est p-e même plus un employé, il souhaite p-e écrire du contenu malicieux 😨\")), \"\\n\", React.createElement(_components.p, null, \"Donc si le token est valide, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" fera appel au service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \" pour vérifier que l'utilisateur existe bien dans le support de données (fichiers JSON, base de données ou autres) et pour obtenir toutes les infos sur cet utilisateur. Si l'utilisateur existe, alors cela signifie que l'utilisateur est bien authentifié. La fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" va passer la main à une autre fonction middleware pour vérifier que l'utilisateur est bien l'admin.\"), \"\\n\", React.createElement(_components.p, null, \"💭 Comment est-ce que \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" peut faire appel au service pour vérifier que l'utilisateur existe bien ? Est-ce que cela signifie que le token doit contenir tout un tas de données sur l'utilisateur ?\"), \"\\n\", React.createElement(_components.p, null, \"👍 En règle générale, on va juste mettre un identifiant de l'utilisateur dans ce qu'on appelle le \", React.createElement(_components.strong, null, \"payload\"), \" du token. C'est ensuite l'API, suite au décodage de l'identifiant de l'utilisateur, qui fera appel aux données pour retrouver tout ce qui concerne l'utilisateur.\"), \"\\n\", React.createElement(_components.p, null, \"La fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" va vérifier que l'utilisateur est bien l'admin. Si c'est OK, elle passera la main à la fonction middleware qui gère la route \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /pizzas\")), \" au sein du router de pizzas en faisant l'appel à la fonction \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"next\")), \".\", React.createElement(_components.br), \"\\n\", React.createElement(_components.em, null, \"🍬 NB : on pourrait aussi laisser la fonction \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"creatPizza\")), \" s'occuper de vérifier que l'utilisateur demandant la création de la pizza soit bien l'admin. Ici, comme il s'agit de vérifier que le contrat de l'API soit respecté, c'est-à-dire que l'utilisateur soit bien authentifié & admin, alors on préfère réaliser cette action en dehors du service. Dans nos choix architecturaux pour nos RESTful API, nous avons décidé que ce n'est pas le service qui s'occupe de présenter les données aux clients, c'est le rôle des routers (et les fonctions middleware associées).\")), \"\\n\", React.createElement(_components.p, null, \"Maintenant que le client a les bons privilèges, l'opération de création de la pizza peut donc être autorisée. L'opération de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createPizza\")), \" du service renverra la nouvelle pizza au router qui s'occupera de présenter la nouvelle pizza au client, au format JSON.\"), \"\\n\", React.createElement(_components.h3, null, \"Mécanisme d'autorisation quand le token JWT est invalide\"), \"\\n\", React.createElement(_components.p, null, \"Voici le workflow d'autorisation si le token n'est pas valide :\"), \"\\n\", React.createElement(ScrollableImage, {\n    name: \"authorizeNOK.png\",\n    minWidth: \"879px\",\n    maxWidth: \"879x\"\n  }), \"\\n\", React.createElement(\"figcaption\", null, \"Appel à une opération d'une RESTful API nécessitant une autorisation JWT : autorisation invalide\"), \"\\n\", React.createElement(_components.p, null, \"Dans ce cas là, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" ne passe pas la main à \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" ni même à la fonction middleware qui gère la route \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /pizzas\")), \".\", React.createElement(_components.br), \"\\n\", \"La fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" renvoie directement un code d'erreur \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"401 Unauthorized\")), \" au client.\"), \"\\n\", React.createElement(_components.h3, null, \"Mécanisme d'autorisation quand l'utilisateur n'est pas admin\"), \"\\n\", React.createElement(_components.p, null, \"Vous pourriez aussi imaginer le workflow où le client envoie un token valide, mais l'utilisateur associé n'est pas admin. Dans ce cas-ci, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" ferait appel à \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \", mais \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" renverrait directement un code d'erreur \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"403 Forbidden\")), \" au client.\", React.createElement(_components.br), \"\\n\", \"En effet, l'API indiquerait ainsi qu'elle aurait vérifié que l'utilisateur est bien authentifié, mais que celui ne possède pas les privilèges suffisant pour accéder à l'opération demandée.\"), \"\\n\", React.createElement(_components.h2, null, \"Implémentation du mécanisme d'autorisation\"), \"\\n\", React.createElement(_components.p, null, \"😨 Wow, le workflow d'autorisation pour la création d'une pizza est assez long.\", React.createElement(_components.br), \"\\n\", \"Nous allons maintenant l'implémenter dans notre tutoriel en cours.\", React.createElement(_components.br), \"\\n\", \"Nous vous inquiétez pas, ce qui importe dans le code qui va suivre, ce n'est pas de savoir écrire tout le code, mais de bien comprendre les mécanismes associés. En effet, en règle générale, vous allez utiliser des librairies vous permettant d'autoriser les accès aux opérations de vos API. Vous écrirez donc rarement les mécanismes d'autorisation, par contre, vous devrez pouvoir les utiliser.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer les nouvelles fonctions middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" au sein d'un nouveau fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/utils/auths.ts\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"1,6,13,19-20,28,37\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import jwt from \\\"jsonwebtoken\\\";\\nimport { readOneUserFromUsername } from \\\"../services/users\\\";\\nimport { NextFunction, RequestHandler, Response } from \\\"express\\\";\\nimport { AuthenticatedRequest, JwtPayload, User } from \\\"../types\\\";\\n\\nconst jwtSecret = \\\"ilovemypizza!\\\";\\n\\nconst authorize = (\\n  req: AuthenticatedRequest,\\n  res: Response,\\n  next: NextFunction\\n) => {\\n  const token = req.get(\\\"authorization\\\");\\n  if (!token) {\\n    return res.sendStatus(401);\\n  }\\n\\n  try {\\n    const decoded = jwt.verify(token, jwtSecret) as JwtPayload;\\n    const { username } = decoded;\\n\\n    const existingUser = readOneUserFromUsername(username);\\n\\n    if (!existingUser) {\\n      return res.sendStatus(401);\\n    }\\n\\n    req.user = existingUser; // request.user object is available in all other middleware functions\\n    return next();\\n  } catch (err) {\\n    console.error(\\\"authorize: \\\", err);\\n    return res.sendStatus(401);\\n  }\\n};\\n\\nconst isAdmin: RequestHandler = (req: AuthenticatedRequest, res, next) => {\\n  const { username } = req.user as User;\\n\\n  if (username !== \\\"admin\\\") {\\n    return res.sendStatus(403);\\n  }\\n  return next();\\n};\\n\\nexport { authorize, isAdmin };\\n\")), \"\\n\", React.createElement(_components.p, null, \"Voici quelques explications sur le code de la fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Grâce à \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req.get('authorization')\")), \" (ligne 13), on récupère le token qui a été envoyé par le client au sein de l'\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorization header\")), \" de la requête sous forme de string.\"), \"\\n\", React.createElement(_components.li, null, \"La méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwt.verify(token, jwtSecret)\")), \" (ligne 19) vérifie tant la signature du token que son éventuelle expiration. Elle utilise le secret \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwtSecret\")), \" qui doit être le même que celui pris en compte lors de la création du token.\"), \"\\n\", React.createElement(_components.li, null, \"Elle charge toutes les données de l'utilisateur authentifié au sein de l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req\")), \" (ligne 28), dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"user\")), \". Cela est une bonne pratique, cela permet, pour toute la durée du traitement de cette requête, de mettre à disposition ces données à toutes les fonctions middleware.\", React.createElement(_components.br), \"\\n\", \"💭 Mais pourquoi faire cela ?\\n\", React.createElement(_components.em, null, \"Imaginez que vous faites un appel à une base de données externes à chaque fois que vous souhaitez obtenir les informations d'un utilisateur... Cela est très consommateur en temps... Lorsque vous allez utiliser d'autres fonctions middleware comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \", vous n'avez plus besoin de faire appel à la base de données.\")), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"La fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" récupère les données de l'utilisateur authentifié via l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req.user\")), \".\", React.createElement(_components.br), \"\\n\", \"Si l'utilisateur n'est pas \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \", c'est le code \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"403 Forbidden\")), \" qui est renvoyé à l'application cliente, signifiant que l'utilisateur est bien authentifié, mais il n'a pas les privilèges pour accéder à l'opération demandée (création de pizza).\", React.createElement(_components.br), \"\\n\", \"Si tout est OK, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" fait appel à \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"next()\")), \", ce qui consiste à exécuter la prochaine fonction middleware qui est présente après l'appel de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Pour créer ces deux fonctions middleware, nous avons du créer deux nouveaux types : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"AuthenticatedRequest\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"JwtPayload\")), \". Veuillez mettre à jour le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/types.ts\")), \" et y inclure ce code :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"1,5-7,9-13,24-25\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import { Request } from \\\"express\\\";\\n\\n// Reste du code\\n\\ninterface AuthenticatedRequest extends Request {\\n  user?: User;\\n}\\n\\ninterface JwtPayload {\\n  username: string;\\n  exp: number; // Expiration time (in seconds since the epoch)\\n  iat: number; // Issued at time (in seconds since the epoch)\\n}\\n\\nexport type {\\n  Pizza,\\n  NewPizza,\\n  PizzaToUpdate,\\n  Drink,\\n  NewDrink,\\n  AuthenticatedUser,\\n  User,\\n  PotentialUser,\\n  AuthenticatedRequest,\\n  JwtPayload,\\n};\\n\\n\")), \"\\n\", React.createElement(_components.p, null, \"Ici nous avons ajouté un nouveau type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"AuthenticatedRequest\")), \" qui étend le type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Request\")), \" d'Express, ceci afin de pouvoir ajouter un objet de type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"User\")), \" à \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Nous avons aussi ajouté un nouveau type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"JwtPayload\")), \" qui représente le payload d'un token JWT. Ce type est utilisé pour typer l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"decoded\")), \" retourné par la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"jwt.verify\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Où allons-nous utiliser les nouvelles fonctions middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" ?\"), \"\\n\", React.createElement(_components.p, null, \"Nous pouvons le faire au niveau que nous souhaitons, soit au niveau :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"de l'\", React.createElement(_components.strong, null, \"application\"), \", pour toutes les routes, via \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"app.use(authorize)\")), \".\"), \"\\n\", React.createElement(_components.li, null, \"d'un \", React.createElement(_components.strong, null, \"router\"), \", pour toutes les routes associées ; par exemple, on pourrait dire que toutes les routes du router de pizzas sont protégées par une autorisation JWT. On écrirait : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"app.use(\\\"/pizzas\\\", authorize, pizzaRouter);\")), \".\", React.createElement(_components.br), \"\\n\", \"Cela signifierait que toutes les opérations sur des ressources de type \\\"pizzas\\\" ne seraient autorisées que si l'utilisateur était authentifié. Cela serait problématique pour deux raisons :\", \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"On veut pouvoir afficher le menu des pizzas pour tous les utilisateurs, même s'ils sont anonymes.\"), \"\\n\", React.createElement(_components.li, null, \"On ne veut pas simplement vérifier qu'un utilisateur est authentifié pour créer une pizza, on veut aussi vérifier qu'il est admin.\"), \"\\n\"), \"\\n\"), \"\\n\", React.createElement(_components.li, null, \"d'une route, pour une opération de notre RESTful API. C'est ce que nous souhaitons faire ici. Veuillez mettre à jour le code du router de \\\"pizzas\\\" au sein de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/pizzas.ts\")), \" :\"), \"\\n\"), \"\\n\", React.createElement(_components.pre, {\n    highlighting: \"2,7\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"// Code existant...\\nimport { authorize, isAdmin } from \\\"../utils/auths\\\";\\n\\n// Code existant...\\n\\n// Create a pizza to be added to the menu.\\nrouter.post(\\\"/\\\", authorize, isAdmin, (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"title\\\" in body) ||\\n    !(\\\"content\\\" in body) ||\\n    typeof body.title !== \\\"string\\\" ||\\n    typeof body.content !== \\\"string\\\" ||\\n    !body.title.trim() ||\\n    !body.content.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { title, content } = body as NewPizza;\\n\\n  const addedPizza = createPizza({ title, content });\\n\\n  return res.json(addedPizza);\\n});\\n\")), \"\\n\", React.createElement(_components.p, null, \"Ainsi, nous avons juste fait l'appel de deux fonctions middleware pour vérifier :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"que l'utilisateur est authentifié\"), \" via \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" ; si tout est OK au niveau du token fournit par l'application cliente, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" fait appel via \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"next()\")), \" à la prochaine fonction middleware. Dans ce cas-ci, c'est \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \". S'il y a un problème, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" termine le traitement de la requête en envoyant un code d'erreur au client et les prochaines fonctions middleware (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \", puis la fonction \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"arrow\")), \") ne sont pas exécutées.\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"que l'utilisateur est admin\"), \" via \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" ; si tout est OK, que l'utilisateur authentifié est l'admin, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" fait appel via \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"next()\")), \" à la prochaine fonction middleware. Dans ce cas-ci, c'est la fonction \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"arrow\")), \" qui appelle l'opération demandée pour créer la pizza : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createPizza\")), \". Si l'utilisateur authentifié n'est pas l'admin, alors \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" termine le traitement en envoyant un code d'erreur au client et la fonction traitant de l'opération de création n'est pas exécutée.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Comment pouvons-nous tester l'opération de création d'une pizza ? Via REST Client.\\nTentons le coup à l'aide de cette requête (elle est déjà présente dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/pizzas.http\")), \") :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"POST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Après avoir exécuté cette requête, vous devriez avoir reçu un status code \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"401 Unauthorized\")), \".\\nC'est normal, comme nous n'avons pas envoyé de token, nous ne pouvons donc pas être autorisé.\", React.createElement(_components.br), \"\\n\", \"Au prochain point nous allons voir comment utiliser REST Client pour sauvegarder de l'information, comme un token, suite à une requête vers une API.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Client REST avec JWT \")), \"\\n\", React.createElement(_components.p, null, \"Précédemment, nous avons appris à utiliser REST Client, l'extension de VS Code, pour faire des requêtes vers des API.\"), \"\\n\", React.createElement(_components.p, null, \"Voici quelques notions supplémentaire pour utiliser REST Client avec des \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"JWT\")), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Il est possible de créer des \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Request Variables\")), \" afin de \", React.createElement(_components.strong, null, \"récupérer la réponse\"), \" associée\\nà une requête au sein d'une variable.\"), \"\\n\", React.createElement(_components.li, null, \"On va donc pouvoir récupérer le token, suite à une requête d'authentification,\\nau sein d'une \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Request Variable\")), \", pour ensuite fournir ce token dans le \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Authorization header\")), \" de toutes les requêtes demandant une autorisation JWT.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Si vous souhaitez plus d'infos sur les \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Request Variables\")), \", vous pouvez consulter la \", React.createElement(_components.a, {\n    href: \"https://github.com/Huachao/vscode-restclient#request-variables\"\n  }, \"documentation de REST Client\"), \" \", React.createElement(_components.a, {\n    href: \"/js2/references/#r55\"\n  }, \"[R.55]\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Voici comment mettre à jour le script \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/pizzas.http\")), \" pour créer une pizza en passant le token de l'utilisateur \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"### Create a pizza by using the admin account\\n#### First login as the admin\\n##### Define a request variable named admin :\\n# @name admin\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"admin\\\",\\n    \\\"password\\\":\\\"admin\\\"\\n}\\n\\n#### Create a pizza with the admin token\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\nAuthorization: {{admin.response.body.token}}\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Pour tester l'opération de création de pizza, veuillez d'abord exécuter la première requête, puis la seconde donnée ci-dessus.\"), \"\\n\", React.createElement(_components.p, null, \"A ce stade-ci, il serait aussi intéressant de tester certains cas d'erreurs associés aux tokens. Veuillez compléter le script \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/pizzas.http\")), \" avec :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"### 1. Create a pizza without a token\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\\n### 2. Create a pizza without being the admin, use manager account\\n#### 2.1 First login as the manager\\n##### 2.1.1 Define a request variable nammed manager\\n# @name manager\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"manager\\\",\\n    \\\"password\\\":\\\"manager\\\"\\n}\\n\\n##### 2.1.2 Define a file variable to simplify the access to the token of manager\\n@managerToken = {{manager.response.body.token}}\\n\\n#### 2.2 Try to create a pizza with the manager token\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\nAuthorization: {{managerToken}}\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous voyons qu'à l'aide de REST Client, nous pouvons utiliser une \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"File Variable\")), \" pour allouer une partie de la réponse faite à une requête.\", React.createElement(_components.br), \"\\n\", \"Dans ce cas, on peut faire appel à l'API en passant le token via la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"File Variable\")), \" nommé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"managerToken\")), \" (code associé : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Authorization: {{managerToken}}\")), \") au lieu d'utiliser une partie seulement de la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Request Variable\")), \" nommée \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"manager\")), \" (code possible : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Authorization: {{manager.response.body.token}}\")), \").\", React.createElement(_components.br), \"\\n\", \"Cela permet de créer des requêtes plus concises.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Protection des opérations d'écriture d'une API \")), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour votre RESTful API gérant les pizzas afin que toutes les opérations d'écriture soient protégées par une autorisation JWT, n'autorisant que l'utilisateur \", React.createElement(_components.strong, null, \"admin\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Voici le code à mettre à jour dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/pizzas\")), \" pour correctement autoriser les opérations de suppression et de modification sur des ressources de type \\\"pizzas\\\":\"), \"\\n\", React.createElement(_components.pre, {\n    highlighting: \"2,11\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"// Delete a pizza from the menu based on its id\\nrouter.delete(\\\"/:id\\\", authorize, isAdmin, (req, res) => {\\n  const id = Number(req.params.id);\\n  const deletedPizza = deletePizza(id);\\n  if (!deletedPizza) return res.sendStatus(404);\\n\\n  return res.json(deletedPizza);\\n});\\n\\n// Update a pizza based on its id and new values for its parameters\\nrouter.patch(\\\"/:id\\\", authorize, isAdmin, (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    (\\\"title\\\" in body &&\\n      (typeof body.title !== \\\"string\\\" || !body.title.trim())) ||\\n    (\\\"content\\\" in body &&\\n      (typeof body.content !== \\\"string\\\" || !body.content.trim()))\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const pizzaToUpdate: PizzaToUpdate = body;\\n\\n  const id = Number(req.params.id);\\n  const updatedPizza = updatePizza(id, pizzaToUpdate);\\n  if (!updatedPizza) return res.sendStatus(404);\\n\\n  return res.json(updatedPizza);\\n});\\n\")), \"\\n\", React.createElement(_components.p, null, \"Pour vous assurer que les opérations de suppression et de modification sont bien fonctionnelles, veuillez mettre à jour les requêtes associées afin d'utiliser un token. Veuillez mettre à jour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/pizzas.http\")), \" en ajoutant ces lignes :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"25,30\"\n  }, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"### Delete pizza identified by 2 with the admin token\\nDELETE {{baseUrl}}/pizzas/2\\nAuthorization: {{admin.response.body.token}}\\n\\n### Update the pizza identified by 6 with the admin token\\nPATCH {{baseUrl}}/pizzas/6\\nContent-Type: application/json\\nAuthorization: {{admin.response.body.token}}\\n\\n{\\n    \\\"title\\\":\\\"Magic Green 2\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Veuillez exécutez les requêtes de type \", React.createElement(_components.strong, null, \"DELETE\"), \" et de type \", React.createElement(_components.strong, null, \"PATCH\"), \" afin de vous assurer que l'API est en ordre.\"), \"\\n\", React.createElement(_components.p, null, \"En cas de souci, vous pouvez utiliser le code du tutoriel \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/ts-demos/tree/main/back/api/auths\"\n  }, \"auths\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Si vous le souhaitez, vous pouvez aussi faire les modifications pour les ressources de type \\\"drinks\\\".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/drinks\")), \" pour ajouter l'appel aux fonctions middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" pour les opérations de création, suppression et de modification :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"1,25,34\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"router.post(\\\"/\\\", authorize, isAdmin, (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"title\\\" in body) ||\\n    !(\\\"image\\\" in body) ||\\n    !(\\\"volume\\\" in body) ||\\n    !(\\\"price\\\" in body) ||\\n    typeof body.title !== \\\"string\\\" ||\\n    typeof body.image !== \\\"string\\\" ||\\n    typeof body.volume !== \\\"number\\\" ||\\n    typeof body.price !== \\\"number\\\" ||\\n    !body.title.trim() ||\\n    !body.image.trim() ||\\n    body.volume <= 0 ||\\n    body.price <= 0\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { title, image, volume, price } = body as NewDrink;\\n\\n  const newDrink = createOneDrink({ title, image, volume, price });\\n  return res.json(newDrink);\\n});\\n\\nrouter.delete(\\\"/:id\\\", authorize, isAdmin, (req, res) => {\\n  const id = Number(req.params.id);\\n  const deletedDrink = deleteOneDrink(id);\\n  if (!deletedDrink) {\\n    return res.sendStatus(404);\\n  }\\n  return res.json(deletedDrink);\\n});\\n\\nrouter.patch(\\\"/:id\\\", authorize, isAdmin, (req, res) => {\\n  const id = Number(req.params.id);\\n\\n  const body: unknown = req.body;\\n\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    (\\\"title\\\" in body &&\\n      (typeof body.title !== \\\"string\\\" || !body.title.trim())) ||\\n    (\\\"image\\\" in body &&\\n      (typeof body.image !== \\\"string\\\" || !body.image.trim())) ||\\n    (\\\"volume\\\" in body &&\\n      (typeof body.volume !== \\\"number\\\" || body.volume <= 0)) ||\\n    (\\\"price\\\" in body && (typeof body.price !== \\\"number\\\" || body.price <= 0))\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { title, image, volume, price }: Partial<NewDrink> = body;\\n\\n  const updatedDrink = updateOneDrink(id, { title, image, volume, price });\\n\\n  if (!updatedDrink) {\\n    return res.sendStatus(404);\\n  }\\n\\n  return res.json(updatedDrink);\\n});\\n\")), \"\\n\", React.createElement(_components.p, null, \"N'oubliez pas de faire l'import de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorize\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"isAdmin\")), \" au début du fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/drinks.ts\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Pour tester les opérations de création, de suppression et de modification sur des ressources de type \\\"drinks\\\", veuillez mettre à jour le script \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/drinks.http\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"12-20,25,38,49,55\"\n  }, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"### Read all drinks with File variable\\n@baseUrl = http://localhost:3000\\nGET {{baseUrl}}/drinks\\n\\n### Read a single drink\\nGET {{baseUrl}}/drinks/3\\n\\n### Read all drinks cheaper or equal to 3 €\\nGET {{baseUrl}}/drinks/?budget-max=3\\n\\n### Create a drink\\n##### Define a request variable named admin :\\n# @name admin\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"admin\\\",\\n    \\\"password\\\":\\\"admin\\\"\\n}\\n\\n### Create a drink with the admin token\\nPOST {{baseUrl}}/drinks\\nContent-Type: application/json\\nAuthorization: {{admin.response.body.token}}\\n\\n{\\n    \\\"title\\\":\\\"Virgin Tonic\\\",\\n    \\\"image\\\":\\\"https://plus.unsplash.com/premium_photo-1668771899398-1cdd763f745e?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\\\",\\n    \\\"volume\\\":0.25,\\n    \\\"price\\\":4.5    \\n}\\n\\n\\n### Try to create a drink with incomplete data\\nPOST {{baseUrl}}/drinks\\nContent-Type: application/json\\nAuthorization: {{admin.response.body.token}}\\n\\n\\n{\\n    \\\"title\\\":\\\"Missing Data Drink\\\",\\n    \\\"volume\\\":0.25,\\n    \\\"price\\\":4.5    \\n}\\n\\n### Delete a drink\\nDELETE {{baseUrl}}/drinks/5\\nAuthorization: {{admin.response.body.token}}\\n\\n\\n### Update a drink\\nPATCH {{baseUrl}}/drinks/3\\nContent-Type: application/json\\nAuthorization: {{admin.response.body.token}}\\n\\n{\\n    \\\"title\\\":\\\"Citronnade\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Sécurisation des passwords \")), \"\\n\", React.createElement(_components.p, null, \"Nous souhaitons maintenant assurer que les passwords enregistrés dans un support de données (un fichier ou une base de données) ne puissent pas être récupérés.\"), \"\\n\", React.createElement(_components.p, null, \"👍 Pour ce faire, il est recommandé d'hacher les passwords avant de les enregistrer au niveau d'une API.\"), \"\\n\", React.createElement(_components.p, null, \"Afin de se protéger contre les \\\"hash attacks\\\", on utilise du \", React.createElement(_components.strong, null, \"salt\"), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"un \", React.createElement(_components.strong, null, \"salt\"), \" : c'est une donnée aléatoire qui est utilisé en entrée d'une fonction qui hache des données. Ainsi, si un hacker utilise une base de données de passwords hachés, il devra en plus trouver le bon \", React.createElement(_components.strong, null, \"salt\"), \" pour que son attaque puisse fonctionner.\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"salt round\"), \" : nombre de fois que l'opération de hachage est faite, rendant les attaques de force brute plus lente et donc difficile ; une valeur de \", React.createElement(_components.strong, null, \"10\"), \" semble être généralement raisonnable et recommandée.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Pour hacher sous Node.js, nous utiliserons la librairie \", React.createElement(_components.a, {\n    href: \"https://www.npmjs.com/package/bcrypt\"\n  }, \"bcrypt\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez installer la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" et les types associés à bcrypt au sein de votre API \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i bcrypt \\nnpm i @types/bcrypt -D\\n\")), \"\\n\", React.createElement(_components.p, null, \"En résumé, nous allons utiliser :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"hash\")), \" de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" pour \", React.createElement(_components.strong, null, \"hacher un password\"), \" ;\"), \"\\n\", React.createElement(_components.li, null, \"la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"compare\")), \" de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" pour \", React.createElement(_components.strong, null, \"comparer un password en clair à un password haché\"), \" ; si le résultat est positif, cela signifie que le password fournit pour un utilisateur correspond au password initial.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Nous préférons utiliser les librairies asynchrone afin que l'API reste disponible à gérer des requêtes clientes et ne bloque pas celles-ci jusqu'à la fin d'une opération de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" !\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez effacer le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/data/users.json\")), \" contenant les credentials d'utilisateurs où les passwords sont donnés en clair.\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant mettre à jour le service \\\"users\\\" pour utiliser \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \". Veuillez modifier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/services/users.ts\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"2,10,18,22,25,28-29,45,48,52,76,79,87\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import jwt from \\\"jsonwebtoken\\\";\\nimport bcrypt from \\\"bcrypt\\\";\\nimport path from \\\"node:path\\\";\\nimport { parse, serialize } from \\\"../utils/json\\\";\\nimport { AuthenticatedUser, User } from \\\"../types\\\";\\n\\nconst jwtSecret = \\\"ilovemypizza!\\\";\\nconst lifetimeJwt = 24 * 60 * 60 * 1000; // in ms : 24 * 60 * 60 * 1000 = 24h\\n\\nconst saltRounds = 10;\\n\\nconst jsonDbPath = path.join(__dirname, \\\"/../data/users.json\\\");\\n\\nconst defaultUsers: User[] = [\\n  {\\n    id: 1,\\n    username: \\\"admin\\\",\\n    password: bcrypt.hashSync(\\\"admin\\\", saltRounds),\\n  },\\n];\\n\\nasync function login(\\n  username: string,\\n  password: string\\n): Promise<AuthenticatedUser | undefined> {\\n  const userFound = readOneUserFromUsername(username);\\n  if (!userFound) return undefined;\\n  const passwordMatch = await bcrypt.compare(password, userFound.password);\\n  if (!passwordMatch) return undefined;\\n\\n  const token = jwt.sign(\\n    { username }, // session data added to the payload (payload : part 2 of a JWT)\\n    jwtSecret, // secret used for the signature (signature part 3 of a JWT)\\n    { expiresIn: lifetimeJwt } // lifetime of the JWT (added to the JWT payload)\\n  );\\n\\n  const authenticatedUser: AuthenticatedUser = {\\n    username,\\n    token,\\n  };\\n\\n  return authenticatedUser;\\n}\\n\\nasync function register(\\n  username: string,\\n  password: string\\n): Promise<AuthenticatedUser | undefined> {\\n  const userFound = readOneUserFromUsername(username);\\n  if (userFound) return undefined;\\n\\n  await createOneUser(username, password);\\n\\n  const token = jwt.sign(\\n    { username }, // session data added to the payload (payload : part 2 of a JWT)\\n    jwtSecret, // secret used for the signature (signature part 3 of a JWT)\\n    { expiresIn: lifetimeJwt } // lifetime of the JWT (added to the JWT payload)\\n  );\\n\\n  const authenticatedUser: AuthenticatedUser = {\\n    username,\\n    token,\\n  };\\n\\n  return authenticatedUser;\\n}\\n\\nfunction readOneUserFromUsername(username: string) {\\n  const users = parse(jsonDbPath, defaultUsers);\\n  const userFound = users.find((user) => user.username === username);\\n  if (!userFound) return undefined;\\n\\n  return userFound;\\n}\\n\\nasync function createOneUser(username: string, password: string) {\\n  const users = parse(jsonDbPath, defaultUsers);\\n\\n  const hashedPassword = await bcrypt.hash(password, saltRounds);\\n\\n  const nextId =\\n    users.reduce((acc, user) => (user.id > acc ? user.id : acc), 0) + 1;\\n\\n  const createdUser: User = {\\n    id: nextId,\\n    username,\\n    password: hashedPassword,\\n  };\\n\\n  users.push(createdUser);\\n\\n  serialize(jsonDbPath, users);\\n\\n  return createdUser;\\n}\\n\\nexport { login, register, readOneUserFromUsername };\\n\")), \"\\n\", React.createElement(_components.p, null, \"Voici les modifications apportées :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour créer un password haché\"), \" : on utilise la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"hash\")), \" pour créer le password haché. Dès lors, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createOneUser\")), \" devient asynchrone. De plus, comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createOneUser\")), \" est devenue asynchrone, dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", pour chaîner le traitement de création du token, on met un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \" à l'appel de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createOneUser\")), \". Et comme un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \" est ajouté au sein de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", il faut mettre un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"async\")), \" à la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \". Attention, du coup, comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" est devenue asynchrone, il faudra aussi bien chaîner les traitements où \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" est appelé, dans le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \". Notez aussi que nous avons changé le type de retour des fonctions asynchrones qui renvoient maintenant des \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Promise\")), \".\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour vérifier qu'un password en clair \\\"match\\\" à un password haché\"), \" : on utilise la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"compare\")), \" que l'on chaîne à la création du token à l'aide de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \". Dès lors, la fonction \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" doit elle aussi être déclarée \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"async\")), \". Attention, du coup, comme \", React.createElement(_components.code, null, \"login\"), \" est devenue asynchrone, il faudra bien chaîner les traitements où \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" est appelé, dans le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \".\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour créer l'utilisateur \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \" se trouvant dans les \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"defaultUsers\")), \" avec des credentials par défaut\"), \" : on souhaite indiquer comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"password\")), \" le password haché correspondant au password \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"\\\"admin\\\"\")), \". Pour se simplifier la vie, on appelle la fonction synchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"hashSync\")), \" (voir ligne 18). Bien évidemment, dans une application robuste et sécurisée, il est interdit de coder en dur ce genre de secrets dans les sources de notre application 😉 !\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Afin de traiter des deux fonctions du service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \" qui sont devenues asynchrones, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", nous allons modifier le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/auths\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"13,30,40,57\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"/* eslint-disable @typescript-eslint/no-misused-promises */\\n/* \\nIn Express V4, asynchronous functions are not fully supported in TypeScript \\n(only void return type for RequestHandler is allowed). \\nIn Express V5, this issue has been addressed, but V5 is still in beta. \\nConsequently, the ESLint rule \\\"no-misused-promises\\\" is disabled. */\\nimport { Router } from \\\"express\\\";\\nimport { PotentialUser } from \\\"../types\\\";\\nimport { login, register } from \\\"../services/users\\\";\\nconst router = Router();\\n\\n/* Register a user */\\nrouter.post(\\\"/register\\\", async (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"username\\\" in body) ||\\n    !(\\\"password\\\" in body) ||\\n    typeof body.username !== \\\"string\\\" ||\\n    typeof body.password !== \\\"string\\\" ||\\n    !body.username.trim() ||\\n    !body.password.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { username, password } = body as PotentialUser;\\n\\n  const authenticatedUser = await register(username, password);\\n\\n  if (!authenticatedUser) {\\n    return res.sendStatus(409);\\n  }\\n\\n  return res.json(authenticatedUser);\\n});\\n\\n/* Login a user */\\nrouter.post(\\\"/login\\\", async (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"username\\\" in body) ||\\n    !(\\\"password\\\" in body) ||\\n    typeof body.username !== \\\"string\\\" ||\\n    typeof body.password !== \\\"string\\\" ||\\n    !body.username.trim() ||\\n    !body.password.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { username, password } = body as PotentialUser;\\n\\n  const authenticatedUser = await login(username, password);\\n\\n  if (!authenticatedUser) {\\n    return res.sendStatus(401);\\n  }\\n\\n  return res.json(authenticatedUser);\\n});\\n\\nexport default router;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous avons simplement chaîné les réponses à faire au client seulement une fois les opérations \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" terminées. Pour ce faire, nous avons précédé le nom de ces méthodes par \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \". Nous avons donc du ajouter \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"async\")), \" aux fonctions middleware s'occupant des routes \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /auths/register\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /auths/login\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Notons que nous avons ajouté un commentaire pour désactiver la règle \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"@typescript-eslint/no-misused-promises\")), \". En effet, dans Express V4, les fonctions asynchrones ne sont pas pleinement supportées en TypeScript (seul le type de retour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"void\")), \" pour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"RequestHandler\")), \" est autorisé). Dans Express V5, ce problème a été résolu, mais V5 est toujours en version bêta. Par conséquent, la règle ESLint \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"no-misused-promises\")), \" est désactivée.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez vérifier que votre application fonctionne correctement.\", React.createElement(_components.br), \"\\n\", \"Via l'IHM, veuillez faire un register d'un nouvel utilisateur.\", React.createElement(_components.br), \"\\n\", \"Au niveau de l'API, allez voir le contenu du nouveau fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/data/users.json\")), \". Les passwords devraient maintenant être hachés, comme par exemple :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-json\"\n  }, \"[\\n  {\\n    \\\"id\\\": 1,\\n    \\\"username\\\": \\\"admin\\\",\\n    \\\"password\\\": \\\"$2b$10$RioLKlPFyYFEhv/46gR7dufDkke07eDpWH9tBt/A4Z9tJh0oJnnf2\\\"\\n  },\\n  {\\n    \\\"id\\\": 2,\\n    \\\"username\\\": \\\"manager\\\",\\n    \\\"password\\\": \\\"$2b$10$NZZ1zxOPdby6gl4Dw8K0Q.v4ZRWTbh1Ta7qcYzH5G4SrO5z71H0kO\\\"\\n  }\\n]\\n\")), \"\\n\", React.createElement(_components.p, null, \"En cas de souci, vous pouvez utiliser le code du tutoriel \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/ts-demos/tree/main/back/api/auths\"\n  }, \"auths\"), \".\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Exercice 3.1 : Authentification & autorisation d'opérations \")), \"\\n\", React.createElement(_components.p, null, \"Vous allez sécuriser la RESTful API de \", React.createElement(_components.strong, null, \"myMovies\"), \".\"), \"\\n\", React.createElement(_components.h2, null, \"Mise en place du projet\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer un nouveau projet ans votre repo git dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/exercises/3.1\")), \" en clonant le boilerplate du cours offrant l'authentification et l'autorisation JWT : \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/jwt-ts-api-boilerplate\"\n  }, \"jwt-ts-api-boilerplate\"), \". Dans ce boilerplate, vous trouverez déjà un service \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \" qui gère les utilisateurs, ainsi que des routes pour les opérations de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" et de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"⚡️ Attention, n'oubliez pas les soucis d'avoir un git dans le git... Pensez à supprimer le dossier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \".git\")), \" de votre nouveau projet.\"), \"\\n\", React.createElement(_components.h2, null, \"Identification des opérations & création de la documentation de l'API\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant passer à une phase d'analyse de votre API. Nous allons documenter les opérations de votre API, ainsi que les opérations qui seront protégées par JWT.\"), \"\\n\", React.createElement(_components.p, null, \"Pour les opérations existantes sur des films, vous devez planifier de protéger les opérations d'écriture (création, modification, suppression) de vos films par JWT. Les opérations de lecture de films ne doivent pas être protégées par JWT.\"), \"\\n\", React.createElement(_components.p, null, \"Pour la protection des opérations, vous ne devrez pas gérer de rôles, mais simplement vérifier que l'utilisateur est authentifié.\"), \"\\n\", React.createElement(_components.p, null, \"Vous devez planifier des nouvelles opérations :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"lire tous les commentaires et pouvoir les filtrer par film ;\"), \"\\n\", React.createElement(_components.li, null, \"ajouter des commentaires sur un film, en y associant l'utilisateur ou l'utilisatrice authentifiée ;\"), \"\\n\", React.createElement(_components.li, null, \"effacer un commentaire sur un film sur base de l'utilisateur ou de l'utilisatrice authentifiée.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez identifier toutes les opérations mises à disposition par votre API (y compris l'authentification), ainsi que si celles-ci sont protégées par JWT, au sein du fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"README.md\")), \" (fichier Markdown) de votre projet. Voici un exemple de comment nous vous recommandons de documenter votre API, sous forme de tableau :\"), \"\\n\", React.createElement(_components.table, null, React.createElement(_components.thead, null, React.createElement(_components.tr, null, React.createElement(_components.th, null, \"URI\"), React.createElement(_components.th, null, \"Méthode HTTP\"), React.createElement(_components.th, null, \"Auths?\"), React.createElement(_components.th, null, \"Opération\"))), React.createElement(_components.tbody, null, React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"films\"))), React.createElement(_components.td, null, \"GET\"), React.createElement(_components.td, null, \"Non\"), React.createElement(_components.td, null, \"READ ALL : Lire toutes les ressources de la collection\")), React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"films/:id\"))), React.createElement(_components.td, null, \"GET\"), React.createElement(_components.td, null, \"Non\"), React.createElement(_components.td, null, \"READ ALL : Lire une ressource de la collection\")), React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"films\"))), React.createElement(_components.td, null, \"POST\"), React.createElement(_components.td, null, \"Oui\"), React.createElement(_components.td, null, \"CREATE ONE : Créer une ressource de la collection basée sur un body au format \", React.createElement(_components.code, null, \"{title: string; director: string;  duration: number;  budget?: number;  description?: string;  imageUrl?: string;  }\"))), React.createElement(_components.tr, null, React.createElement(_components.td, null, \"...\"), React.createElement(_components.td, null, \"...\"), React.createElement(_components.td, null, \"...\"), React.createElement(_components.td, null, \"...\")), React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"comments\"))), React.createElement(_components.td, null, \"GET\"), React.createElement(_components.td, null, \"JWT\"), React.createElement(_components.td, null, \"READ ALL FILTERED : Lire toutes les ressources de la collection\")), React.createElement(_components.tr, null, React.createElement(_components.td, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"comments\"))), React.createElement(_components.td, null, \"POST\"), React.createElement(_components.td, null, \"JWT\"), React.createElement(_components.td, null, \"CREATE ONE : Créer une ressource basée sur un body au format \", React.createElement(_components.code, null, \"{...}\"))), React.createElement(_components.tr, null, React.createElement(_components.td, null, \"...\"), React.createElement(_components.td, null, \"...\"), React.createElement(_components.td, null, \"...\"), React.createElement(_components.td, null, \"...\")))), \"\\n\", React.createElement(\"br\"), \"\\n\", React.createElement(_components.p, null, \"Comment créer un tableau dans un fichier Markdown (pour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"README.md\")), \") ?\", React.createElement(_components.br), \"\\n\", \"Voici deux options :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Soit vous utiliser des \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"|\")), \" pour délimiter les cellules et des \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"|---|\")), \" pour séparer les headers du corps du tableau.\\nVoici le Markdown de l'exemple donné ci-dessus :\"), \"\\n\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-text\"\n  }, \"| URI | Méthode HTTP | Auths? | Opération |\\n|---|---|---|---|\\n| **`films`** | GET | Non | READ ALL : Lire toutes les ressources de la collection |\\n| **`films/:id`** | GET | Non | READ ALL : Lire une ressource de la collection |\\n| **`films`** | POST | Oui | CREATE ONE : Créer une ressource de la collection basée sur un body au format `{title: string; director: string;  duration: number;  budget?: number;  description?: string;  imageUrl?: string;  }` |\\n| ... | ... | ... | ... |\\n| **`comments`** | GET | JWT | READ ALL FILTERED : Lire toutes les ressources de la collection |\\n| **`comments`** | POST | JWT | CREATE ONE : Créer une ressource basée sur un body au format `{...}` |\\n| ... | ... | ... | ... |\\n\")), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Soit c'est simplement un tableau HTML (\", React.createElement(_components.code, null, \"<table>\"), \").\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Une fois la documentation de votre API prête, veuillez faire un commit avec le message suivant : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"new:ex3.1-doc\")), \".\"), \"\\n\", React.createElement(_components.h2, null, \"Sécuriser les opérations d'écriture pour les films\"), \"\\n\", React.createElement(_components.p, null, \"Vous allez maintenant travailler sur le code de votre nouveau projet.\"), \"\\n\", React.createElement(_components.p, null, \"Dans votre nouveau projet, dans un premier temps, sans utiliser JWT, veuillez intégrer le code utile de vos opérations (router & service de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"films\")), \", requêtes HTTP pour tester les opérations sur les \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"films\")), \") de votre \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/exercises/1.8\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez protéger les opérations d'écriture (création, modification, suppression) de vos films par JWT (en intégrant l'authentification) et vérifier que les opérations protégées fonctionnent correctement via REST Client.\", React.createElement(_components.br), \"\\n\", \"Vous devez assurer qu'un utilisateur non authentifié ne puisse pas créer, modifier ou supprimer un film.\"), \"\\n\", React.createElement(_components.p, null, \"Une fois tout fonctionnel, veuillez faire un commit avec le message suivant : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"new:ex3.1\")), \".\"), \"\\n\", React.createElement(_components.h2, null, \"Implémenter les opérations associées aux commentaires\"), \"\\n\", React.createElement(_components.p, null, \"Vous pouvez implémenter les nouvelles opérations de gestion de commentaires et les protéger par JWT.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez vérifier que vos opérations sont bien protégées et fonctionnelles en les testant avec Rest Client.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez bien nettoyer votre code et ne pas laisser de code mort.\"), \"\\n\", React.createElement(_components.p, null, \"Quand votre api est finalisée et testée, veuillez faire un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"commit\")), \" de votre code avec comme message : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"new: ex3.1-comments\")), \".\"), \"\\n\", React.createElement(_components.h2, null, \"Sécurisation de vos opérations\"), \"\\n\", React.createElement(_components.p, null, \"💭 Avez-vous bien protégé vos opérations ?\", React.createElement(_components.br), \"\\n\", \"Est-ce que pour l'opération de création d'un commentaire, vous avez bien associé l'utilisateur ou l'utilisatrice authentifiée à ce commentaire sur base du token fourni par l'application cliente ? En effet, si vous utilisez le body pour valider le username sans checker le token, il est facilement possible de modifier le body et de créer un commentaire au nom d'un autre utilisateur...\", React.createElement(_components.br), \"\\n\", \"De même pour l'opération de suppression d'un commentaire, avez-vous avez bien vérifié l'utilisateur ou l'utilisatrice authentifiée via le token ? Ou est-ce que vous avez simplement vérifié le username à partir de l'URL ?\"), \"\\n\", React.createElement(_components.p, null, \"💭 Concernant la gestion du contrat associé à vos opérations, les status codes, avez-vous pensé à :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"vérifier lors de la création d'un commentaire que le film existe bien ? que l'utilisateur ou l'utilisatrice n'a pas déjà commenté ce film ?\"), \"\\n\", React.createElement(_components.li, null, \"vérifier lors de la suppression d'un commentaire que le commentaire existe bien pour l'utilisateur ou l'utilisatrice authentifiée et pour le film indiqué e ?\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Si nécessaire, veuillez mettre à jour votre API, sa documentation et vos tests pour corriger les éventuelles soucis.\"), \"\\n\", React.createElement(_components.p, null, \"Quand votre api est finalisée et testée, veuillez faire un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"commit\")), \" de votre code avec comme message : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"new: ex3.1-sécurité\")), \".\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" 🍬 Exercice 3.2 : une autre API sécurisée \")), \"\\n\", React.createElement(_components.p, null, \"Cet exercice est optionnel, n'hésitez pas à le faire si vous avez du temps.\"), \"\\n\", React.createElement(_components.p, null, \"Peut-être avez-vous déjà entendu parler de cette mode montante dans le Web qu'est la JAMstack ?\"), \"\\n\", React.createElement(_components.p, null, \"Nous souhaitons développer un Headless CMS, c'est-à-dire un outil permettant de créer du contenu, très souvent utilisé dans le cadre de sites JAMstack.\"), \"\\n\", React.createElement(_components.p, null, \"Un Headless CMS fournira une interface web pour créer du contenu (ou des données), ainsi qu'une RESTful API mettant à disposition ce contenu.\"), \"\\n\", React.createElement(_components.p, null, \"L'Headless CMS que nous souhaitons développer doit permettre de créer le contenu associé à un blog.\"), \"\\n\", React.createElement(_components.p, null, \"Un blog sera structuré en pages. Une page aura un id, un titre, un URI, un contenu, un auteur ainsi qu'un statut de publication.\"), \"\\n\", React.createElement(_components.p, null, \"Le statut de publication d'une page peut actuellement prendre comme valeur :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"« hidden »\"), \"\\n\", React.createElement(_components.li, null, \"« published »\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Seul un utilisateur authentifié pourra lire, créer, modifier ou supprimer des pages.\"), \"\\n\", React.createElement(_components.p, null, \"La modification d'une page, tout comme la suppression d'une page ne pourra se faire que par son auteur.\"), \"\\n\", React.createElement(_components.p, null, \"L'ajout ou la modification d'une page ne sera possible que si le statut de publication donné correspond à un des deux statuts actuels (« hidden ou « published »). Sinon un message d'erreur devra être renvoyé.\"), \"\\n\", React.createElement(_components.p, null, \"La lecture d'une page, ou de toutes les pages, pourra être réalisée par n'importe quel utilisateur authentifié pour les pages dont le statut vaut « published ».\"), \"\\n\", React.createElement(_components.p, null, \"Pour les pages dont le statut vaut « hidden », seul leur auteur authentifié pourra les lire.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer un nouveau projet dans votre repo git dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/exercises/3.2\")), \" sur base du boilerplate : \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/jwt-ts-api-boilerplate\"\n  }, \"jwt-ts-api-boilerplate\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"⚡ Si vous avez fait un clone du boilerplate, attention au Git dans le Git, n'oubliez pas de supprimer le dossier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \".git\")), \" présent dans votre nouveau projet.\"), \"\\n\", React.createElement(_components.p, null, \"Puis, veuillez formaliser les opérations associées à vos RESTful APIs sous forme d'un tableau dans un fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"README.md\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez tester toutes les méthodes offertes par votre application à l'aide du client HTTP de REST Client.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez faire un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"commit\")), \" de votre code avec le message suivant : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"new: ex3.2\")), \".\"), \"\\n\", React.createElement(_components.h2, null, \"🍬 Bonus\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"N°1 : vous souhaitez rapidement découvrir les principes d'une architecture Web associée à la JAMstack ? \", React.createElement(_components.a, {\n    href: \"https://jamstack.wtf/\"\n  }, \"https://jamstack.wtf/\")), \"\\n\", React.createElement(_components.li, null, \"N°2 : si vous souhaitez découvrir le format Markdown, notamment très souvent utilisé dans certains sites JAMstack (source des données pour certains Headless CMS) : \", React.createElement(_components.a, {\n    href: \"https://www.markdownguide.org/basic-syntax/\"\n  }, \"https://www.markdownguide.org/basic-syntax/\")), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"🍬 Challenges\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"N°1 : Modifiez les autorisations au niveau des opérations de lecture : la lecture d'une page, ou de toutes les pages, pourra être réalisée par n'importe quel utilisateur anonyme ou authentifié pour les pages dont le statut vaut « published ». Pour les pages dont le statut vaut « hidden », seul leur auteur authentifié pourra les lire.\"), \"\\n\", React.createElement(_components.li, null, \"N°2 : lorsqu'un utilisateur tente d'effacer ou modifier une page dont il n'est pas l'auteur, renvoyez un code d'erreur approprié au client.\"), \"\\n\", React.createElement(_components.li, null, \"N°3 : Si ça n'est pas déjà fait, pensez à ne pas renvoyer les passwords des utilisateurs dans les réponses de votre API.\"), \"\\n\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" 🍬 Authentification & autorisation JWT à l'aide de cookies \")), \"\\n\", React.createElement(_components.h2, null, \"Pourquoi utiliser l'autorisation JWT à l'aide de cookies ?\"), \"\\n\", React.createElement(_components.p, null, \"Nous avons vu une façon de gérer des token JWT, sans gérer de cookies.\"), \"\\n\", React.createElement(_components.p, null, \"Cela impose aux client de sauvegarder les tokens et de les envoyer dans un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorization header\")), \" lorsqu'ils souhaitent accéder à une opération protégée.\"), \"\\n\", React.createElement(_components.p, null, \"Il est aussi possible d'intégrer les tokens au sein de cookies. Dans ce cas-là, les clients qui ont reçu un cookie de l'API renverront automatiquement ce cookie (mécanisme des browsers). Les tokens JWT voyageront automatiquement grâce au mécanisme de cookies.\"), \"\\n\", React.createElement(_components.p, null, \"💭 Faut-il mieux intégrer les token JWT dans des cookies ou pas ?\", React.createElement(_components.br), \"\\n\", \"Il est difficile de donner une réponse à cette question. Chaque approche a des avantages et des inconvénients. Ce qui devrait être le point d'attention, c'est la sécurité. Et dans les deux cas, on atteint un niveau de sécurité raisonnable.\\nPour ce cours, nous avons choisi la façon la plus moderne, en laissant au client le choix de sauvegarder les token dans le web storage (nous allons voir ça tout prochainement pour l'aspect frontend).\", React.createElement(_components.br), \"\\n\", \"Notons que le cas le plus sûr est probablement d'avoir deux types de token, ce qui est d'une complexité qui dépasse les objectifs de ce cours. Néanmoins, pour votre info, les mécanismes d'authentification comme OAuth (authorization de MS Azure) & OpenID Connect (authentification de MS Azure) gère deux types de token :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"un token à durée de vie courte qui sera enregistré en mémoire vive au niveau du client (access token) ou dans le web storage.\"), \"\\n\", React.createElement(_components.li, null, \"un token à durée de vie longue qui sera enregistré par le client dans un cookie (refresh token, notamment utilisé par l'API pour créer un nouvel access token).\"), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"Un cookie, c'est quoi ?\"), \"\\n\", React.createElement(_components.p, null, \"Un \", React.createElement(_components.strong, null, \"cookie\"), \" représente des données qu'un serveur envoie à un browser.\", React.createElement(_components.br), \"\\n\", \"Le browser peut sauver ce cookie. Pour chaque requête faite au serveur sur la même origine (que l'origine où le cookie a été reçu), le cookie sera automatiquement envoyé au serveur.\"), \"\\n\", React.createElement(_components.p, null, \"Il fut un temps où les cookies étaient utilisés comme un mécanisme général de stockage de données côté client.\"), \"\\n\", React.createElement(_components.p, null, \"👍 Actuellement, si les cookies sont utilisés pour sauvegarder les données de session, il faut se protéger contre les attaques XSS et rendre les cookies inaccessibles au JavaScript : on utilise donc les cookies \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HttpOnly\")), \" qui sont inaccessibles à la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Document.cookie API\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Pour la suite, on va donc voir :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"comment utiliser Express pour créer des cookies au niveau d'une API ;\"), \"\\n\", React.createElement(_components.li, null, \"comment rendre ces cookies inaccessibles aux attaques XSS en configurant \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HttpOnly\")), \".\"), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"Implémentation de l'authentification & l'autorisation JWT au sein de cookies\"), \"\\n\", React.createElement(_components.h3, null, \"Intro\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons donc créer une nouvelle version de l'API sauvegardant le token d'un utilisateur au sein d'un cookie, ainsi que son username, sans que ces infos soient accessible au JS côté client.\"), \"\\n\", React.createElement(_components.p, null, \"Pour ce faire nous allons utiliser la librairie \", React.createElement(_components.a, {\n    href: \"https://github.com/expressjs/cookie-session\"\n  }, \"cookie-session\"), \" qui permet d'enregistrer des données de session dans des cookies.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez créer un nouveau projet nommé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/back/api/cookies\")), \" sur base d'un copié/collé du projet \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/ts-demos/tree/main/back/api/auths\"\n  }, \"auths\"), \").\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez installer la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookie-session\")), \" au sein de votre nouveau projet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookies\")), \" et les types associés (pour TypeScript):\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i cookie-session\\nnpm install @types/cookie-session -D\\n\")), \"\\n\", React.createElement(_components.h3, null, \"Utilisation de la fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\"))), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/app.ts\")), \" pour mettre en place la gestion de cookies :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"2,11-20\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import express, { ErrorRequestHandler } from \\\"express\\\";\\nimport cookieSession from \\\"cookie-session\\\";\\n\\nimport usersRouter from \\\"./routes/users\\\";\\nimport pizzaRouter from \\\"./routes/pizzas\\\";\\nimport drinkRouter from \\\"./routes/drinks\\\";\\nimport authsRouter from \\\"./routes/auths\\\";\\n\\nconst app = express();\\n\\nconst expiryDateIn3Months = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30 * 3);\\nconst cookieSecreteKey = 'YouWouldnot!not!like!mypizza';\\napp.use(\\n  cookieSession({\\n    name: 'user',\\n    keys: [cookieSecreteKey],  \\n    httpOnly: true,\\n    expires: expiryDateIn3Months,\\n  }),\\n);\\n\\napp.use((_req, _res, next) => {\\n  console.log(\\n    \\\"Time:\\\",\\n    new Date().toLocaleString(\\\"fr-FR\\\", { timeZone: \\\"Europe/Brussels\\\" })\\n  );\\n  next();\\n});\\n\\napp.use(express.json());\\napp.use(express.urlencoded({ extended: false }));\\n\\napp.use(\\\"/users\\\", usersRouter);\\napp.use(\\\"/pizzas\\\", pizzaRouter);\\napp.use(\\\"/drinks\\\", drinkRouter);\\napp.use(\\\"/auths\\\", authsRouter);\\n\\nconst errorHandler: ErrorRequestHandler = (err, _req, res, _next) => {\\n  console.error(err.stack);\\n  return res.status(500).send(\\\"Something broke!\\\");\\n};\\n\\napp.use(errorHandler);\\nexport default app;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous avons donc bien indiqué que le cookie est inaccessible au JS via : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"httpOnly: true\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Nous avons fait en sorte que le cookie soit signé via la clé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSecreteKey\")), \".\", React.createElement(_components.br), \"\\n\", \"Le mécanisme de signature correspond à ce qui a été vu dans le cadre des tokens JWT.\", React.createElement(_components.br), \"\\n\", \"Ainsi, si un cookie venait être modifié par un utilisateur, lors de la vérification du cookie, cela sera automatiquement détecté par la fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\")), \" et la session ne sera pas créée.\"), \"\\n\", React.createElement(_components.p, null, \"Pour info, la fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\")), \" va créer deux cookies :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"un cookie portant comme nom la valeur de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"name\")), \" ; il est encodé en base64. N'hésitez pas à vous amuser à décoder un cookie généré par \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\")), \" sur \", React.createElement(_components.a, {\n    href: \"https://www.base64decode.org/\"\n  }, \"base64decode\"), \".\"), \"\\n\", React.createElement(_components.li, null, \"un cookie portant comme nom la valeur de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"name\")), \" + \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \".sig\")), \" : c'est la signature qui prévient contre le \\\"tempering\\\" (acte intentionnel mais non autorisé qui amène à la modification d'un système ou de données).\"), \"\\n\"), \"\\n\", React.createElement(_components.h3, null, \"Lecture et ajout de données de session via \", React.createElement(_components.code, null, \"req.session\")), \"\\n\", React.createElement(_components.p, null, \"Pour créer des données de session, il suffit de simplement les ajouter à l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req.session\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Dans le cadre de la RESTful API gérant les pizzas, cela est fait lors d'une opération de type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" ou \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/auths.ts\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"36,65,70-74,76-85\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"/* eslint-disable @typescript-eslint/no-misused-promises */\\n/* \\nIn Express V4, asynchronous functions are not fully supported in TypeScript \\n(only void return type for RequestHandler is allowed). \\nIn Express V5, this issue has been addressed, but V5 is still in beta. \\nConsequently, the ESLint rule \\\"no-misused-promises\\\" is disabled. */\\nimport { Request, Router } from \\\"express\\\";\\nimport { AuthenticatedUser, PotentialUser } from \\\"../types\\\";\\nimport { login, register } from \\\"../services/users\\\";\\nconst router = Router();\\n\\n/* Register a user */\\nrouter.post(\\\"/register\\\", async (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"username\\\" in body) ||\\n    !(\\\"password\\\" in body) ||\\n    typeof body.username !== \\\"string\\\" ||\\n    typeof body.password !== \\\"string\\\" ||\\n    !body.username.trim() ||\\n    !body.password.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { username, password } = body as PotentialUser;\\n\\n  const authenticatedUser = await register(username, password);\\n\\n  if (!authenticatedUser) {\\n    return res.sendStatus(409);\\n  }\\n\\n  createCookieSessionData(req, authenticatedUser);\\n\\n  return res.json({ username: authenticatedUser.username });\\n});\\n\\n/* Login a user */\\nrouter.post(\\\"/login\\\", async (req, res) => {\\n  const body: unknown = req.body;\\n  if (\\n    !body ||\\n    typeof body !== \\\"object\\\" ||\\n    !(\\\"username\\\" in body) ||\\n    !(\\\"password\\\" in body) ||\\n    typeof body.username !== \\\"string\\\" ||\\n    typeof body.password !== \\\"string\\\" ||\\n    !body.username.trim() ||\\n    !body.password.trim()\\n  ) {\\n    return res.sendStatus(400);\\n  }\\n\\n  const { username, password } = body as PotentialUser;\\n\\n  const authenticatedUser = await login(username, password);\\n\\n  if (!authenticatedUser) {\\n    return res.sendStatus(401);\\n  }\\n\\n  createCookieSessionData(req, authenticatedUser);\\n\\n  return res.json({ username: authenticatedUser.username });\\n});\\n\\n/* Logout a user */\\nrouter.get(\\\"/logout\\\", (req, res) => {\\n  req.session = null;\\n  return res.sendStatus(200);\\n});\\n\\nfunction createCookieSessionData(\\n  req: Request,\\n  authenticatedUser: AuthenticatedUser\\n) {\\n  if (!req.session) {\\n    return;\\n  }\\n  req.session.username = authenticatedUser.username;\\n  req.session.token = authenticatedUser.token;\\n}\\n\\nexport default router;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Dans le code ci-dessus, nous préparons les données de session qui seront écrites dans le cookie à l'aide de l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req.session\")), \".\", React.createElement(_components.br), \"\\n\", \"Lorsque nous renvoyons du JSON aux clients, nous ne renvoyons plus le token, mais juste le username de l'utilisateur. L'application cliente, le browser, pourra utiliser cette info pour afficher le nom de l'utilisateur. Pour rappel, le browser n'a pas accès, via le JS, à l'info se trouvant dans le cookie.\"), \"\\n\", React.createElement(_components.p, null, \"Quand nous gérons une session via des cookies, il n'est pas évident de bien clore une session. Nous avons créé une nouvelle opération de type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"GET /auths/logout\")), \" qui permet d'effacer les données de session d'un utilisateur.\"), \"\\n\", React.createElement(_components.p, null, \"Il nous reste à changer le mécanisme d'autorisation.\\nLes tokens ne seront plus reçus via un authorization header, mais via un cookie.\", React.createElement(_components.br), \"\\n\", \"Nous allons donc mettre à jour le middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/utils/authorize\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"13-16\"\n  }, React.createElement(_components.code, {\n    className: \"language-ts\"\n  }, \"import jwt from \\\"jsonwebtoken\\\";\\nimport { readOneUserFromUsername } from \\\"../services/users\\\";\\nimport { NextFunction, RequestHandler, Response } from \\\"express\\\";\\nimport { AuthenticatedRequest, JwtPayload, User } from \\\"../types\\\";\\n\\nconst jwtSecret = \\\"ilovemypizza!\\\";\\n\\nconst authorize = (\\n  req: AuthenticatedRequest,\\n  res: Response,\\n  next: NextFunction\\n) => {\\n  if (!req.session) {\\n    return res.sendStatus(401);\\n  }\\n  const { token } = req.session;\\n  if (!token) {\\n    return res.sendStatus(401);\\n  }\\n\\n  try {\\n    const decoded = jwt.verify(token, jwtSecret) as JwtPayload;\\n    const { username } = decoded;\\n\\n    const existingUser = readOneUserFromUsername(username);\\n\\n    if (!existingUser) {\\n      return res.sendStatus(401);\\n    }\\n\\n    req.user = existingUser; // request.user object is available in all other middleware functions\\n    return next();\\n  } catch (err) {\\n    console.error(\\\"authorize: \\\", err);\\n    return res.sendStatus(401);\\n  }\\n};\\n\\nconst isAdmin: RequestHandler = (req: AuthenticatedRequest, res, next) => {\\n  const { username } = req.user as User;\\n\\n  if (username !== \\\"admin\\\") {\\n    return res.sendStatus(403);\\n  }\\n  return next();\\n};\\n\\nexport { authorize, isAdmin };\\n\")), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" 🍬 Test via REST Client d'une RESTful API attendant des cookies \")), \"\\n\", React.createElement(_components.p, null, \"Il nous reste à tester nos requêtes via REST Client.\"), \"\\n\", React.createElement(_components.p, null, \"Il n'y a pas de nouvelles notions à apprendre pour utiliser REST Client avec des cookies : le comportement par défaut de REST Client, lorsqu'un cookie est renvoyé dans une réponse, est d'inclure ce cookie dans chaque requête vers la même origine.\"), \"\\n\", React.createElement(_components.p, null, \"Dès lors, pour tester l'API, il suffit d'enlever tous les authorization headers et de rajouter une requête pour tester l'effacement d'une session.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez tester les requêtes à l'aide de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/pizzas.http\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"######### NORMAL OPERATION  ###########\\n\\n### Read all pizzas\\nGET http://localhost:3000/pizzas\\n\\n### Read all pizzas with File variable\\n@baseUrl = http://localhost:3000\\nGET {{baseUrl}}/pizzas\\n\\n### Read all pizzas sorted by title (ascending)\\nGET {{baseUrl}}/pizzas/?order=+title\\n\\n### Read all pizzas sorted by title (descending)\\nGET {{baseUrl}}/pizzas/?order=-title\\n\\n### Read pizza identified by 2\\nGET {{baseUrl}}/pizzas/2\\n\\n### Create a pizza by using the admin account\\n#### First login as the admin\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"admin\\\",\\n    \\\"password\\\":\\\"admin\\\"\\n}\\n\\n#### Create a pizza with the admin token\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\\n### Delete pizza identified by 2 with the admin token\\nDELETE {{baseUrl}}/pizzas/2\\n\\n### Update the pizza identified by 6 with the admin token\\nPATCH {{baseUrl}}/pizzas/6\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green 2\\\"\\n}\\n\\n\\n######### ERROR OPERATION  ###########\\n\\n### 1. Create a pizza without a token\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\\n### 2. Create a pizza without being the admin, use manager account\\n#### 2.1 First login as the manager\\nPOST {{baseUrl}}/auths/login\\nContent-Type: application/json\\n\\n{\\n    \\\"username\\\":\\\"manager\\\",\\n    \\\"password\\\":\\\"manager\\\"\\n}\\n\\n#### 2.2 Try to create a pizza with the manager token\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\\n### Read pizza which does not exists\\nGET {{baseUrl}}/pizzas/100\\n\\n### Create a pizza which lacks a property\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\\n### Create a pizza without info for a property\\nPOST {{baseUrl}}/pizzas\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"\\\",\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\n}\\n\\n### Update for a pizza which does not exist\\nPATCH {{baseUrl}}/pizzas/200\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green 2\\\"\\n}\\n\\n### Update for a pizza which does not provide any info for a property\\nPATCH {{baseUrl}}/pizzas/1\\n\\nContent-Type: application/json\\n\\n{\\n    \\\"title\\\":\\\"Magic Green 2\\\",\\n    \\\"content\\\":\\\"\\\"\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/auths.http\")), \" pour tester \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"GET /auths/logout\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"### Logout any user\\nGET {{baseUrl}}/auths/logout\\n\")), \"\\n\", React.createElement(_components.p, null, \"Pour ajouter une pizza, il suffit juste :\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"De loguer l'admin.\"), \"\\n\", React.createElement(_components.li, null, \"De créer une nouvelle pizza ; le cookie est automatiquement envoyé.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Admettons que vous souhaitez tester l'ajout d'une pizza sans envoyer de token :\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"Lancez l'opération de logout (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"GET /auths/logout\")), \") ; le cookie renvoyé ne contient pas de données de session ;\"), \"\\n\", React.createElement(_components.li, null, \"Tentez la création d'une pizza qui renverra un code \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"401 Unauthorized\")), \".\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"En cas de souci, vous pouvez utiliser le code du tutoriel \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/ts-demos/tree/main/back/api/cookies\"\n  }, \"cookies\"), \".\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","import GATSBY_COMPILED_MDX from \"/Users/raphaelbaroni/code/web2/ts-repos/web2/src/mdx-pages/part3/auths-api.fr.mdx\";\nimport React from 'react';\nimport {graphql} from 'gatsby';\nimport {MDXProvider} from '@mdx-js/react';\nimport {Link} from 'gatsby';\nimport MainLayout from '../components/main-layout.js';\nimport Image from '../components/image.js';\nimport Section from '../components/section.js';\nimport Content from '../components/content.js';\nimport Background from '../components/background.js';\nimport SectionHeader from '../components/section-header.js';\nimport SectionFooter from '../components/section-footer.js';\nimport PageHeader from '../components/page-header.js';\nimport {withFrontmatter} from '../components/hoc/hoc.js';\nimport CodeBlock from '../components/codeblock/codeblock.js';\nimport LinkFile from '../components/file/link-file.js';\nimport ScrollableImage from '../components/image/scrollable-image';\nimport PublicProjectsView from '../components/public-projects/public-projects-view';\nimport {AuthenticatedTemplate, UnauthenticatedTemplate} from '@azure/msal-react';\nimport AuthenticatedBlock from '../components/auth/authenticated-block.js';\nimport UnAuthenticatedBlock from '../components/auth/unauthenticated-block.js';\nimport NestedMdxBlock from '../components/mdx/nested-mdx-block.js';\nimport YoutubeImage from '../components/image/youtube-image.js';\nimport InternalPageMenu from '../components/internal-page-menu/internal-page-menu.js';\nimport InternalPageMenuItem from '../components/internal-page-menu/internal-page-menu-item.js';\nimport InternalPageTitle from '../components/internal-page-menu/menu-title.js';\nimport {PathViewer, PathViewerItem} from '../components/path-viewer/path-viewer.js';\nconst shortcodes = {\n  Link,\n  Image,\n  Section,\n  Content,\n  Background,\n  SectionHeader,\n  SectionFooter,\n  PageHeader,\n  CodeBlock,\n  LinkFile,\n  ScrollableImage,\n  PublicProjectsView,\n  AuthenticatedBlock,\n  UnAuthenticatedBlock,\n  NestedMdxBlock,\n  YoutubeImage,\n  InternalPageMenu,\n  InternalPageMenuItem,\n  InternalPageTitle,\n  PathViewer,\n  PathViewerItem\n};\nfunction PageTemplate({data: {mdx, allImages}, children}) {\n  shortcodes.PageHeader = withFrontmatter(PageHeader, mdx?.frontmatter);\n  return React.createElement(MainLayout, Object.assign({}, mdx?.frontmatter ? {\n    frontmatter: mdx.frontmatter\n  } : {}, mdx?.frontmatter?.navbarExtraStyles ? {\n    navbarExtraStyles: mdx.frontmatter.navbarExtraStyles\n  } : {}, mdx?.frontmatter?.headerImage ? {\n    headerImage: mdx.frontmatter.headerImage\n  } : {}, mdx?.frontmatter?.featuredImage ? {\n    featuredImage: mdx.frontmatter.featuredImage\n  } : {}, mdx?.frontmatter?.title ? {\n    pageTitle: mdx.frontmatter.title\n  } : {}, allImages && allImages.length > 0 ? {\n    allImages: allImages\n  } : {}), React.createElement(MDXProvider, {\n    components: shortcodes\n  }, React.createElement(\"div\", {\n    className: mdx?.frontmatter?.autoMargin ? 'page page--auto-margin ' : 'page'\n  }, children)));\n}\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PageTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\nexport const pageQuery = graphql`\n  query pagesAndImages($slug: String) {\n    mdx(fields: { slug: { eq: $slug } }) {\n      id\n      body\n      fields {\n        slug\n      }\n\n      frontmatter {\n        title\n        date\n        navbarExtraStyles\n        headerImage\n        featuredImage\n        description\n        autoMargin\n      }\n    }\n    allImages: allFile(\n      filter: {\n        sourceInstanceName: { eq: \"images\" }\n        extension: { nin: [\"ico\", \"svg\"] }\n      }\n    ) {\n      edges {\n        node {\n          childImageSharp {\n            gatsbyImageData(\n              quality: 90\n              layout: FULL_WIDTH\n              placeholder: TRACED_SVG\n              tracedSVGOptions: { color: \"green\", background: \"grey\" }\n            )\n          }\n          base\n        }\n      }\n    }\n  }\n`;\n"],"names":["_createMdxContent","props","_components","Object","assign","h1","h2","p","strong","ul","li","br","em","h3","h4","code","a","pre","h5","table","thead","tr","th","tbody","td","ol","_provideComponents","components","InternalPageMenu","PathViewer","PathViewerItem","InternalPageMenuItem","YoutubeImage","InternalPageTitle","ScrollableImage","_missingMdxReference","React","to","selected","className","src","href","name","minWidth","maxWidth","numbered","highlighting","wrapper","MDXLayout","id","component","Error","shortcodes","Link","Image","Section","Content","Background","SectionHeader","SectionFooter","PageHeader","CodeBlock","LinkFile","PublicProjectsView","AuthenticatedBlock","UnAuthenticatedBlock","NestedMdxBlock","PageTemplate","data","mdx","allImages","children","withFrontmatter","frontmatter","MainLayout","navbarExtraStyles","headerImage","featuredImage","title","pageTitle","length","MDXProvider","autoMargin","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}